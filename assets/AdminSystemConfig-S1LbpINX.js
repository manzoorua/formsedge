import{c as e,r as s,k as i,j as a,B as t,S as r,s as n,C as l,b as c,d,e as m,f as o}from"./main-BQOa5mM0.js";import{I as x}from"./input-COMLYb-C.js";import{B as u}from"./badge-6grXs2Vt.js";import{S as h}from"./switch-CocPZzzC.js";import{T as p,a as j,b as f,c as g}from"./tabs-BbGbqsLR.js";import{D as y,a as v,b as _,c as N,e as b}from"./dialog-Zbmvpzx0.js";import{S as w}from"./settings-CSYLqhyU.js";import{D as C}from"./dollar-sign-CFY7m5M8.js";import{M as S}from"./mail-BKZIg2ud.js";import{H as k}from"./history-Jb2UQDc7.js";import{f as M}from"./format-CNqjFxb7.js";import"./index-Cff7j1dh.js";import"./index-_nftuPOU.js";import"./index-C38VFtOl.js";import"./index-D4HqgO5_.js";import"./index-CjuUx4b5.js";import"./en-US-DcoqlHup.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=e("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),P=e("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),E=()=>{const[e,E]=s.useState([]),[I,T]=s.useState(!0),[V,z]=s.useState(!1),[H,D]=s.useState([]),[U,$]=s.useState(null),[O,q]=s.useState([]),{toast:A}=i(),B=async()=>{try{T(!0);const{data:e,error:s}=await n.functions.invoke("admin-system-config",{body:{action:"get_all"}});if(s)throw s;E(e.configs||[])}catch(e){A({title:"Error",description:"Failed to load system configuration",variant:"destructive"})}finally{T(!1)}},J=async(e,s)=>{try{z(!0);const{error:i}=await n.functions.invoke("admin-system-config",{body:{action:"update",configKey:e,configValue:s}});if(i)throw i;A({title:"Success",description:"Configuration updated successfully"}),B()}catch(i){A({title:"Error",description:"Failed to update configuration",variant:"destructive"})}finally{z(!1)}},L=async e=>{try{const{data:s,error:i}=await n.functions.invoke("admin-system-config",{body:{action:"get_audit_log",configKey:e}});if(i)throw i;D(s.audit_logs||[]),$(e)}catch(s){A({title:"Error",description:"Failed to load audit log",variant:"destructive"})}},R=async()=>{try{const{data:e,error:s}=await n.functions.invoke("admin-system-config",{body:{action:"get_pricing_tiers"}});if(s)throw s;q(e.tiers||[])}catch(e){}};s.useEffect(()=>{B(),R()},[]);const K=s=>e.find(e=>e.config_key===s),Y=()=>{const e=K("feature_flags");if(!e)return null;const s=e.config_value;return a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsxs(d,{className:"flex items-center gap-2",children:[a.jsx(P,{className:"h-5 w-5"}),"Feature Flags"]}),a.jsx(m,{children:"Control global feature availability"})]}),a.jsxs(o,{className:"space-y-4",children:[Object.entries(s).map(([e,i])=>a.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium capitalize",children:e.replace(/_/g," ")}),a.jsx("p",{className:"text-sm text-muted-foreground",children:i?"Enabled":"Disabled"})]}),a.jsx(h,{checked:i,onCheckedChange:()=>(e=>{const i={...s,[e]:!s[e]};J("feature_flags",i)})(e),disabled:V})]},e)),a.jsxs(t,{size:"sm",variant:"outline",onClick:()=>L("feature_flags"),children:[a.jsx(k,{className:"h-4 w-4 mr-2"}),"View History"]})]})]})},Z=()=>a.jsx("div",{className:"space-y-4",children:["free","pro","enterprise"].map(e=>{const s=K(`tier_limits_${e}`);if(!s)return null;const i=s.config_value,r=(s,a)=>{const t=parseInt(a)||0,r={...i,[s]:-1===t?-1:t};J(`tier_limits_${e}`,r)};return a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsxs(d,{className:"flex items-center justify-between",children:[a.jsxs("span",{className:"capitalize",children:[e," Tier"]}),a.jsx(u,{children:"enterprise"===e?"Unlimited":"pro"===e?"Premium":"Basic"})]}),a.jsx(m,{children:s.description})]}),a.jsxs(o,{children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Max Forms"}),a.jsx(x,{type:"number",value:i.max_forms,onChange:e=>r("max_forms",e.target.value),placeholder:"Unlimited = -1"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Max Responses"}),a.jsx(x,{type:"number",value:i.max_responses_per_form,onChange:e=>r("max_responses_per_form",e.target.value),placeholder:"Unlimited = -1"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Max File Upload (MB)"}),a.jsx(x,{type:"number",value:i.max_file_upload_mb,onChange:e=>r("max_file_upload_mb",e.target.value)})]}),a.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[a.jsx(h,{checked:i.advanced_features,onCheckedChange:s=>{const a={...i,advanced_features:s};J(`tier_limits_${e}`,a)}}),a.jsx("label",{className:"text-sm font-medium",children:"Advanced Features"})]})]}),a.jsxs("div",{className:"mt-4 flex gap-2",children:[a.jsx(t,{size:"sm",onClick:()=>J(`tier_limits_${e}`,i),children:"Save Changes"}),a.jsxs(t,{size:"sm",variant:"outline",onClick:()=>L(`tier_limits_${e}`),children:[a.jsx(k,{className:"h-4 w-4 mr-2"}),"View History"]})]})]})]},e)})}),G=()=>{const e=K("smtp_settings");if(!e)return null;const[i,r]=s.useState(e.config_value);return a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsxs(d,{className:"flex items-center gap-2",children:[a.jsx(S,{className:"h-5 w-5"}),"SMTP Configuration"]}),a.jsx(m,{children:"Configure email sending settings"})]}),a.jsxs(o,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Enable SMTP"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Use custom SMTP server for emails"})]}),a.jsx(h,{checked:i.enabled,onCheckedChange:e=>r({...i,enabled:e})})]}),i.enabled&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"SMTP Host"}),a.jsx(x,{value:i.host,onChange:e=>r({...i,host:e.target.value}),placeholder:"smtp.example.com"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Port"}),a.jsx(x,{type:"number",value:i.port,onChange:e=>r({...i,port:parseInt(e.target.value)}),placeholder:"587"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Username"}),a.jsx(x,{value:i.username,onChange:e=>r({...i,username:e.target.value}),placeholder:"username"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"From Email"}),a.jsx(x,{type:"email",value:i.from_email,onChange:e=>r({...i,from_email:e.target.value}),placeholder:"noreply@formsedge.com"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"From Name"}),a.jsx(x,{value:i.from_name,onChange:e=>r({...i,from_name:e.target.value}),placeholder:"FormsEdge"})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(t,{onClick:()=>{J("smtp_settings",i)},disabled:V,children:"Save SMTP Settings"}),a.jsxs(t,{size:"sm",variant:"outline",onClick:()=>L("smtp_settings"),children:[a.jsx(k,{className:"h-4 w-4 mr-2"}),"View History"]})]})]})]})},Q=()=>{const e=K("security_settings");if(!e)return null;const[i,n]=s.useState(e.config_value);return a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsxs(d,{className:"flex items-center gap-2",children:[a.jsx(r,{className:"h-5 w-5"}),"Security Settings"]}),a.jsx(m,{children:"Configure authentication and security policies"})]}),a.jsxs(o,{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Max Login Attempts"}),a.jsx(x,{type:"number",value:i.max_login_attempts,onChange:e=>n({...i,max_login_attempts:parseInt(e.target.value)})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Session Timeout (minutes)"}),a.jsx(x,{type:"number",value:i.session_timeout_minutes,onChange:e=>n({...i,session_timeout_minutes:parseInt(e.target.value)})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Minimum Password Length"}),a.jsx(x,{type:"number",value:i.password_min_length,onChange:e=>n({...i,password_min_length:parseInt(e.target.value)})})]}),a.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Require Email Verification"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Force users to verify email on signup"})]}),a.jsx(h,{checked:i.require_email_verification,onCheckedChange:e=>n({...i,require_email_verification:e})})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(t,{onClick:()=>{J("security_settings",i)},disabled:V,children:"Save Security Settings"}),a.jsxs(t,{size:"sm",variant:"outline",onClick:()=>L("security_settings"),children:[a.jsx(k,{className:"h-4 w-4 mr-2"}),"View History"]})]})]})]})},W=()=>{const[e,i]=s.useState({});s.useEffect(()=>{const e={};O.forEach(s=>{e[s.id]={price_monthly:(s.price_monthly/100).toString(),price_yearly:s.price_yearly?(s.price_yearly/100).toString():"",stripe_price_id_monthly:s.stripe_price_id_monthly||"",stripe_price_id_yearly:s.stripe_price_id_yearly||""}}),i(e)},[O]);const r=s=>{const i=e[s];if(!i)return;(async(e,s)=>{try{z(!0);const{error:i}=await n.functions.invoke("admin-system-config",{body:{action:"update_pricing_tier",tierId:e,tierData:s}});if(i)throw i;A({title:"Success",description:"Pricing updated successfully"}),R()}catch(i){A({title:"Error",description:"Failed to update pricing",variant:"destructive"})}finally{z(!1)}})(s,{price_monthly:Math.round(100*parseFloat(i.price_monthly||"0")),price_yearly:i.price_yearly?Math.round(100*parseFloat(i.price_yearly)):null,stripe_price_id_monthly:i.stripe_price_id_monthly||null,stripe_price_id_yearly:i.stripe_price_id_yearly||null})};return a.jsxs("div",{className:"space-y-4",children:[a.jsx(l,{className:"mb-4",children:a.jsxs(c,{children:[a.jsxs(d,{className:"flex items-center gap-2",children:[a.jsx(C,{className:"h-5 w-5"}),"Subscription Pricing"]}),a.jsx(m,{children:"Configure pricing for each subscription tier. Prices are stored in cents but displayed in dollars."})]})}),O.map(s=>{const n=e[s.id];if(!n)return null;const h=((e,s)=>{const i=parseFloat(e)||0,a=parseFloat(s)||0;if(0===i||0===a)return 0;const t=12*i;return Math.round((t-a)/t*100)})(n.price_monthly,n.price_yearly);return a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsxs(d,{className:"flex items-center justify-between",children:[a.jsxs("span",{className:"capitalize",children:[s.name," Tier"]}),a.jsx(u,{variant:"pro"===s.name?"default":"outline",children:s.is_active?"Active":"Inactive"})]}),a.jsx(m,{children:s.description})]}),a.jsxs(o,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Monthly Price ($)"}),a.jsx(x,{type:"number",step:"0.01",value:n.price_monthly,onChange:e=>i(i=>({...i,[s.id]:{...i[s.id],price_monthly:e.target.value}})),placeholder:"0.00",disabled:"free"===s.name}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Stored as: ",Math.round(100*parseFloat(n.price_monthly||"0"))," cents"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Yearly Price ($ total)"}),a.jsx(x,{type:"number",step:"0.01",value:n.price_yearly,onChange:e=>i(i=>({...i,[s.id]:{...i[s.id],price_yearly:e.target.value}})),placeholder:"0.00",disabled:"free"===s.name}),h>0&&a.jsxs("p",{className:"text-xs text-success mt-1",children:[h,"% savings vs monthly"]})]})]}),"free"!==s.name&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Stripe Monthly Price ID"}),a.jsx(x,{value:n.stripe_price_id_monthly,onChange:e=>i(i=>({...i,[s.id]:{...i[s.id],stripe_price_id_monthly:e.target.value}})),placeholder:"price_..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Stripe Yearly Price ID"}),a.jsx(x,{value:n.stripe_price_id_yearly,onChange:e=>i(i=>({...i,[s.id]:{...i[s.id],stripe_price_id_yearly:e.target.value}})),placeholder:"price_..."})]})]}),a.jsxs(t,{onClick:()=>r(s.id),disabled:V||"free"===s.name,children:["Save ",s.name," Pricing"]})]})]},s.id)})]})};return I?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):a.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"System Configuration"}),a.jsx("p",{className:"text-muted-foreground",children:"Manage system-wide settings and limits"})]}),a.jsx("div",{className:"flex items-center justify-between mb-4",children:a.jsxs(t,{onClick:B,variant:"outline",children:[a.jsx(w,{className:"mr-2 h-4 w-4"}),"Refresh"]})}),a.jsxs(p,{defaultValue:"features",className:"space-y-4",children:[a.jsxs(j,{children:[a.jsxs(f,{value:"features",children:[a.jsx(P,{className:"mr-2 h-4 w-4"}),"Feature Flags"]}),a.jsxs(f,{value:"pricing",children:[a.jsx(C,{className:"mr-2 h-4 w-4"}),"Pricing"]}),a.jsxs(f,{value:"limits",children:[a.jsx(F,{className:"mr-2 h-4 w-4"}),"Tier Limits"]}),a.jsxs(f,{value:"smtp",children:[a.jsx(S,{className:"mr-2 h-4 w-4"}),"SMTP"]}),a.jsxs(f,{value:"security",children:[a.jsx(r,{className:"mr-2 h-4 w-4"}),"Security"]})]}),a.jsx(g,{value:"features",children:a.jsx(Y,{})}),a.jsx(g,{value:"pricing",children:a.jsx(W,{})}),a.jsx(g,{value:"limits",children:a.jsx(Z,{})}),a.jsx(g,{value:"smtp",children:a.jsx(G,{})}),a.jsx(g,{value:"security",children:a.jsx(Q,{})})]}),a.jsx(y,{open:null!==U,onOpenChange:()=>$(null),children:a.jsxs(v,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsxs(_,{children:[a.jsx(N,{children:"Configuration Change History"}),a.jsxs(b,{children:["View all changes made to ",U]})]}),a.jsxs("div",{className:"space-y-3",children:[H.map(e=>a.jsxs("div",{className:"p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx(u,{variant:"outline",children:M(new Date(e.changed_at),"MMM d, yyyy HH:mm")}),a.jsx("span",{className:"text-sm text-muted-foreground",children:e.changed_by_email})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium mb-1",children:"Old Value:"}),a.jsx("pre",{className:"bg-muted p-2 rounded overflow-x-auto",children:JSON.stringify(e.old_value,null,2)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium mb-1",children:"New Value:"}),a.jsx("pre",{className:"bg-muted p-2 rounded overflow-x-auto",children:JSON.stringify(e.new_value,null,2)})]})]})]},e.id)),0===H.length&&a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(k,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No change history available"})]})]})]})})]})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{E as default};
