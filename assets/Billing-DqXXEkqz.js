import{u as s,r as e,s as r,h as a,j as i,C as t,b as n,d as c,f as o,B as l,e as m}from"./main-BQOa5mM0.js";import{B as d}from"./badge-6grXs2Vt.js";import{S as p}from"./separator-3yH5arB6.js";import{H as x,F as j}from"./Footer-DKRYfoL3.js";import{C as u}from"./credit-card-vpcdCJf9.js";import{C as h}from"./calendar-BcqkHMaS.js";import{C as b}from"./circle-check-big-BImW7D2D.js";import{T as f}from"./trending-up-C7EF6GbL.js";import"./ThemeToggle-B4EQrceX.js";import"./sun-oLtT9Ef9.js";import"./RewardsPopup-VqGcFfEV.js";import"./dialog-Zbmvpzx0.js";import"./index-D4HqgO5_.js";import"./index-CjuUx4b5.js";import"./gift-mKnn5hCx.js";import"./check-WoqjMYuF.js";import"./copy-BZksGIXa.js";import"./share-2-CwU1PQxU.js";import"./arrow-left-BoD24ioV.js";import"./dollar-sign-CFY7m5M8.js";import"./clock-BGkZXTj0.js";import"./format-CNqjFxb7.js";import"./en-US-DcoqlHup.js";import"./dropdown-menu-DSV87Z6r.js";import"./index-C38VFtOl.js";import"./index-_nftuPOU.js";import"./circle-BfUTHkiN.js";import"./chevron-down-BwC0H5jo.js";import"./zap-Ewtv7hwb.js";import"./chart-column-DIuSFmYM.js";function g(){const{user:g}=s(),[N,y]=e.useState(null),[v,w]=e.useState([]),[_,k]=e.useState(!0),[S,C]=e.useState(null);e.useEffect(()=>{g&&F()},[g]);const F=async()=>{try{k(!0);const{data:s,error:e}=await r.from("public_subscription_tiers").select("*");if(e)throw e;w(s||[]),await U()}catch(s){a.error("Failed to load billing information")}finally{k(!1)}},U=async()=>{try{const{data:s,error:e}=await r.functions.invoke("check-subscription");if(e)throw e;y(s)}catch(s){}};return g?_?i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(x,{}),i.jsx("main",{className:"container mx-auto px-4 py-16",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),i.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading billing information..."})]})}),i.jsx(j,{})]}):i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(x,{}),i.jsx("main",{className:"container mx-auto px-4 py-16",children:i.jsxs("div",{className:"max-w-6xl mx-auto",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-4",children:"Billing & Subscription"}),i.jsx("p",{className:"text-lg text-muted-foreground",children:"Manage your subscription and billing information"})]}),N&&i.jsxs(t,{className:"mb-8",children:[i.jsx(n,{children:i.jsxs(c,{className:"flex items-center gap-2",children:[i.jsx(u,{className:"h-5 w-5"}),"Current Subscription"]})}),i.jsx(o,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsxs(d,{variant:(P=N.subscription_tier,N?.subscription_tier===P?"default":"outline"),children:[N.subscription_tier.charAt(0).toUpperCase()+N.subscription_tier.slice(1)," Plan"]}),N.subscribed&&i.jsx(d,{variant:"outline",className:"text-green-600 border-green-600",children:"Active"})]}),N.subscription_end&&i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(h,{className:"h-4 w-4"}),N.cancel_at_period_end?"Expires":"Renews"," on"," ",new Date(N.subscription_end).toLocaleDateString()]})]}),N.subscribed&&i.jsx(l,{variant:"outline",onClick:async()=>{try{C("portal");const{data:s,error:e}=await r.functions.invoke("customer-portal");if(e)throw e;s?.url&&window.open(s.url,"_blank")}catch(s){a.error("Failed to open customer portal")}finally{C(null)}},disabled:"portal"===S,children:"portal"===S?"Loading...":"Manage Subscription"})]})})]}),i.jsx("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:v.map(s=>{return i.jsxs(t,{className:"relative "+(N?.subscription_tier===s.name?"ring-2 ring-primary":""),children:[N?.subscription_tier===s.name&&i.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:i.jsx(d,{className:"bg-primary",children:"Current Plan"})}),i.jsxs(n,{children:[i.jsxs(c,{className:"flex items-center justify-between",children:[s.name.charAt(0).toUpperCase()+s.name.slice(1),"pro"===s.name&&i.jsx(d,{variant:"secondary",children:"Most Popular"})]}),i.jsx(m,{children:s.description}),i.jsxs("div",{className:"text-3xl font-bold",children:[0===s.price_monthly?"Free":(e=s.price_monthly,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100)),s.price_monthly>0&&i.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"/month"})]})]}),i.jsx(o,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("p",{className:"text-sm",children:[i.jsx("strong",{children:"Forms:"})," ",-1===s.max_forms?"Unlimited":s.max_forms]}),i.jsxs("p",{className:"text-sm",children:[i.jsx("strong",{children:"Responses per form:"})," ",-1===s.max_responses_per_form?"Unlimited":s.max_responses_per_form]})]}),i.jsx(p,{}),i.jsx("div",{className:"space-y-2",children:(Array.isArray(s.features)?s.features:[]).map((s,e)=>i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(b,{className:"h-4 w-4 text-green-600"}),s]},e))}),N?.subscription_tier!==s.name&&i.jsx(l,{className:"w-full mt-4",variant:"pro"===s.name?"default":"outline",onClick:()=>(async(s,e="monthly")=>{try{C(s);const{data:a,error:i}=await r.functions.invoke("create-checkout",{body:{plan:s,billing_interval:e}});if(i)throw i;a?.url&&window.open(a.url,"_blank")}catch(i){a.error("Failed to start checkout process")}finally{C(null)}})(s.name),disabled:S===s.name,children:S===s.name?"Loading...":0===s.price_monthly?"Current Plan":"Subscribe"})]})})]},s.id);var e})}),i.jsx("div",{className:"text-center",children:i.jsxs(l,{variant:"outline",onClick:U,children:[i.jsx(f,{className:"h-4 w-4 mr-2"}),"Refresh Subscription Status"]})})]})}),i.jsx(j,{})]}):i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(x,{}),i.jsx("main",{className:"container mx-auto px-4 py-16",children:i.jsx("div",{className:"text-center",children:i.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Please sign in to view billing"})})}),i.jsx(j,{})]});var P}export{g as default};
