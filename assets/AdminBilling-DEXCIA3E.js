import{r as e,k as s,j as r,B as t,C as n,b as a,d as i,f as l,e as c,s as d}from"./main-BQOa5mM0.js";import{B as o}from"./badge-6grXs2Vt.js";import{T as x,a as m,b as h,c as u,d as j,e as p}from"./table-CsUrjkkT.js";import{T as v,a as f,b,c as y}from"./tabs-BbGbqsLR.js";import{A as g}from"./activity-bwg40EGM.js";import{D as N}from"./dollar-sign-CFY7m5M8.js";import{T as w}from"./trending-up-C7EF6GbL.js";import{U as R}from"./users-DfZDw2qr.js";import{C as k}from"./circle-x-BCWjiaKg.js";import{R as S,m as C,n as M,X as A,Y as _,T as D,o as E,p as F}from"./AreaChart-gdTbffDC.js";import{W as T}from"./webhook-CO3AmyxJ.js";import{f as P}from"./format-CNqjFxb7.js";import"./index-_nftuPOU.js";import"./index-C38VFtOl.js";import"./en-US-DcoqlHup.js";const B=()=>{const[B,U]=e.useState(null),[W,I]=e.useState(!0),[K,L]=e.useState(""),{toast:O}=s(),V=async()=>{try{I(!0);const{data:e,error:s}=await d.functions.invoke("admin-billing-stats");if(s)throw s;U(e)}catch(e){O({title:"Error",description:"Failed to load billing statistics",variant:"destructive"})}finally{I(!1)}};e.useEffect(()=>{V();const e=setInterval(V,6e4);return()=>clearInterval(e)},[]);const X=B?.subscribers.filter(e=>e.email.toLowerCase().includes(K.toLowerCase()))||[],$=(e,s)=>{if(s)return r.jsx(o,{variant:"outline",className:"bg-orange-500/10 text-orange-500",children:"Canceling"});switch(e){case"active":return r.jsx(o,{variant:"outline",className:"bg-green-500/10 text-green-500",children:"Active"});case"canceled":return r.jsx(o,{variant:"outline",className:"bg-red-500/10 text-red-500",children:"Canceled"});case"past_due":return r.jsx(o,{variant:"outline",className:"bg-yellow-500/10 text-yellow-500",children:"Past Due"});default:return r.jsx(o,{variant:"outline",children:e})}},z=[{month:"Jan",revenue:B?.monthlyRecurringRevenue?.7*B.monthlyRecurringRevenue:0},{month:"Feb",revenue:B?.monthlyRecurringRevenue?.8*B.monthlyRecurringRevenue:0},{month:"Mar",revenue:B?.monthlyRecurringRevenue?.9*B.monthlyRecurringRevenue:0},{month:"Apr",revenue:B?.monthlyRecurringRevenue||0}];return W?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):r.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold",children:"Billing & Subscriptions"}),r.jsx("p",{className:"text-muted-foreground",children:"Monitor revenue and manage subscriptions"})]}),r.jsxs(t,{onClick:V,variant:"outline",children:[r.jsx(g,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),r.jsxs(v,{defaultValue:"overview",className:"space-y-4",children:[r.jsxs(f,{children:[r.jsx(b,{value:"overview",children:"Overview"}),r.jsx(b,{value:"subscriptions",children:"Subscriptions"}),r.jsx(b,{value:"failed",children:"Failed Payments"}),r.jsx(b,{value:"webhooks",children:"Webhook Events"})]}),r.jsxs(y,{value:"overview",className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsxs(n,{children:[r.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(i,{className:"text-sm font-medium",children:"MRR"}),r.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(l,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:["$",B?.monthlyRecurringRevenue||0]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Monthly Recurring Revenue"})]})]}),r.jsxs(n,{children:[r.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(i,{className:"text-sm font-medium",children:"ARR"}),r.jsx(w,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(l,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:["$",B?.annualRecurringRevenue||0]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Annual Recurring Revenue"})]})]}),r.jsxs(n,{children:[r.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(i,{className:"text-sm font-medium",children:"Active Subs"}),r.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(l,{children:[r.jsx("div",{className:"text-2xl font-bold",children:B?.activeSubscriptions||0}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Paying customers"})]})]}),r.jsxs(n,{children:[r.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(i,{className:"text-sm font-medium",children:"Canceled"}),r.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(l,{children:[r.jsx("div",{className:"text-2xl font-bold",children:B?.canceledSubscriptions||0}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Churn this period"})]})]})]}),r.jsxs(n,{children:[r.jsxs(a,{children:[r.jsx(i,{children:"Revenue Trend"}),r.jsx(c,{children:"Monthly recurring revenue over time"})]}),r.jsx(l,{children:r.jsx(S,{width:"100%",height:300,children:r.jsxs(C,{data:z,children:[r.jsx(M,{strokeDasharray:"3 3"}),r.jsx(A,{dataKey:"month"}),r.jsx(_,{}),r.jsx(D,{}),r.jsx(E,{}),r.jsx(F,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3})]})})})]})]}),r.jsx(y,{value:"subscriptions",className:"space-y-4",children:r.jsxs(n,{children:[r.jsxs(a,{children:[r.jsx(i,{children:"All Subscriptions"}),r.jsx(c,{children:"Manage customer subscriptions"})]}),r.jsxs(l,{children:[r.jsx("div",{className:"mb-4",children:r.jsx("input",{type:"text",placeholder:"Search by email...",value:K,onChange:e=>L(e.target.value),className:"w-full max-w-sm px-3 py-2 border rounded-md"})}),r.jsxs(x,{children:[r.jsx(m,{children:r.jsxs(h,{children:[r.jsx(u,{children:"Email"}),r.jsx(u,{children:"Tier"}),r.jsx(u,{children:"Status"}),r.jsx(u,{children:"Subscription End"}),r.jsx(u,{children:"Created"}),r.jsx(u,{children:"Actions"})]})}),r.jsx(j,{children:X.map(e=>{return r.jsxs(h,{children:[r.jsx(p,{className:"font-medium",children:e.email}),r.jsx(p,{children:(s=e.subscription_tier||"free",r.jsx(o,{variant:"outline",className:{free:"bg-gray-500/10 text-gray-500",pro:"bg-blue-500/10 text-blue-500",enterprise:"bg-purple-500/10 text-purple-500"}[s]||"bg-gray-500/10 text-gray-500",children:s.toUpperCase()}))}),r.jsx(p,{children:$(e.subscription_status||"inactive",e.cancel_at_period_end)}),r.jsx(p,{children:e.subscription_end?P(new Date(e.subscription_end),"MMM d, yyyy"):"N/A"}),r.jsx(p,{children:P(new Date(e.created_at),"MMM d, yyyy")}),r.jsx(p,{children:r.jsx(t,{size:"sm",variant:"outline",children:"View Details"})})]},e.id);var s})})]}),0===X.length&&r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})]})]})}),r.jsx(y,{value:"failed",className:"space-y-4",children:r.jsxs(n,{children:[r.jsxs(a,{children:[r.jsx(i,{children:"Failed Payments"}),r.jsx(c,{children:"Monitor and resolve payment issues"})]}),r.jsx(l,{children:r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx(k,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),r.jsx("p",{children:"No failed payments to display"}),r.jsx("p",{className:"text-sm mt-2",children:"Failed payment tracking will appear here when configured"})]})})]})}),r.jsx(y,{value:"webhooks",className:"space-y-4",children:r.jsxs(n,{children:[r.jsxs(a,{children:[r.jsx(i,{children:"Stripe Webhook Events"}),r.jsx(c,{children:"Recent webhook events from Stripe"})]}),r.jsx(l,{children:r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),r.jsx("p",{children:"No webhook events to display"}),r.jsx("p",{className:"text-sm mt-2",children:"Configure webhook event logging to track Stripe events"})]})})]})})]})]})};export{B as default};
