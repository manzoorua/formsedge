import{c as e,u as s,r as a,s as t,h as r,j as i,B as l,Y as n,C as o,g as c}from"./main-BQOa5mM0.js";import{I as d}from"./input-COMLYb-C.js";import{B as m}from"./badge-6grXs2Vt.js";import{S as x,a as h,b as u,c as j,d as p}from"./select-DDetsmr9.js";import{D as f,a as g,b as v,c as N,e as b}from"./dialog-Zbmvpzx0.js";import{T as y}from"./textarea-Dbo2TYJP.js";import{L as w}from"./label-B7su6Jaa.js";import{D as _}from"./download-BuY_PqoH.js";import{S}from"./search-BDbiXKhR.js";import{C as k}from"./circle-x-BCWjiaKg.js";import{C}from"./circle-check-big-BImW7D2D.js";import{C as P}from"./circle-alert-C_kZuZo4.js";import{C as z}from"./clock-BGkZXTj0.js";import{U as A}from"./user-CAryOBTT.js";import{M as B}from"./mail-BKZIg2ud.js";import{P as M}from"./phone-DTqSRSbI.js";import{B as $}from"./building-Du4vbJB2.js";import{T as R}from"./trash-2-B0C8EAKm.js";import{f as T}from"./format-CNqjFxb7.js";import"./index-C38VFtOl.js";import"./index-CjuUx4b5.js";import"./index-Cff7j1dh.js";import"./chevron-down-BwC0H5jo.js";import"./check-WoqjMYuF.js";import"./index-D4HqgO5_.js";import"./en-US-DcoqlHup.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=e("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),q={new:{color:"bg-blue-500",icon:z},in_progress:{color:"bg-yellow-500",icon:P},resolved:{color:"bg-green-500",icon:C},closed:{color:"bg-gray-500",icon:k}},D={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},U=()=>{const{user:e}=s(),[k,C]=a.useState([]),[P,z]=a.useState({total:0,new:0,in_progress:0,resolved:0,closed:0}),[U,L]=a.useState(!0),[V,F]=a.useState(null),[I,O]=a.useState([]),[H,Z]=a.useState(""),[G,K]=a.useState(!1),[Y,J]=a.useState({status:"all",inquiry_type:"all",search:""}),Q=async()=>{L(!0);try{const{data:e}=await t.auth.getSession(),s=e.session?.access_token,a=await t.functions.invoke("manage-contact-submissions",{body:{action:"list",filters:Y},headers:s?{Authorization:`Bearer ${s}`}:{}});if(a.error)throw a.error;C(a.data.submissions||[]),z(a.data.counts||{total:0,new:0,in_progress:0,resolved:0,closed:0})}catch(e){r.error("Failed to load submissions")}finally{L(!1)}},W=async(e,s)=>{try{const{data:a}=await t.auth.getSession(),i=a.session?.access_token,l=await t.functions.invoke("manage-contact-submissions",{body:{action:"update_status",submission_id:e,update_data:s},headers:i?{Authorization:`Bearer ${i}`}:{}});if(l.error)throw l.error;r.success("Submission updated"),Q(),V?.id===e&&F(l.data.submission)}catch(a){r.error("Failed to update submission")}};a.useEffect(()=>{Q()},[Y.status,Y.inquiry_type]),a.useEffect(()=>{const e=setTimeout(()=>{Q()},300);return()=>clearTimeout(e)},[Y.search]),a.useEffect(()=>{const e=t.channel("contact-submissions-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"contact_submissions"},()=>{r.info("New contact submission received"),Q()}).subscribe();return()=>{t.removeChannel(e)}},[]);const X=e=>{F(e),(async e=>{try{const{data:s}=await t.auth.getSession(),a=s.session?.access_token,r=await t.functions.invoke("manage-contact-submissions",{body:{action:"get_details",submission_id:e},headers:a?{Authorization:`Bearer ${a}`}:{}});if(r.error)throw r.error;O(r.data.notes||[])}catch(s){}})(e.id)};return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold",children:"Contact Submissions"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage inquiries from the contact form"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(l,{variant:"outline",onClick:Q,disabled:U,children:[i.jsx(n,{className:"h-4 w-4 mr-2 "+(U?"animate-spin":"")}),"Refresh"]}),i.jsxs(l,{variant:"outline",onClick:async()=>{try{const{data:e}=await t.auth.getSession(),s=e.session?.access_token,a=await t.functions.invoke("manage-contact-submissions",{body:{action:"export_csv",filters:Y},headers:s?{Authorization:`Bearer ${s}`}:{}});if(a.error)throw a.error;const i=new Blob([a.data],{type:"text/csv"}),l=URL.createObjectURL(i),n=document.createElement("a");n.href=l,n.download=`contact_submissions_${T(new Date,"yyyy-MM-dd")}.csv`,n.click(),URL.revokeObjectURL(l),r.success("Export downloaded")}catch(e){r.error("Failed to export")}},children:[i.jsx(_,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[i.jsxs(o,{className:"p-4",children:[i.jsx("div",{className:"text-2xl font-bold",children:P.total}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"})]}),i.jsxs(o,{className:"p-4 border-l-4 border-l-blue-500",children:[i.jsx("div",{className:"text-2xl font-bold",children:P.new}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"New"})]}),i.jsxs(o,{className:"p-4 border-l-4 border-l-yellow-500",children:[i.jsx("div",{className:"text-2xl font-bold",children:P.in_progress}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"In Progress"})]}),i.jsxs(o,{className:"p-4 border-l-4 border-l-green-500",children:[i.jsx("div",{className:"text-2xl font-bold",children:P.resolved}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Resolved"})]}),i.jsxs(o,{className:"p-4 border-l-4 border-l-gray-500",children:[i.jsx("div",{className:"text-2xl font-bold",children:P.closed}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Closed"})]})]}),i.jsx(o,{className:"p-4",children:i.jsxs("div",{className:"flex flex-wrap gap-4",children:[i.jsx("div",{className:"flex-1 min-w-[200px]",children:i.jsxs("div",{className:"relative",children:[i.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),i.jsx(d,{placeholder:"Search by name, email, subject...",value:Y.search,onChange:e=>J({...Y,search:e.target.value}),className:"pl-10"})]})}),i.jsxs(x,{value:Y.status,onValueChange:e=>J({...Y,status:e}),children:[i.jsx(h,{className:"w-[150px]",children:i.jsx(u,{placeholder:"Status"})}),i.jsxs(j,{children:[i.jsx(p,{value:"all",children:"All Status"}),i.jsx(p,{value:"new",children:"New"}),i.jsx(p,{value:"in_progress",children:"In Progress"}),i.jsx(p,{value:"resolved",children:"Resolved"}),i.jsx(p,{value:"closed",children:"Closed"})]})]}),i.jsxs(x,{value:Y.inquiry_type,onValueChange:e=>J({...Y,inquiry_type:e}),children:[i.jsx(h,{className:"w-[150px]",children:i.jsx(u,{placeholder:"Type"})}),i.jsxs(j,{children:[i.jsx(p,{value:"all",children:"All Types"}),i.jsx(p,{value:"general",children:"General"}),i.jsx(p,{value:"sales",children:"Sales"}),i.jsx(p,{value:"support",children:"Support"}),i.jsx(p,{value:"partnership",children:"Partnership"})]})]})]})}),i.jsx(o,{children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{className:"border-b bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left p-4 font-medium",children:"Subject"}),i.jsx("th",{className:"text-left p-4 font-medium",children:"Contact"}),i.jsx("th",{className:"text-left p-4 font-medium",children:"Type"}),i.jsx("th",{className:"text-left p-4 font-medium",children:"Status"}),i.jsx("th",{className:"text-left p-4 font-medium",children:"Priority"}),i.jsx("th",{className:"text-left p-4 font-medium",children:"Date"})]})}),i.jsx("tbody",{children:U?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"p-8 text-center",children:i.jsx(c,{className:"h-6 w-6 animate-spin mx-auto"})})}):0===k.length?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"p-8 text-center text-muted-foreground",children:"No submissions found"})}):k.map(e=>(e.status,i.jsxs("tr",{className:"border-b hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>X(e),children:[i.jsx("td",{className:"p-4",children:i.jsx("div",{className:"font-medium truncate max-w-[300px]",children:e.subject})}),i.jsxs("td",{className:"p-4",children:[i.jsx("div",{className:"text-sm",children:e.full_name}),i.jsx("div",{className:"text-xs text-muted-foreground",children:e.email})]}),i.jsx("td",{className:"p-4",children:i.jsx(m,{variant:"outline",className:"capitalize",children:e.inquiry_type})}),i.jsx("td",{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${q[e.status]?.color}`}),i.jsx("span",{className:"capitalize text-sm",children:e.status.replace("_"," ")})]})}),i.jsx("td",{className:"p-4",children:i.jsx(m,{className:`${D[e.priority]} capitalize`,children:e.priority})}),i.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:T(new Date(e.created_at),"MMM d, yyyy")})]},e.id)))})]})})}),i.jsx(f,{open:!!V,onOpenChange:()=>F(null),children:i.jsxs(g,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(v,{children:[i.jsx(N,{children:V?.subject}),i.jsxs(b,{children:["Submitted on ",V&&T(new Date(V.created_at),"PPP p")]})]}),V&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{children:V.full_name})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("a",{href:`mailto:${V.email}`,className:"text-primary hover:underline",children:V.email})]}),V.phone&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{children:V.phone})]}),V.company&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{children:V.company})]})]}),i.jsxs("div",{children:[i.jsx(w,{className:"text-sm font-medium mb-2 block",children:"Message"}),i.jsx("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:V.message})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(w,{className:"text-sm font-medium mb-2 block",children:"Status"}),i.jsxs(x,{value:V.status,onValueChange:e=>W(V.id,{status:e}),children:[i.jsx(h,{children:i.jsx(u,{})}),i.jsxs(j,{children:[i.jsx(p,{value:"new",children:"New"}),i.jsx(p,{value:"in_progress",children:"In Progress"}),i.jsx(p,{value:"resolved",children:"Resolved"}),i.jsx(p,{value:"closed",children:"Closed"})]})]})]}),i.jsxs("div",{children:[i.jsx(w,{className:"text-sm font-medium mb-2 block",children:"Priority"}),i.jsxs(x,{value:V.priority,onValueChange:e=>W(V.id,{priority:e}),children:[i.jsx(h,{children:i.jsx(u,{})}),i.jsxs(j,{children:[i.jsx(p,{value:"low",children:"Low"}),i.jsx(p,{value:"medium",children:"Medium"}),i.jsx(p,{value:"high",children:"High"}),i.jsx(p,{value:"urgent",children:"Urgent"})]})]})]})]}),i.jsxs("div",{children:[i.jsxs(w,{className:"text-sm font-medium mb-2 block flex items-center gap-2",children:[i.jsx(E,{className:"h-4 w-4"}),"Admin Notes"]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(y,{placeholder:"Add a note...",value:H,onChange:e=>Z(e.target.value),rows:2}),i.jsx(l,{onClick:async()=>{if(H.trim()&&V){K(!0);try{const{data:e}=await t.auth.getSession(),s=e.session?.access_token,a=await t.functions.invoke("manage-contact-submissions",{body:{action:"add_note",submission_id:V.id,note_data:{note:H.trim(),is_internal:!0}},headers:s?{Authorization:`Bearer ${s}`}:{}});if(a.error)throw a.error;O([a.data.note,...I]),Z(""),r.success("Note added")}catch(e){r.error("Failed to add note")}finally{K(!1)}}},disabled:G||!H.trim(),children:G?i.jsx(c,{className:"h-4 w-4 animate-spin"}):"Add"})]}),i.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:0===I.length?i.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No notes yet"}):I.map(e=>i.jsxs("div",{className:"p-3 bg-muted rounded-lg group relative",children:[i.jsx("p",{className:"text-sm",children:e.note}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:T(new Date(e.created_at),"PPP p")}),i.jsx(l,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6",onClick:()=>(async e=>{try{const{data:s}=await t.auth.getSession(),a=s.session?.access_token,i=await t.functions.invoke("manage-contact-submissions",{body:{action:"delete_note",note_id:e},headers:a?{Authorization:`Bearer ${a}`}:{}});if(i.error)throw i.error;O(I.filter(s=>s.id!==e)),r.success("Note deleted")}catch(s){r.error("Failed to delete note")}})(e.id),children:i.jsx(R,{className:"h-3 w-3 text-destructive"})})]},e.id))})]})]})]})]})})]})};export{U as default};
