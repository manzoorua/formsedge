import{c as e,r as t,k as s,s as a,j as r,B as i,C as l,b as c,d,f as n,e as o}from"./main-BQOa5mM0.js";import{I as m}from"./input-COMLYb-C.js";import{L as x}from"./label-B7su6Jaa.js";import{T as h}from"./textarea-Dbo2TYJP.js";import{S as p,a as j,b as f,c as u,d as g}from"./select-DDetsmr9.js";import{B as y}from"./badge-6grXs2Vt.js";import{T as v,a as w,b as N,c as _,d as b,e as C}from"./table-CsUrjkkT.js";import{D as S,f as T,a as F,b as k,c as E,e as q}from"./dialog-Zbmvpzx0.js";import{S as L}from"./switch-CocPZzzC.js";import{S as M}from"./separator-3yH5arB6.js";import{P as D}from"./plus-Bqj9WNI1.js";import{F as P}from"./file-text-WxvKYvjS.js";import{S as z}from"./star-Dd_cckZo.js";import{T as A}from"./trash-2-B0C8EAKm.js";import"./index-C38VFtOl.js";import"./index-CjuUx4b5.js";import"./index-Cff7j1dh.js";import"./chevron-down-BwC0H5jo.js";import"./check-WoqjMYuF.js";import"./index-D4HqgO5_.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=e("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function O(){const[e,O]=t.useState([]),[V,G]=t.useState([]),[H,I]=t.useState(!0),[J,K]=t.useState(!1),[U,Z]=t.useState(""),[$,Q]=t.useState(""),[R,W]=t.useState(""),[X,Y]=t.useState(""),[ee,te]=t.useState(""),[se,ae]=t.useState(!1),[re,ie]=t.useState(!1),{toast:le}=s();t.useEffect(()=>{ce(),de()},[]);const ce=async()=>{try{const{data:e,error:t}=await a.from("form_templates").select("*").order("created_at",{ascending:!1});if(t)throw t;O(e||[])}catch(e){le({title:"Error",description:"Failed to load templates",variant:"destructive"})}},de=async()=>{try{I(!0);const{data:e,error:t}=await a.from("forms").select("id, title, description, status, created_at").eq("status","published").order("created_at",{ascending:!1});if(t)throw t;G(e||[])}catch(e){le({title:"Error",description:"Failed to load forms",variant:"destructive"})}finally{I(!1)}},ne=[...new Set(e.map(e=>e.category))];return new Set(e.flatMap(e=>e.tags||[])),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold",children:"Template Management"}),r.jsx("p",{className:"text-muted-foreground",children:"Create and manage form templates for users"})]}),r.jsxs(S,{open:J,onOpenChange:K,children:[r.jsx(T,{asChild:!0,children:r.jsxs(i,{children:[r.jsx(D,{className:"h-4 w-4 mr-2"}),"Create Template"]})}),r.jsxs(F,{className:"max-w-2xl",children:[r.jsxs(k,{children:[r.jsx(E,{children:"Create New Template"}),r.jsx(q,{children:"Convert an existing published form into a template that users can apply to their new forms."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(x,{htmlFor:"source-form",children:"Source Form"}),r.jsxs(p,{value:U,onValueChange:Z,children:[r.jsx(j,{children:r.jsx(f,{placeholder:"Select a published form"})}),r.jsx(u,{children:V.map(e=>r.jsx(g,{value:e.id,children:e.title},e.id))})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(x,{htmlFor:"template-title",children:"Template Title"}),r.jsx(m,{id:"template-title",value:$,onChange:e=>Q(e.target.value),placeholder:"Enter template title"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(x,{htmlFor:"template-description",children:"Description"}),r.jsx(h,{id:"template-description",value:R,onChange:e=>W(e.target.value),placeholder:"Enter template description",rows:3})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(x,{htmlFor:"template-category",children:"Category"}),r.jsx(m,{id:"template-category",value:X,onChange:e=>Y(e.target.value),placeholder:"e.g., business, survey, contact"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(x,{htmlFor:"template-tags",children:"Tags (comma-separated)"}),r.jsx(m,{id:"template-tags",value:ee,onChange:e=>te(e.target.value),placeholder:"e.g., form, feedback, registration"})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(L,{id:"is-featured",checked:se,onCheckedChange:ae}),r.jsx(x,{htmlFor:"is-featured",children:"Featured Template"})]}),r.jsx(M,{}),r.jsxs("div",{className:"flex justify-end space-x-2",children:[r.jsx(i,{variant:"outline",onClick:()=>K(!1),disabled:re,children:"Cancel"}),r.jsx(i,{onClick:async()=>{if(U&&$.trim())try{ie(!0);const{data:e,error:t}=await a.from("forms").select("*").eq("id",U).single();if(t)throw t;const{data:s,error:r}=await a.from("form_fields").select("*").eq("form_id",U).order("order_index");if(r)throw r;const i={form:{title:e.title,description:e.description,layout:e.layout,branding_enabled:e.branding_enabled,collect_emails:e.collect_emails,primary_color:e.primary_color,secondary_color:e.secondary_color,font_family:e.font_family,thank_you_message:e.thank_you_message},fields:s.map(e=>({type:e.type,label:e.label,description:e.description,placeholder:e.placeholder,required:e.required,width:e.width,options:e.options,validation_rules:e.validation_rules,conditional_logic:e.conditional_logic,calculations:e.calculations,styling:e.styling}))},{error:l}=await a.from("form_templates").insert({title:$.trim(),description:R.trim()||null,category:X.trim()||"general",tags:ee.split(",").map(e=>e.trim()).filter(Boolean),is_featured:se,template_data:i});if(l)throw l;le({title:"Success",description:"Template created successfully!"}),Z(""),Q(""),W(""),Y(""),te(""),ae(!1),K(!1),await ce()}catch(e){le({title:"Error",description:"Failed to create template. Please try again.",variant:"destructive"})}finally{ie(!1)}else le({title:"Error",description:"Please select a form and provide a template title",variant:"destructive"})},disabled:re,children:re?"Creating...":"Create Template"})]})]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs(l,{children:[r.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(d,{className:"text-sm font-medium",children:"Total Templates"}),r.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsx(n,{children:r.jsx("div",{className:"text-2xl font-bold",children:e.length})})]}),r.jsxs(l,{children:[r.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(d,{className:"text-sm font-medium",children:"Featured Templates"}),r.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsx(n,{children:r.jsx("div",{className:"text-2xl font-bold",children:e.filter(e=>e.is_featured).length})})]}),r.jsxs(l,{children:[r.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(d,{className:"text-sm font-medium",children:"Categories"}),r.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsx(n,{children:r.jsx("div",{className:"text-2xl font-bold",children:ne.length})})]})]}),r.jsxs(l,{children:[r.jsxs(c,{children:[r.jsx(d,{children:"Templates"}),r.jsx(o,{children:"Manage existing templates and their settings"})]}),r.jsx(n,{children:H?r.jsx("div",{className:"text-center py-8",children:"Loading templates..."}):0===e.length?r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No templates found. Create your first template to get started."}):r.jsxs(v,{children:[r.jsx(w,{children:r.jsxs(N,{children:[r.jsx(_,{children:"Title"}),r.jsx(_,{children:"Category"}),r.jsx(_,{children:"Tags"}),r.jsx(_,{children:"Status"}),r.jsx(_,{children:"Created"}),r.jsx(_,{children:"Actions"})]})}),r.jsx(b,{children:e.map(e=>r.jsxs(N,{children:[r.jsx(C,{children:r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:e.title}),e.description&&r.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})}),r.jsx(C,{children:r.jsx(y,{variant:"outline",children:e.category})}),r.jsx(C,{children:r.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.tags?.slice(0,2).map(e=>r.jsx(y,{variant:"secondary",className:"text-xs",children:e},e)),e.tags&&e.tags.length>2&&r.jsxs(y,{variant:"secondary",className:"text-xs",children:["+",e.tags.length-2]})]})}),r.jsx(C,{children:e.is_featured?r.jsxs(y,{className:"bg-yellow-100 text-yellow-800 border-yellow-300",children:[r.jsx(z,{className:"h-3 w-3 mr-1"}),"Featured"]}):r.jsx(y,{variant:"outline",children:"Standard"})}),r.jsx(C,{children:new Date(e.created_at).toLocaleDateString()}),r.jsx(C,{children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async(e,t)=>{try{const{error:s}=await a.from("form_templates").update({is_featured:!t}).eq("id",e);if(s)throw s;le({title:"Success",description:`Template ${t?"unfeatured":"featured"} successfully!`}),await ce()}catch(s){le({title:"Error",description:"Failed to update template",variant:"destructive"})}})(e.id,e.is_featured),children:e.is_featured?"Unfeature":"Feature"}),r.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this template?"))try{const{error:t}=await a.from("form_templates").delete().eq("id",e);if(t)throw t;le({title:"Success",description:"Template deleted successfully!"}),await ce()}catch(t){le({title:"Error",description:"Failed to delete template",variant:"destructive"})}})(e.id),children:r.jsx(A,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})}function V(){return r.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold",children:"Form Templates"}),r.jsx("p",{className:"text-muted-foreground",children:"Manage form templates for users"})]}),r.jsx(O,{})]})}export{V as default};
