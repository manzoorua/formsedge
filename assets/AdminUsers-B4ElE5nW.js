import{r as e,k as s,j as t,C as a,b as r,d as i,S as n,e as l,f as c,B as d,s as o}from"./main-BQOa5mM0.js";import{I as m}from"./input-COMLYb-C.js";import{T as x}from"./textarea-Dbo2TYJP.js";import{B as h}from"./badge-6grXs2Vt.js";import{T as u,a as j,b as p,c as f,d as g,e as v}from"./table-CsUrjkkT.js";import{D as y,a as N,b,c as w,e as _}from"./dialog-Zbmvpzx0.js";import{A as S,a as C,b as M,c as k,d as A,e as E,f as U,g as T}from"./alert-dialog-aBH68lDE.js";import{S as D,a as F,b as I,c as $,d as P}from"./select-DDetsmr9.js";import{T as R}from"./trash-2-B0C8EAKm.js";import{S as O}from"./search-BDbiXKhR.js";import{U as z}from"./user-CAryOBTT.js";import{U as H}from"./user-plus-GQG3TCfy.js";import{P as V}from"./plus-Bqj9WNI1.js";import{M as B}from"./message-square-DQzNuabs.js";import{C as K}from"./circle-alert-C_kZuZo4.js";import{f as L}from"./format-CNqjFxb7.js";import"./index-D4HqgO5_.js";import"./index-CjuUx4b5.js";import"./index-C38VFtOl.js";import"./index-Cff7j1dh.js";import"./chevron-down-BwC0H5jo.js";import"./check-WoqjMYuF.js";import"./en-US-DcoqlHup.js";const q=()=>{const[q,J]=e.useState([]),[Q,Z]=e.useState([]),[G,W]=e.useState(null),[X,Y]=e.useState(""),[ee,se]=e.useState(!1),[te,ae]=e.useState(!1),[re,ie]=e.useState(!1),[ne,le]=e.useState(""),[ce,de]=e.useState("low"),[oe,me]=e.useState(!1),[xe,he]=e.useState(!1),[ue,je]=e.useState("admin"),[pe,fe]=e.useState(null),{toast:ge}=s(),ve=async e=>{try{se(!0);const{data:s,error:t}=await o.functions.invoke("admin-user-management",{body:{action:"search",searchQuery:e||X}});if(t)throw t;J(s.users||[])}catch(s){ge({title:"Error",description:"Failed to search users",variant:"destructive"})}finally{se(!1)}},ye=async e=>{try{ie(!0);const{data:s,error:t}=await o.functions.invoke("admin-user-management",{body:{action:"get_user_details",userId:e}});if(t)throw t;W(s.user),me(!0)}catch(s){ge({title:"Error",description:"Failed to load user details",variant:"destructive"})}finally{ie(!1)}},Ne=async()=>{try{ae(!0);const{data:e,error:s}=await o.functions.invoke("admin-user-management",{body:{action:"list_admins"}});if(s)throw s;Z(e.admins||[])}catch(e){ge({title:"Error",description:"Failed to load admin users",variant:"destructive"})}finally{ae(!1)}};e.useEffect(()=>{ve(""),Ne()},[]);const be=e=>t.jsx(h,{variant:"outline",className:{free:"bg-gray-500/10 text-gray-500",pro:"bg-blue-500/10 text-blue-500",enterprise:"bg-purple-500/10 text-purple-500"}[e]||"bg-gray-500/10 text-gray-500",children:e.toUpperCase()}),we=e=>t.jsx(h,{variant:"outline",className:{active:"bg-green-500/10 text-green-500",canceled:"bg-red-500/10 text-red-500",inactive:"bg-gray-500/10 text-gray-500",past_due:"bg-yellow-500/10 text-yellow-500"}[e]||"bg-gray-500/10 text-gray-500",children:e});return t.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"User Management"}),t.jsx("p",{className:"text-muted-foreground",children:"Search and manage user accounts"})]})}),t.jsxs(a,{children:[t.jsxs(r,{children:[t.jsxs(i,{className:"flex items-center gap-2",children:[t.jsx(n,{className:"h-5 w-5"}),"Admin Management"]}),t.jsx(l,{children:"Manage administrator access"})]}),t.jsxs(c,{children:[t.jsxs(u,{children:[t.jsx(j,{children:t.jsxs(p,{children:[t.jsx(f,{children:"Name"}),t.jsx(f,{children:"Email"}),t.jsx(f,{children:"Role"}),t.jsx(f,{children:"Added On"}),t.jsx(f,{children:"Actions"})]})}),t.jsx(g,{children:Q.map(e=>t.jsxs(p,{children:[t.jsx(v,{className:"font-medium",children:e.first_name&&e.last_name?`${e.first_name} ${e.last_name}`:"N/A"}),t.jsx(v,{children:e.email}),t.jsx(v,{children:t.jsx(h,{variant:"outline",className:"bg-purple-500/10 text-purple-500",children:e.role.toUpperCase()})}),t.jsx(v,{children:L(new Date(e.created_at),"MMM d, yyyy")}),t.jsx(v,{children:t.jsxs(d,{size:"sm",variant:"destructive",onClick:()=>fe(e.user_id),children:[t.jsx(R,{className:"h-4 w-4 mr-1"}),"Remove"]})})]},e.id))})]}),0===Q.length&&!te&&t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(n,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No admin users found"})]})]})]}),t.jsxs(a,{children:[t.jsxs(r,{children:[t.jsx(i,{children:"User Directory"}),t.jsx(l,{children:"Search users by email or name"})]}),t.jsxs(c,{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(m,{placeholder:"Search by email or name...",value:X,onChange:e=>Y(e.target.value),onKeyPress:e=>"Enter"===e.key&&ve(),className:"pl-10"})]}),t.jsx(d,{onClick:()=>ve(),disabled:ee,children:ee?"Searching...":"Search"})]}),t.jsxs(u,{children:[t.jsx(j,{children:t.jsxs(p,{children:[t.jsx(f,{children:"User"}),t.jsx(f,{children:"Email"}),t.jsx(f,{children:"Tier"}),t.jsx(f,{children:"Status"}),t.jsx(f,{children:"Forms"}),t.jsx(f,{children:"Responses"}),t.jsx(f,{children:"Joined"}),t.jsx(f,{children:"Actions"})]})}),t.jsx(g,{children:q.map(e=>t.jsxs(p,{children:[t.jsx(v,{className:"font-medium",children:e.first_name&&e.last_name?`${e.first_name} ${e.last_name}`:"N/A"}),t.jsx(v,{children:e.email}),t.jsx(v,{children:be(e.subscription_tier)}),t.jsx(v,{children:we(e.subscription_status)}),t.jsx(v,{children:e.total_forms}),t.jsx(v,{children:e.total_responses}),t.jsx(v,{children:L(new Date(e.created_at),"MMM d, yyyy")}),t.jsx(v,{children:t.jsxs(d,{size:"sm",variant:"outline",onClick:()=>ye(e.id),disabled:re,children:[t.jsx(z,{className:"h-4 w-4 mr-1"}),"Details"]})})]},e.id))})]}),0===q.length&&!ee&&t.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[t.jsx(z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No users found"}),t.jsx("p",{className:"text-sm mt-2",children:"Try searching with different keywords"})]})]})]}),t.jsx(y,{open:oe,onOpenChange:me,children:t.jsxs(N,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(b,{children:[t.jsx(w,{children:"User Details"}),t.jsx(_,{children:"View user information and add support notes"})]}),G&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs(a,{children:[t.jsx(r,{children:t.jsxs(i,{className:"text-base flex items-center justify-between",children:[t.jsx("span",{children:"Account Information"}),(_e=G.id,!Q.some(e=>e.user_id===_e)&&t.jsxs(d,{size:"sm",onClick:()=>he(!0),children:[t.jsx(H,{className:"h-4 w-4 mr-2"}),"Promote to Admin"]}))]})}),t.jsxs(c,{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Name"}),t.jsx("p",{className:"font-medium",children:G.first_name&&G.last_name?`${G.first_name} ${G.last_name}`:"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),t.jsx("p",{className:"font-medium",children:G.email})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Subscription Tier"}),be(G.subscription_tier)]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),we(G.subscription_status)]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Forms"}),t.jsx("p",{className:"font-medium",children:G.total_forms})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Responses"}),t.jsx("p",{className:"font-medium",children:G.total_responses})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Member Since"}),t.jsx("p",{className:"font-medium",children:L(new Date(G.created_at),"MMM d, yyyy")})]}),G.subscription_end&&t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Subscription End"}),t.jsx("p",{className:"font-medium",children:L(new Date(G.subscription_end),"MMM d, yyyy")})]})]})]}),t.jsxs(a,{children:[t.jsx(r,{children:t.jsxs(i,{className:"text-base flex items-center justify-between",children:[t.jsx("span",{children:"Support Notes"}),t.jsxs(h,{variant:"outline",children:[G.support_notes.length," notes"]})]})}),t.jsxs(c,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2 p-4 border rounded-lg bg-muted/30",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(V,{className:"h-4 w-4"}),t.jsx("p",{className:"font-medium",children:"Add New Note"})]}),t.jsx(x,{placeholder:"Enter support note...",value:ne,onChange:e=>le(e.target.value),rows:3}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(D,{value:ce,onValueChange:e=>de(e),children:[t.jsx(F,{className:"w-32",children:t.jsx(I,{})}),t.jsxs($,{children:[t.jsx(P,{value:"low",children:"Low"}),t.jsx(P,{value:"medium",children:"Medium"}),t.jsx(P,{value:"high",children:"High"}),t.jsx(P,{value:"critical",children:"Critical"})]})]}),t.jsx(d,{onClick:async()=>{if(G&&ne.trim())try{const{error:e}=await o.functions.invoke("admin-user-management",{body:{action:"add_support_note",userId:G.id,noteData:{note:ne,priority:ce}}});if(e)throw e;ge({title:"Success",description:"Support note added successfully"}),le(""),de("low"),ye(G.id)}catch(e){ge({title:"Error",description:"Failed to add support note",variant:"destructive"})}},disabled:!ne.trim(),children:"Add Note"})]})]}),t.jsxs("div",{className:"space-y-3",children:[G.support_notes.map(e=>{return t.jsxs("div",{className:"p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[(s=e.priority,t.jsx(h,{variant:"outline",className:{low:"bg-blue-500/10 text-blue-500",medium:"bg-yellow-500/10 text-yellow-500",high:"bg-orange-500/10 text-orange-500",critical:"bg-red-500/10 text-red-500"}[s]||"bg-gray-500/10 text-gray-500",children:s.toUpperCase()})),t.jsxs("span",{className:"text-sm text-muted-foreground",children:["by ",e.admin_email," â€¢ ",L(new Date(e.created_at),"MMM d, yyyy HH:mm")]})]}),t.jsx(d,{size:"sm",variant:"ghost",onClick:()=>(async e=>{if(G)try{const{error:s}=await o.functions.invoke("admin-user-management",{body:{action:"delete_support_note",noteId:e}});if(s)throw s;ge({title:"Success",description:"Support note deleted successfully"}),ye(G.id)}catch(s){ge({title:"Error",description:"Failed to delete support note",variant:"destructive"})}})(e.id),children:t.jsx(R,{className:"h-4 w-4"})})]}),t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.note})]},e.id);var s}),0===G.support_notes.length&&t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(B,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No support notes yet"})]})]})]})]})]})]})}),t.jsx(S,{open:xe,onOpenChange:he,children:t.jsxs(C,{children:[t.jsxs(M,{children:[t.jsx(k,{children:"Promote User to Administrator"}),t.jsxs(A,{children:["Select the admin role for ",G?.email,". This action will grant administrative privileges."]})]}),t.jsx("div",{className:"py-4",children:t.jsxs(D,{value:ue,onValueChange:e=>je(e),children:[t.jsx(F,{children:t.jsx(I,{})}),t.jsxs($,{children:[t.jsx(P,{value:"admin",children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:"Admin"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Full system access"})]})}),t.jsx(P,{value:"moderator",children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:"Moderator"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Limited admin access"})]})})]})]})}),t.jsxs(E,{children:[t.jsx(U,{children:"Cancel"}),t.jsx(T,{onClick:async()=>{if(G)try{const{error:e}=await o.functions.invoke("admin-user-management",{body:{action:"promote_to_admin",targetUserId:G.id,role:ue}});if(e)throw e;ge({title:"Success",description:`User promoted to ${ue} successfully`}),he(!1),me(!1),Ne()}catch(e){ge({title:"Error",description:e.message||"Failed to promote user",variant:"destructive"})}},children:"Promote"})]})]})}),t.jsx(S,{open:!!pe,onOpenChange:e=>!e&&fe(null),children:t.jsxs(C,{children:[t.jsxs(M,{children:[t.jsxs(k,{className:"flex items-center gap-2",children:[t.jsx(K,{className:"h-5 w-5 text-destructive"}),"Remove Administrator Access"]}),t.jsx(A,{children:"This will remove admin privileges from this user. They will lose access to all admin features immediately. This action cannot be undone."})]}),t.jsxs(E,{children:[t.jsx(U,{children:"Cancel"}),t.jsx(T,{onClick:()=>pe&&(async e=>{try{const{error:s}=await o.functions.invoke("admin-user-management",{body:{action:"remove_admin",adminUserId:e}});if(s)throw s;ge({title:"Success",description:"Admin access removed successfully"}),fe(null),Ne()}catch(s){ge({title:"Error",description:s.message||"Failed to remove admin access",variant:"destructive"})}})(pe),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove Admin"})]})]})})]});var _e};export{q as default};
