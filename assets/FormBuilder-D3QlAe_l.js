var e=Object.defineProperty,t=(t,r,n)=>((t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n)(t,"symbol"!=typeof r?r+"":r,n);import{c as r,r as n,R as a,t as s,v as i,j as o,p as l,B as c,L as d,C as u,b as m,d as h,f,w as p,x as g,y as v,z as x,D as b,P as y,E as j,F as w,G as N,H as k,I as C,J as S,K as _,M as D,O as E,X as R,A as I,q as F,u as M,s as A,h as z,Q as P,U as L,V as T,W as O,i as U,a as $,T as V,Y as q,Z as B}from"./main-BQOa5mM0.js";import{I as H}from"./input-COMLYb-C.js";import{S as Y,a as W,b as G,c as X,d as K}from"./select-DDetsmr9.js";import{B as J}from"./badge-6grXs2Vt.js";import{C as Z}from"./clock-BGkZXTj0.js";import{C as Q}from"./circle-alert-C_kZuZo4.js";import{C as ee}from"./circle-check-Ccyr716G.js";import{t as te,c as re,n as ne,g as ae,e as se,m as ie,a as oe,b as le}from"./en-US-DcoqlHup.js";import{E as ce}from"./eye-Bq8mO4No.js";import{F as de}from"./file-text-WxvKYvjS.js";import{T as ue}from"./ThemeToggle-B4EQrceX.js";import{A as me}from"./arrow-left-BoD24ioV.js";import{L as he,E as fe,T as pe}from"./tablet-TgMF4u50.js";import{S as ge}from"./settings-CSYLqhyU.js";import{S as ve}from"./save-BPJYkrST.js";import{L as xe,u as be}from"./useConditionalLogic-Domhckc1.js";import{F as ye,u as je,U as we,S as Ne}from"./FieldRenderer-CugH2gNC.js";import{C as ke}from"./copy-BZksGIXa.js";import{T as Ce}from"./trash-2-B0C8EAKm.js";import{L as Se}from"./label-B7su6Jaa.js";import{S as _e}from"./switch-CocPZzzC.js";import{S as De}from"./scroll-area-C89FDXlH.js";import{T as Ee,a as Re,b as Ie,c as Fe}from"./tabs-BbGbqsLR.js";import{S as Me}from"./separator-3yH5arB6.js";import{P as Ae}from"./plus-Bqj9WNI1.js";import{T as ze}from"./textarea-Dbo2TYJP.js";import{h as Pe,R as Le,u as Te,F as Oe}from"./index-CjuUx4b5.js";import{S as Ue}from"./sparkles-CpkCaYAf.js";import{S as $e}from"./smartphone-ewxUynRR.js";import{M as Ve}from"./monitor-BXsJ4oWe.js";import{P as qe}from"./palette-COzljtFc.js";import{I as Be,E as He}from"./image-BHv6KYgW.js";import{C as Ye}from"./checkbox-CljSm3_p.js";import{P as We}from"./phone-DTqSRSbI.js";import{C as Ge}from"./calendar-BcqkHMaS.js";import{C as Xe}from"./chevron-down-BwC0H5jo.js";import{S as Ke}from"./star-Dd_cckZo.js";import{C as Je}from"./code-Bh0iG-EL.js";import{A as Ze}from"./arrow-right-uAsXqwNa.js";import{D as Qe,a as et,b as tt,c as rt}from"./dialog-Zbmvpzx0.js";import{u as nt}from"./useRecall-BxAtNLKx.js";import{C as at}from"./circle-check-big-BImW7D2D.js";import{U as st}from"./users-DfZDw2qr.js";import"./index-C38VFtOl.js";import"./index-Cff7j1dh.js";import"./check-WoqjMYuF.js";import"./sun-oLtT9Ef9.js";import"./radio-group-BjltNDB1.js";import"./index-_nftuPOU.js";import"./circle-BfUTHkiN.js";import"./index-CuckYF6g.js";import"./index-D4HqgO5_.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=r("AlignCenter",[["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 18H5",key:"18s9l3"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]),ot=r("AlignLeft",[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]),lt=r("AlignRight",[["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 18H7",key:"1ygte8"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]),ct=r("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),dt=r("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),ut=r("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),mt=r("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),ht=r("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),ft=r("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),pt=r("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),gt=r("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),vt=r("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),xt=r("PenTool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]),bt=r("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),yt=r("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),jt=r("SlidersVertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),wt=r("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Nt=r("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),kt=r("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Ct=r("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function St(e,t){const r=+te(e)-+te(t);return r<0?-1:r>0?1:r}function _t(e,t){const r=te(e,t?.in);return+function(e,t){const r=te(e,t?.in);return r.setHours(23,59,59,999),r}(r,t)===+function(e,t){const r=te(e,t?.in),n=r.getMonth();return r.setFullYear(r.getFullYear(),n+1,0),r.setHours(23,59,59,999),r}(r,t)}function Dt(e,t,r){const[n,a,s]=ne(r?.in,e,e,t),i=St(a,s),o=Math.abs(function(e,t,r){const[n,a]=ne(r?.in,e,t);return 12*(n.getFullYear()-a.getFullYear())+(n.getMonth()-a.getMonth())}(a,s));if(o<1)return 0;1===a.getMonth()&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-i*o);let l=St(a,s)===-i;_t(n)&&1===o&&1===St(n,s)&&(l=!1);const c=i*(o-+l);return 0===c?0:c}function Et(e,t,r){const n=function(e,t){return+te(e)-+te(t)}(e,t)/1e3;return(a=r?.roundingMethod,e=>{const t=(a?Math[a]:Math.trunc)(e);return 0===t?0:t})(n);var a}function Rt(e,t){return function(e,t,r){const n=le(),a=r?.locale??n.locale??se,s=St(e,t);if(isNaN(s))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:s}),[o,l]=ne(r?.in,...s>0?[t,e]:[e,t]),c=Et(l,o),d=(ae(l)-ae(o))/1e3,u=Math.round((c-d)/60);let m;if(u<2)return r?.includeSeconds?c<5?a.formatDistance("lessThanXSeconds",5,i):c<10?a.formatDistance("lessThanXSeconds",10,i):c<20?a.formatDistance("lessThanXSeconds",20,i):c<40?a.formatDistance("halfAMinute",0,i):c<60?a.formatDistance("lessThanXMinutes",1,i):a.formatDistance("xMinutes",1,i):0===u?a.formatDistance("lessThanXMinutes",1,i):a.formatDistance("xMinutes",u,i);if(u<45)return a.formatDistance("xMinutes",u,i);if(u<90)return a.formatDistance("aboutXHours",1,i);if(u<ie){const e=Math.round(u/60);return a.formatDistance("aboutXHours",e,i)}if(u<2520)return a.formatDistance("xDays",1,i);if(u<oe){const e=Math.round(u/ie);return a.formatDistance("xDays",e,i)}if(u<2*oe)return m=Math.round(u/oe),a.formatDistance("aboutXMonths",m,i);if(m=Dt(l,o),m<12){const e=Math.round(u/oe);return a.formatDistance("xMonths",e,i)}{const e=m%12,t=Math.trunc(m/12);return e<3?a.formatDistance("aboutXYears",t,i):e<9?a.formatDistance("overXYears",t,i):a.formatDistance("almostXYears",t+1,i)}}(e,function(e){return re(e,Date.now())}(e),t)}const It="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function Ft(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function Mt(e){return"nodeType"in e}function At(e){var t,r;return e?Ft(e)?e:Mt(e)&&null!=(t=null==(r=e.ownerDocument)?void 0:r.defaultView)?t:window:window}function zt(e){const{Document:t}=At(e);return e instanceof t}function Pt(e){return!Ft(e)&&e instanceof At(e).HTMLElement}function Lt(e){return e instanceof At(e).SVGElement}function Tt(e){return e?Ft(e)?e.document:Mt(e)?zt(e)?e:Pt(e)||Lt(e)?e.ownerDocument:document:document:document}const Ot=It?n.useLayoutEffect:n.useEffect;function Ut(e){const t=n.useRef(e);return Ot(()=>{t.current=e}),n.useCallback(function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return null==t.current?void 0:t.current(...r)},[])}function $t(e,t){void 0===t&&(t=[e]);const r=n.useRef(e);return Ot(()=>{r.current!==e&&(r.current=e)},t),r}function Vt(e,t){const r=n.useRef();return n.useMemo(()=>{const t=e(r.current);return r.current=t,t},[...t])}function qt(e){const t=Ut(e),r=n.useRef(null),a=n.useCallback(e=>{e!==r.current&&(null==t||t(e,r.current)),r.current=e},[]);return[r,a]}function Bt(e){const t=n.useRef();return n.useEffect(()=>{t.current=e},[e]),t.current}let Ht={};function Yt(e,t){return n.useMemo(()=>{if(t)return t;const r=null==Ht[e]?0:Ht[e]+1;return Ht[e]=r,e+"-"+r},[e,t])}function Wt(e){return function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return n.reduce((t,r)=>{const n=Object.entries(r);for(const[a,s]of n){const r=t[a];null!=r&&(t[a]=r+e*s)}return t},{...t})}}const Gt=Wt(1),Xt=Wt(-1);function Kt(e){if(!e)return!1;const{KeyboardEvent:t}=At(e.target);return t&&e instanceof t}function Jt(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=At(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:r}=e.touches[0];return{x:t,y:r}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:r}=e.changedTouches[0];return{x:t,y:r}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const Zt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:r}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:r}=e;return"scaleX("+t+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[Zt.Translate.toString(e),Zt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:r,easing:n}=e;return t+" "+r+"ms "+n}}}),Qt="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function er(e){return e.matches(Qt)?e:e.querySelector(Qt)}const tr={display:"none"};function rr(e){let{id:t,value:r}=e;return a.createElement("div",{id:t,style:tr},r)}function nr(e){let{id:t,announcement:r,ariaLiveType:n="assertive"}=e;return a.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":n,"aria-atomic":!0},r)}const ar=n.createContext(null);const sr={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},ir={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was moved over droppable area "+r.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was dropped over droppable area "+r.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function or(e){let{announcements:t=ir,container:r,hiddenTextDescribedById:i,screenReaderInstructions:o=sr}=e;const{announce:l,announcement:c}=function(){const[e,t]=n.useState("");return{announce:n.useCallback(e=>{null!=e&&t(e)},[]),announcement:e}}(),d=Yt("DndLiveRegion"),[u,m]=n.useState(!1);if(n.useEffect(()=>{m(!0)},[]),function(e){const t=n.useContext(ar);n.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}(n.useMemo(()=>({onDragStart(e){let{active:r}=e;l(t.onDragStart({active:r}))},onDragMove(e){let{active:r,over:n}=e;t.onDragMove&&l(t.onDragMove({active:r,over:n}))},onDragOver(e){let{active:r,over:n}=e;l(t.onDragOver({active:r,over:n}))},onDragEnd(e){let{active:r,over:n}=e;l(t.onDragEnd({active:r,over:n}))},onDragCancel(e){let{active:r,over:n}=e;l(t.onDragCancel({active:r,over:n}))}}),[l,t])),!u)return null;const h=a.createElement(a.Fragment,null,a.createElement(rr,{id:i,value:o.draggable}),a.createElement(nr,{id:d,announcement:c}));return r?s.createPortal(h,r):h}var lr,cr;function dr(){}(cr=lr||(lr={})).DragStart="dragStart",cr.DragMove="dragMove",cr.DragEnd="dragEnd",cr.DragCancel="dragCancel",cr.DragOver="dragOver",cr.RegisterDroppable="registerDroppable",cr.SetDroppableDisabled="setDroppableDisabled",cr.UnregisterDroppable="unregisterDroppable";const ur=Object.freeze({x:0,y:0});function mr(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function hr(e,t){let{data:{value:r}}=e,{data:{value:n}}=t;return r-n}function fr(e,t){let{data:{value:r}}=e,{data:{value:n}}=t;return n-r}function pr(e){let{left:t,top:r,height:n,width:a}=e;return[{x:t,y:r},{x:t+a,y:r},{x:t,y:r+n},{x:t+a,y:r+n}]}function gr(e,t,r){return void 0===t&&(t=e.left),void 0===r&&(r=e.top),{x:t+.5*e.width,y:r+.5*e.height}}function vr(e,t){const r=Math.max(t.top,e.top),n=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),i=a-n,o=s-r;if(n<a&&r<s){const r=t.width*t.height,n=e.width*e.height,a=i*o;return Number((a/(r+n-a)).toFixed(4))}return 0}const xr=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:n}=e;const a=[];for(const s of n){const{id:e}=s,n=r.get(e);if(n){const r=vr(n,t);r>0&&a.push({id:e,data:{droppableContainer:s,value:r}})}}return a.sort(fr)};function br(e,t){const{top:r,left:n,bottom:a,right:s}=t;return r<=e.y&&e.y<=a&&n<=e.x&&e.x<=s}function yr(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ur}function jr(e){return function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return n.reduce((t,r)=>({...t,top:t.top+e*r.y,bottom:t.bottom+e*r.y,left:t.left+e*r.x,right:t.right+e*r.x}),{...t})}}const wr=jr(1);const Nr={ignoreTransform:!1};function kr(e,t){void 0===t&&(t=Nr);let r=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:n}=At(e).getComputedStyle(e);t&&(r=function(e,t,r){const n=function(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!n)return e;const{scaleX:a,scaleY:s,x:i,y:o}=n,l=e.left-i-(1-a)*parseFloat(r),c=e.top-o-(1-s)*parseFloat(r.slice(r.indexOf(" ")+1)),d=a?e.width/a:e.width,u=s?e.height/s:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(r,t,n))}const{top:n,left:a,width:s,height:i,bottom:o,right:l}=r;return{top:n,left:a,width:s,height:i,bottom:o,right:l}}function Cr(e){return kr(e,{ignoreTransform:!0})}function Sr(e,t){const r=[];return e?function n(a){if(null!=t&&r.length>=t)return r;if(!a)return r;if(zt(a)&&null!=a.scrollingElement&&!r.includes(a.scrollingElement))return r.push(a.scrollingElement),r;if(!Pt(a)||Lt(a))return r;if(r.includes(a))return r;const s=At(e).getComputedStyle(a);return a!==e&&function(e,t){void 0===t&&(t=At(e).getComputedStyle(e));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const n=t[e];return"string"==typeof n&&r.test(n)})}(a,s)&&r.push(a),function(e,t){return void 0===t&&(t=At(e).getComputedStyle(e)),"fixed"===t.position}(a,s)?r:n(a.parentNode)}(e):r}function _r(e){const[t]=Sr(e,1);return null!=t?t:null}function Dr(e){return It&&e?Ft(e)?e:Mt(e)?zt(e)||e===Tt(e).scrollingElement?window:Pt(e)?e:null:null:null}function Er(e){return Ft(e)?e.scrollX:e.scrollLeft}function Rr(e){return Ft(e)?e.scrollY:e.scrollTop}function Ir(e){return{x:Er(e),y:Rr(e)}}var Fr,Mr;function Ar(e){return!(!It||!e)&&e===document.scrollingElement}function zr(e){const t={x:0,y:0},r=Ar(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},n={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=n.y,isRight:e.scrollLeft>=n.x,maxScroll:n,minScroll:t}}(Mr=Fr||(Fr={}))[Mr.Forward=1]="Forward",Mr[Mr.Backward=-1]="Backward";const Pr={x:.2,y:.2};function Lr(e,t,r,n,a){let{top:s,left:i,right:o,bottom:l}=r;void 0===n&&(n=10),void 0===a&&(a=Pr);const{isTop:c,isBottom:d,isLeft:u,isRight:m}=zr(e),h={x:0,y:0},f={x:0,y:0},p=t.height*a.y,g=t.width*a.x;return!c&&s<=t.top+p?(h.y=Fr.Backward,f.y=n*Math.abs((t.top+p-s)/p)):!d&&l>=t.bottom-p&&(h.y=Fr.Forward,f.y=n*Math.abs((t.bottom-p-l)/p)),!m&&o>=t.right-g?(h.x=Fr.Forward,f.x=n*Math.abs((t.right-g-o)/g)):!u&&i<=t.left+g&&(h.x=Fr.Backward,f.x=n*Math.abs((t.left+g-i)/g)),{direction:h,speed:f}}function Tr(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:r,right:n,bottom:a}=e.getBoundingClientRect();return{top:t,left:r,right:n,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Or(e){return e.reduce((e,t)=>Gt(e,Ir(t)),ur)}const Ur=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+Er(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+Rr(t),0)}]];class $r{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Sr(t),n=Or(r);this.rect={...e},this.width=e.width,this.height=e.height;for(const[a,s,i]of Ur)for(const e of s)Object.defineProperty(this,e,{get:()=>{const t=i(r),s=n[a]-t;return this.rect[e]+s},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Vr{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,r){var n;null==(n=this.target)||n.addEventListener(e,t,r),this.listeners.push([e,t,r])}}function qr(e,t){const r=Math.abs(e.x),n=Math.abs(e.y);return"number"==typeof t?Math.sqrt(r**2+n**2)>t:"x"in t&&"y"in t?r>t.x&&n>t.y:"x"in t?r>t.x:"y"in t&&n>t.y}var Br,Hr,Yr,Wr;function Gr(e){e.preventDefault()}function Xr(e){e.stopPropagation()}(Hr=Br||(Br={})).Click="click",Hr.DragStart="dragstart",Hr.Keydown="keydown",Hr.ContextMenu="contextmenu",Hr.Resize="resize",Hr.SelectionChange="selectionchange",Hr.VisibilityChange="visibilitychange",(Wr=Yr||(Yr={})).Space="Space",Wr.Down="ArrowDown",Wr.Right="ArrowRight",Wr.Left="ArrowLeft",Wr.Up="ArrowUp",Wr.Esc="Escape",Wr.Enter="Enter",Wr.Tab="Tab";const Kr={start:[Yr.Space,Yr.Enter],cancel:[Yr.Esc],end:[Yr.Space,Yr.Enter,Yr.Tab]},Jr=(e,t)=>{let{currentCoordinates:r}=t;switch(e.code){case Yr.Right:return{...r,x:r.x+25};case Yr.Left:return{...r,x:r.x-25};case Yr.Down:return{...r,y:r.y+25};case Yr.Up:return{...r,y:r.y-25}}};class Zr{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Vr(Tt(t)),this.windowListeners=new Vr(At(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Br.Resize,this.handleCancel),this.windowListeners.add(Br.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Br.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,r=e.node.current;r&&function(e,t){if(void 0===t&&(t=kr),!e)return;const{top:r,left:n,bottom:a,right:s}=t(e);_r(e)&&(a<=0||s<=0||r>=window.innerHeight||n>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(r),t(ur)}handleKeyDown(e){if(Kt(e)){const{active:t,context:r,options:n}=this.props,{keyboardCodes:a=Kr,coordinateGetter:s=Jr,scrollBehavior:i="smooth"}=n,{code:o}=e;if(a.end.includes(o))return void this.handleEnd(e);if(a.cancel.includes(o))return void this.handleCancel(e);const{collisionRect:l}=r.current,c=l?{x:l.left,y:l.top}:ur;this.referenceCoordinates||(this.referenceCoordinates=c);const d=s(e,{active:t,context:r.current,currentCoordinates:c});if(d){const t=Xt(d,c),n={x:0,y:0},{scrollableAncestors:a}=r.current;for(const r of a){const a=e.code,{isTop:s,isRight:o,isLeft:l,isBottom:c,maxScroll:u,minScroll:m}=zr(r),h=Tr(r),f={x:Math.min(a===Yr.Right?h.right-h.width/2:h.right,Math.max(a===Yr.Right?h.left:h.left+h.width/2,d.x)),y:Math.min(a===Yr.Down?h.bottom-h.height/2:h.bottom,Math.max(a===Yr.Down?h.top:h.top+h.height/2,d.y))},p=a===Yr.Right&&!o||a===Yr.Left&&!l,g=a===Yr.Down&&!c||a===Yr.Up&&!s;if(p&&f.x!==d.x){const e=r.scrollLeft+t.x,s=a===Yr.Right&&e<=u.x||a===Yr.Left&&e>=m.x;if(s&&!t.y)return void r.scrollTo({left:e,behavior:i});n.x=s?r.scrollLeft-e:a===Yr.Right?r.scrollLeft-u.x:r.scrollLeft-m.x,n.x&&r.scrollBy({left:-n.x,behavior:i});break}if(g&&f.y!==d.y){const e=r.scrollTop+t.y,s=a===Yr.Down&&e<=u.y||a===Yr.Up&&e>=m.y;if(s&&!t.x)return void r.scrollTo({top:e,behavior:i});n.y=s?r.scrollTop-e:a===Yr.Down?r.scrollTop-u.y:r.scrollTop-m.y,n.y&&r.scrollBy({top:-n.y,behavior:i});break}}this.handleMove(e,Gt(Xt(d,this.referenceCoordinates),n))}}}handleMove(e,t){const{onMove:r}=this.props;e.preventDefault(),r(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function Qr(e){return Boolean(e&&"distance"in e)}function en(e){return Boolean(e&&"delay"in e)}Zr.activators=[{eventName:"onKeyDown",handler:(e,t,r)=>{let{keyboardCodes:n=Kr,onActivation:a}=t,{active:s}=r;const{code:i}=e.nativeEvent;if(n.start.includes(i)){const t=s.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==a||a({event:e.nativeEvent}),!0)}return!1}}];class tn{constructor(e,t,r){var n;void 0===r&&(r=function(e){const{EventTarget:t}=At(e);return e instanceof t?e:Tt(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:a}=e,{target:s}=a;this.props=e,this.events=t,this.document=Tt(s),this.documentListeners=new Vr(this.document),this.listeners=new Vr(r),this.windowListeners=new Vr(At(s)),this.initialCoordinates=null!=(n=Jt(a))?n:ur,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Br.Resize,this.handleCancel),this.windowListeners.add(Br.DragStart,Gr),this.windowListeners.add(Br.VisibilityChange,this.handleCancel),this.windowListeners.add(Br.ContextMenu,Gr),this.documentListeners.add(Br.Keydown,this.handleKeydown),t){if(null!=r&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(en(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(Qr(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:r,onPending:n}=this.props;n(r,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Br.Click,Xr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Br.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:r,initialCoordinates:n,props:a}=this,{onMove:s,options:{activationConstraint:i}}=a;if(!n)return;const o=null!=(t=Jt(e))?t:ur,l=Xt(n,o);if(!r&&i){if(Qr(i)){if(null!=i.tolerance&&qr(l,i.tolerance))return this.handleCancel();if(qr(l,i.distance))return this.handleStart()}return en(i)&&qr(l,i.tolerance)?this.handleCancel():void this.handlePending(i,l)}e.cancelable&&e.preventDefault(),s(o)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Yr.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const rn={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class nn extends tn{constructor(e){const{event:t}=e,r=Tt(t.target);super(e,rn,r)}}nn.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:n}=t;return!(!r.isPrimary||0!==r.button)&&(null==n||n({event:r}),!0)}}];const an={move:{name:"mousemove"},end:{name:"mouseup"}};var sn,on;(on=sn||(sn={}))[on.RightClick=2]="RightClick";(class extends tn{constructor(e){super(e,an,Tt(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:n}=t;return r.button!==sn.RightClick&&(null==n||n({event:r}),!0)}}];const ln={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var cn,dn,un,mn;function hn(e){let{acceleration:t,activator:r=cn.Pointer,canScroll:a,draggingRect:s,enabled:i,interval:o=5,order:l=un.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:m,threshold:h}=e;const f=function(e){let{delta:t,disabled:r}=e;const n=Bt(t);return Vt(e=>{if(r||!n||!e)return fn;const a={x:Math.sign(t.x-n.x),y:Math.sign(t.y-n.y)};return{x:{[Fr.Backward]:e.x[Fr.Backward]||-1===a.x,[Fr.Forward]:e.x[Fr.Forward]||1===a.x},y:{[Fr.Backward]:e.y[Fr.Backward]||-1===a.y,[Fr.Forward]:e.y[Fr.Forward]||1===a.y}}},[r,t,n])}({delta:m,disabled:!i}),[p,g]=function(){const e=n.useRef(null);return[n.useCallback((t,r)=>{e.current=setInterval(t,r)},[]),n.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),v=n.useRef({x:0,y:0}),x=n.useRef({x:0,y:0}),b=n.useMemo(()=>{switch(r){case cn.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case cn.DraggableRect:return s}},[r,s,c]),y=n.useRef(null),j=n.useCallback(()=>{const e=y.current;if(!e)return;const t=v.current.x*x.current.x,r=v.current.y*x.current.y;e.scrollBy(t,r)},[]),w=n.useMemo(()=>l===un.TreeOrder?[...d].reverse():d,[l,d]);n.useEffect(()=>{if(i&&d.length&&b){for(const e of w){if(!1===(null==a?void 0:a(e)))continue;const r=d.indexOf(e),n=u[r];if(!n)continue;const{direction:s,speed:i}=Lr(e,n,b,t,h);for(const e of["x","y"])f[e][s[e]]||(i[e]=0,s[e]=0);if(i.x>0||i.y>0)return g(),y.current=e,p(j,o),v.current=i,void(x.current=s)}v.current={x:0,y:0},x.current={x:0,y:0},g()}else g()},[t,j,a,g,i,o,JSON.stringify(b),JSON.stringify(f),p,d,w,u,JSON.stringify(h)])}(class extends tn{constructor(e){super(e,ln)}static setup(){return window.addEventListener(ln.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(ln.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:n}=t;const{touches:a}=r;return!(a.length>1)&&(null==n||n({event:r}),!0)}}],(dn=cn||(cn={}))[dn.Pointer=0]="Pointer",dn[dn.DraggableRect=1]="DraggableRect",(mn=un||(un={}))[mn.TreeOrder=0]="TreeOrder",mn[mn.ReversedTreeOrder=1]="ReversedTreeOrder";const fn={x:{[Fr.Backward]:!1,[Fr.Forward]:!1},y:{[Fr.Backward]:!1,[Fr.Forward]:!1}};var pn,gn,vn;(gn=pn||(pn={}))[gn.Always=0]="Always",gn[gn.BeforeDragging=1]="BeforeDragging",gn[gn.WhileDragging=2]="WhileDragging",(vn||(vn={})).Optimized="optimized";const xn=new Map;function bn(e,t){return Vt(r=>e?r||("function"==typeof t?t(e):e):null,[t,e])}function yn(e){let{callback:t,disabled:r}=e;const a=Ut(t),s=n.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(a)},[r]);return n.useEffect(()=>()=>null==s?void 0:s.disconnect(),[s]),s}function jn(e){return new $r(kr(e),e)}function wn(e,t,r){void 0===t&&(t=jn);const[a,s]=n.useState(null);function i(){s(n=>{if(!e)return null;var a;if(!1===e.isConnected)return null!=(a=null!=n?n:r)?a:null;const s=t(e);return JSON.stringify(n)===JSON.stringify(s)?n:s})}const o=function(e){let{callback:t,disabled:r}=e;const a=Ut(t),s=n.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(a)},[a,r]);return n.useEffect(()=>()=>null==s?void 0:s.disconnect(),[s]),s}({callback(t){if(e)for(const r of t){const{type:t,target:n}=r;if("childList"===t&&n instanceof HTMLElement&&n.contains(e)){i();break}}}}),l=yn({callback:i});return Ot(()=>{i(),e?(null==l||l.observe(e),null==o||o.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==o||o.disconnect())},[e]),a}const Nn=[];function kn(e,t){void 0===t&&(t=[]);const r=n.useRef(null);return n.useEffect(()=>{r.current=null},t),n.useEffect(()=>{const t=e!==ur;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?Xt(e,r.current):ur}function Cn(e){return n.useMemo(()=>e?function(e){const t=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:t,bottom:r,width:t,height:r}}(e):null,[e])}const Sn=[];function _n(e){let{measure:t}=e;const[r,a]=n.useState(null),s=yn({callback:n.useCallback(e=>{for(const{target:r}of e)if(Pt(r)){a(e=>{const n=t(r);return e?{...e,width:n.width,height:n.height}:n});break}},[t])}),i=n.useCallback(e=>{const r=function(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Pt(t)?t:e}(e);null==s||s.disconnect(),r&&(null==s||s.observe(r)),a(r?t(r):null)},[t,s]),[o,l]=qt(i);return n.useMemo(()=>({nodeRef:o,rect:r,setRef:l}),[r,o,l])}const Dn=[{sensor:nn,options:{}},{sensor:Zr,options:{}}],En={current:{}},Rn={draggable:{measure:Cr},droppable:{measure:Cr,strategy:pn.WhileDragging,frequency:vn.Optimized},dragOverlay:{measure:kr}};class In extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,r;return null!=(t=null==(r=this.get(e))?void 0:r.node.current)?t:void 0}}const Fn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new In,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:dr},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Rn,measureDroppableContainers:dr,windowRect:null,measuringScheduled:!1},Mn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:dr,draggableNodes:new Map,over:null,measureDroppableContainers:dr},An=n.createContext(Mn),zn=n.createContext(Fn);function Pn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new In}}}function Ln(e,t){switch(t.type){case lr.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case lr.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case lr.DragEnd:case lr.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case lr.RegisterDroppable:{const{element:r}=t,{id:n}=r,a=new In(e.droppable.containers);return a.set(n,r),{...e,droppable:{...e.droppable,containers:a}}}case lr.SetDroppableDisabled:{const{id:r,key:n,disabled:a}=t,s=e.droppable.containers.get(r);if(!s||n!==s.key)return e;const i=new In(e.droppable.containers);return i.set(r,{...s,disabled:a}),{...e,droppable:{...e.droppable,containers:i}}}case lr.UnregisterDroppable:{const{id:r,key:n}=t,a=e.droppable.containers.get(r);if(!a||n!==a.key)return e;const s=new In(e.droppable.containers);return s.delete(r),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function Tn(e){let{disabled:t}=e;const{active:r,activatorEvent:a,draggableNodes:s}=n.useContext(An),i=Bt(a),o=Bt(null==r?void 0:r.id);return n.useEffect(()=>{if(!t&&!a&&i&&null!=o){if(!Kt(i))return;if(document.activeElement===i.target)return;const e=s.get(o);if(!e)return;const{activatorNode:t,node:r}=e;if(!t.current&&!r.current)return;requestAnimationFrame(()=>{for(const e of[t.current,r.current]){if(!e)continue;const t=er(e);if(t){t.focus();break}}})}},[a,t,s,o,i]),null}const On=n.createContext({...ur,scaleX:1,scaleY:1});var Un,$n;($n=Un||(Un={}))[$n.Uninitialized=0]="Uninitialized",$n[$n.Initializing=1]="Initializing",$n[$n.Initialized=2]="Initialized";const Vn=n.memo(function(e){var t,r,i,o;let{id:l,accessibility:c,autoScroll:d=!0,children:u,sensors:m=Dn,collisionDetection:h=xr,measuring:f,modifiers:p,...g}=e;const v=n.useReducer(Ln,void 0,Pn),[x,b]=v,[y,j]=function(){const[e]=n.useState(()=>new Set),t=n.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[n.useCallback(t=>{let{type:r,event:n}=t;e.forEach(e=>{var t;return null==(t=e[r])?void 0:t.call(e,n)})},[e]),t]}(),[w,N]=n.useState(Un.Uninitialized),k=w===Un.Initialized,{draggable:{active:C,nodes:S,translate:_},droppable:{containers:D}}=x,E=null!=C?S.get(C):null,R=n.useRef({initial:null,translated:null}),I=n.useMemo(()=>{var e;return null!=C?{id:C,data:null!=(e=null==E?void 0:E.data)?e:En,rect:R}:null},[C,E]),F=n.useRef(null),[M,A]=n.useState(null),[z,P]=n.useState(null),L=$t(g,Object.values(g)),T=Yt("DndDescribedBy",l),O=n.useMemo(()=>D.getEnabled(),[D]),U=($=f,n.useMemo(()=>({draggable:{...Rn.draggable,...null==$?void 0:$.draggable},droppable:{...Rn.droppable,...null==$?void 0:$.droppable},dragOverlay:{...Rn.dragOverlay,...null==$?void 0:$.dragOverlay}}),[null==$?void 0:$.draggable,null==$?void 0:$.droppable,null==$?void 0:$.dragOverlay]));var $;const{droppableRects:V,measureDroppableContainers:q,measuringScheduled:B}=function(e,t){let{dragging:r,dependencies:a,config:s}=t;const[i,o]=n.useState(null),{frequency:l,measure:c,strategy:d}=s,u=n.useRef(e),m=function(){switch(d){case pn.Always:return!1;case pn.BeforeDragging:return r;default:return!r}}(),h=$t(m),f=n.useCallback(function(e){void 0===e&&(e=[]),h.current||o(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[h]),p=n.useRef(null),g=Vt(t=>{if(m&&!r)return xn;if(!t||t===xn||u.current!==e||null!=i){const t=new Map;for(let r of e){if(!r)continue;if(i&&i.length>0&&!i.includes(r.id)&&r.rect.current){t.set(r.id,r.rect.current);continue}const e=r.node.current,n=e?new $r(c(e),e):null;r.rect.current=n,n&&t.set(r.id,n)}return t}return t},[e,i,r,m,c]);return n.useEffect(()=>{u.current=e},[e]),n.useEffect(()=>{m||f()},[r,m]),n.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),n.useEffect(()=>{m||"number"!=typeof l||null!==p.current||(p.current=setTimeout(()=>{f(),p.current=null},l))},[l,m,f,...a]),{droppableRects:g,measureDroppableContainers:f,measuringScheduled:null!=i}}(O,{dragging:k,dependencies:[_.x,_.y],config:U.droppable}),H=function(e,t){const r=null!=t?e.get(t):void 0,n=r?r.node.current:null;return Vt(e=>{var r;return null==t?null:null!=(r=null!=n?n:e)?r:null},[n,t])}(S,C),Y=n.useMemo(()=>z?Jt(z):null,[z]),W=function(){const e=!1===(null==M?void 0:M.autoScrollEnabled),t="object"==typeof d?!1===d.enabled:!1===d,r=k&&!e&&!t;if("object"==typeof d)return{...d,enabled:r};return{enabled:r}}(),G=function(e,t){return bn(e,t)}(H,U.draggable.measure);!function(e){let{activeNode:t,measure:r,initialRect:a,config:s=!0}=e;const i=n.useRef(!1),{x:o,y:l}="boolean"==typeof s?{x:s,y:s}:s;Ot(()=>{if(!o&&!l||!t)return void(i.current=!1);if(i.current||!a)return;const e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;const n=yr(r(e),a);if(o||(n.x=0),l||(n.y=0),i.current=!0,Math.abs(n.x)>0||Math.abs(n.y)>0){const t=_r(e);t&&t.scrollBy({top:n.y,left:n.x})}},[t,o,l,a,r])}({activeNode:null!=C?S.get(C):null,config:W.layoutShiftCompensation,initialRect:G,measure:U.draggable.measure});const X=wn(H,U.draggable.measure,G),K=wn(H?H.parentElement:null),J=n.useRef({activatorEvent:null,active:null,activeNode:H,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:D,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Z=D.getNodeFor(null==(t=J.current.over)?void 0:t.id),Q=_n({measure:U.dragOverlay.measure}),ee=null!=(r=Q.nodeRef.current)?r:H,te=k?null!=(i=Q.rect)?i:X:null,re=Boolean(Q.nodeRef.current&&Q.rect),ne=yr(ae=re?null:X,bn(ae));var ae;const se=Cn(ee?At(ee):null),ie=function(e){const t=n.useRef(e),r=Vt(r=>e?r&&r!==Nn&&e&&t.current&&e.parentNode===t.current.parentNode?r:Sr(e):Nn,[e]);return n.useEffect(()=>{t.current=e},[e]),r}(k?null!=Z?Z:H:null),oe=function(e,t){void 0===t&&(t=kr);const[r]=e,a=Cn(r?At(r):null),[s,i]=n.useState(Sn);function o(){i(()=>e.length?e.map(e=>Ar(e)?a:new $r(t(e),e)):Sn)}const l=yn({callback:o});return Ot(()=>{null==l||l.disconnect(),o(),e.forEach(e=>null==l?void 0:l.observe(e))},[e]),s}(ie),le=function(e,t){let{transform:r,...n}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...n}),r):r}(p,{transform:{x:_.x-ne.x,y:_.y-ne.y,scaleX:1,scaleY:1},activatorEvent:z,active:I,activeNodeRect:X,containerNodeRect:K,draggingNodeRect:te,over:J.current.over,overlayNodeRect:Q.rect,scrollableAncestors:ie,scrollableAncestorRects:oe,windowRect:se}),ce=Y?Gt(Y,_):null,de=function(e){const[t,r]=n.useState(null),a=n.useRef(e),s=n.useCallback(e=>{const t=Dr(e.target);t&&r(e=>e?(e.set(t,Ir(t)),new Map(e)):null)},[]);return n.useEffect(()=>{const t=a.current;if(e!==t){n(t);const i=e.map(e=>{const t=Dr(e);return t?(t.addEventListener("scroll",s,{passive:!0}),[t,Ir(t)]):null}).filter(e=>null!=e);r(i.length?new Map(i):null),a.current=e}return()=>{n(e),n(t)};function n(e){e.forEach(e=>{const t=Dr(e);null==t||t.removeEventListener("scroll",s)})}},[s,e]),n.useMemo(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>Gt(e,t),ur):Or(e):ur,[e,t])}(ie),ue=kn(de),me=kn(de,[X]),he=Gt(le,ue),fe=te?wr(te,le):null,pe=I&&fe?h({active:I,collisionRect:fe,droppableRects:V,droppableContainers:O,pointerCoordinates:ce}):null,ge=function(e,t){if(!e||0===e.length)return null;const[r]=e;return r[t]}(pe,"id"),[ve,xe]=n.useState(null),be=function(e,t,r){return{...e,scaleX:t&&r?t.width/r.width:1,scaleY:t&&r?t.height/r.height:1}}(re?le:Gt(le,me),null!=(o=null==ve?void 0:ve.rect)?o:null,X),ye=n.useRef(null),je=n.useCallback((e,t)=>{let{sensor:r,options:n}=t;if(null==F.current)return;const a=S.get(F.current);if(!a)return;const i=e.nativeEvent,o=new r({active:F.current,activeNode:a,event:i,options:n,context:J,onAbort(e){if(!S.get(e))return;const{onDragAbort:t}=L.current,r={id:e};null==t||t(r),y({type:"onDragAbort",event:r})},onPending(e,t,r,n){if(!S.get(e))return;const{onDragPending:a}=L.current,s={id:e,constraint:t,initialCoordinates:r,offset:n};null==a||a(s),y({type:"onDragPending",event:s})},onStart(e){const t=F.current;if(null==t)return;const r=S.get(t);if(!r)return;const{onDragStart:n}=L.current,a={activatorEvent:i,active:{id:t,data:r.data,rect:R}};s.unstable_batchedUpdates(()=>{null==n||n(a),N(Un.Initializing),b({type:lr.DragStart,initialCoordinates:e,active:t}),y({type:"onDragStart",event:a}),A(ye.current),P(i)})},onMove(e){b({type:lr.DragMove,coordinates:e})},onEnd:l(lr.DragEnd),onCancel:l(lr.DragCancel)});function l(e){return async function(){const{active:t,collisions:r,over:n,scrollAdjustedTranslate:a}=J.current;let o=null;if(t&&a){const{cancelDrop:s}=L.current;if(o={activatorEvent:i,active:t,collisions:r,delta:a,over:n},e===lr.DragEnd&&"function"==typeof s){await Promise.resolve(s(o))&&(e=lr.DragCancel)}}F.current=null,s.unstable_batchedUpdates(()=>{b({type:e}),N(Un.Uninitialized),xe(null),A(null),P(null),ye.current=null;const t=e===lr.DragEnd?"onDragEnd":"onDragCancel";if(o){const e=L.current[t];null==e||e(o),y({type:t,event:o})}})}}ye.current=o},[S]),we=function(e,t){return n.useMemo(()=>e.reduce((e,r)=>{const{sensor:n}=r;return[...e,...n.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,r)}))]},[]),[e,t])}(m,n.useCallback((e,t)=>(r,n)=>{const a=r.nativeEvent,s=S.get(n);if(null!==F.current||!s||a.dndKit||a.defaultPrevented)return;const i={active:s};!0===e(r,t.options,i)&&(a.dndKit={capturedBy:t.sensor},F.current=n,je(r,t))},[S,je]));!function(e){n.useEffect(()=>{if(!It)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(m),Ot(()=>{X&&w===Un.Initializing&&N(Un.Initialized)},[X,w]),n.useEffect(()=>{const{onDragMove:e}=L.current,{active:t,activatorEvent:r,collisions:n,over:a}=J.current;if(!t||!r)return;const i={active:t,activatorEvent:r,collisions:n,delta:{x:he.x,y:he.y},over:a};s.unstable_batchedUpdates(()=>{null==e||e(i),y({type:"onDragMove",event:i})})},[he.x,he.y]),n.useEffect(()=>{const{active:e,activatorEvent:t,collisions:r,droppableContainers:n,scrollAdjustedTranslate:a}=J.current;if(!e||null==F.current||!t||!a)return;const{onDragOver:i}=L.current,o=n.get(ge),l=o&&o.rect.current?{id:o.id,rect:o.rect.current,data:o.data,disabled:o.disabled}:null,c={active:e,activatorEvent:t,collisions:r,delta:{x:a.x,y:a.y},over:l};s.unstable_batchedUpdates(()=>{xe(l),null==i||i(c),y({type:"onDragOver",event:c})})},[ge]),Ot(()=>{J.current={activatorEvent:z,active:I,activeNode:H,collisionRect:fe,collisions:pe,droppableRects:V,draggableNodes:S,draggingNode:ee,draggingNodeRect:te,droppableContainers:D,over:ve,scrollableAncestors:ie,scrollAdjustedTranslate:he},R.current={initial:te,translated:fe}},[I,H,pe,fe,S,ee,te,V,D,ve,ie,he]),hn({...W,delta:_,draggingRect:fe,pointerCoordinates:ce,scrollableAncestors:ie,scrollableAncestorRects:oe});const Ne=n.useMemo(()=>({active:I,activeNode:H,activeNodeRect:X,activatorEvent:z,collisions:pe,containerNodeRect:K,dragOverlay:Q,draggableNodes:S,droppableContainers:D,droppableRects:V,over:ve,measureDroppableContainers:q,scrollableAncestors:ie,scrollableAncestorRects:oe,measuringConfiguration:U,measuringScheduled:B,windowRect:se}),[I,H,X,z,pe,K,Q,S,D,V,ve,q,ie,oe,U,B,se]),ke=n.useMemo(()=>({activatorEvent:z,activators:we,active:I,activeNodeRect:X,ariaDescribedById:{draggable:T},dispatch:b,draggableNodes:S,over:ve,measureDroppableContainers:q}),[z,we,I,X,b,T,S,ve,q]);return a.createElement(ar.Provider,{value:j},a.createElement(An.Provider,{value:ke},a.createElement(zn.Provider,{value:Ne},a.createElement(On.Provider,{value:be},u)),a.createElement(Tn,{disabled:!1===(null==c?void 0:c.restoreFocus)})),a.createElement(or,{...c,hiddenTextDescribedById:T}))}),qn=n.createContext(null),Bn="button";function Hn(e){let{id:t,data:r,disabled:a=!1,attributes:s}=e;const i=Yt("Draggable"),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:m,over:h}=n.useContext(An),{role:f=Bn,roleDescription:p="draggable",tabIndex:g=0}=null!=s?s:{},v=(null==c?void 0:c.id)===t,x=n.useContext(v?On:qn),[b,y]=qt(),[j,w]=qt(),N=function(e,t){return n.useMemo(()=>e.reduce((e,r)=>{let{eventName:n,handler:a}=r;return e[n]=e=>{a(e,t)},e},{}),[e,t])}(o,t),k=$t(r);Ot(()=>(m.set(t,{id:t,key:i,node:b,activatorNode:j,data:k}),()=>{const e=m.get(t);e&&e.key===i&&m.delete(t)}),[m,t]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:n.useMemo(()=>({role:f,tabIndex:g,"aria-disabled":a,"aria-pressed":!(!v||f!==Bn)||void 0,"aria-roledescription":p,"aria-describedby":u.draggable}),[a,f,g,v,p,u.draggable]),isDragging:v,listeners:a?void 0:N,node:b,over:h,setNodeRef:y,setActivatorNodeRef:w,transform:x}}const Yn={timeout:25};function Wn(e){let{data:t,disabled:r=!1,id:a,resizeObserverConfig:s}=e;const i=Yt("Droppable"),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=n.useContext(An),u=n.useRef({disabled:r}),m=n.useRef(!1),h=n.useRef(null),f=n.useRef(null),{disabled:p,updateMeasurementsFor:g,timeout:v}={...Yn,...s},x=$t(null!=g?g:a),b=yn({callback:n.useCallback(()=>{m.current?(null!=f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{d(Array.isArray(x.current)?x.current:[x.current]),f.current=null},v)):m.current=!0},[v]),disabled:p||!o}),y=n.useCallback((e,t)=>{b&&(t&&(b.unobserve(t),m.current=!1),e&&b.observe(e))},[b]),[j,w]=qt(y),N=$t(t);return n.useEffect(()=>{b&&j.current&&(b.disconnect(),m.current=!1,b.observe(j.current))},[j,b]),n.useEffect(()=>(l({type:lr.RegisterDroppable,element:{id:a,key:i,disabled:r,node:j,rect:h,data:N}}),()=>l({type:lr.UnregisterDroppable,key:i,id:a})),[a]),n.useEffect(()=>{r!==u.current.disabled&&(l({type:lr.SetDroppableDisabled,id:a,key:i,disabled:r}),u.current.disabled=r)},[a,i,r,l]),{active:o,rect:h,isOver:(null==c?void 0:c.id)===a,node:j,over:c,setNodeRef:w}}const Gn=n.createContext(null);Gn.displayName="PanelGroupContext";const Xn="data-panel-group",Kn="data-panel-group-direction",Jn="data-panel-group-id",Zn="data-panel",Qn="data-panel-collapsible",ea="data-panel-id",ta="data-panel-size",ra="data-resize-handle",na="data-resize-handle-active",aa="data-panel-resize-handle-enabled",sa="data-panel-resize-handle-id",ia="data-resize-handle-state",oa=n.useLayoutEffect,la=i["useId".toString()],ca="function"==typeof la?la:()=>null;let da=0;function ua(e=null){const t=ca(),r=n.useRef(e||t||null);return null===r.current&&(r.current=""+da++),null!=e?e:r.current}function ma({children:e,className:t="",collapsedSize:r,collapsible:a,defaultSize:s,forwardedRef:i,id:o,maxSize:l,minSize:c,onCollapse:d,onExpand:u,onResize:m,order:h,style:f,tagName:p="div",...g}){const v=n.useContext(Gn);if(null===v)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:x,expandPanel:b,getPanelSize:y,getPanelStyle:j,groupId:w,isPanelCollapsed:N,reevaluatePanelConstraints:k,registerPanel:C,resizePanel:S,unregisterPanel:_}=v,D=ua(o),E=n.useRef({callbacks:{onCollapse:d,onExpand:u,onResize:m},constraints:{collapsedSize:r,collapsible:a,defaultSize:s,maxSize:l,minSize:c},id:D,idIsFromProps:void 0!==o,order:h});n.useRef({didLogMissingDefaultSizeWarning:!1}),oa(()=>{const{callbacks:e,constraints:t}=E.current,n={...t};E.current.id=D,E.current.idIsFromProps=void 0!==o,E.current.order=h,e.onCollapse=d,e.onExpand=u,e.onResize=m,t.collapsedSize=r,t.collapsible=a,t.defaultSize=s,t.maxSize=l,t.minSize=c,n.collapsedSize===t.collapsedSize&&n.collapsible===t.collapsible&&n.maxSize===t.maxSize&&n.minSize===t.minSize||k(E.current,n)}),oa(()=>{const e=E.current;return C(e),()=>{_(e)}},[h,D,C,_]),n.useImperativeHandle(i,()=>({collapse:()=>{x(E.current)},expand:e=>{b(E.current,e)},getId:()=>D,getSize:()=>y(E.current),isCollapsed:()=>N(E.current),isExpanded:()=>!N(E.current),resize:e=>{S(E.current,e)}}),[x,b,y,N,D,S]);const R=j(E.current,s);return n.createElement(p,{...g,children:e,className:t,id:D,style:{...R,...f},[Jn]:w,[Zn]:"",[Qn]:a||void 0,[ea]:D,[ta]:parseFloat(""+R.flexGrow).toFixed(1)})}const ha=n.forwardRef((e,t)=>n.createElement(ma,{...e,forwardedRef:t}));ma.displayName="Panel",ha.displayName="forwardRef(Panel)";let fa=null,pa=-1,ga=null;function va(e,t){var r,n;const a=function(e,t){if(t){const e=0!==(t&Ia),r=0!==(t&Fa);if(0!==(t&Ea))return e?"se-resize":r?"ne-resize":"e-resize";if(0!==(t&Ra))return e?"sw-resize":r?"nw-resize":"w-resize";if(e)return"s-resize";if(r)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}(e,t);if(fa!==a){var s;if(fa=a,null===ga&&(ga=document.createElement("style"),document.head.appendChild(ga)),pa>=0)null===(s=ga.sheet)||void 0===s||s.removeRule(pa);pa=null!==(r=null===(n=ga.sheet)||void 0===n?void 0:n.insertRule(`*{cursor: ${a} !important;}`))&&void 0!==r?r:-1}}function xa(e){return"keydown"===e.type}function ba(e){return e.type.startsWith("pointer")}function ya(e){return e.type.startsWith("mouse")}function ja(e){if(ba(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(ya(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function wa(e,t,r){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}const Na=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function ka(e){const t=getComputedStyle(e);return"fixed"===t.position||(!("auto"===t.zIndex||"static"===t.position&&!function(e){var t;const r=getComputedStyle(null!==(t=Da(e))&&void 0!==t?t:e).display;return"flex"===r||"inline-flex"===r}(e))||(+t.opacity<1||("transform"in t&&"none"!==t.transform||("webkitTransform"in t&&"none"!==t.webkitTransform||("mixBlendMode"in t&&"normal"!==t.mixBlendMode||("filter"in t&&"none"!==t.filter||("webkitFilter"in t&&"none"!==t.webkitFilter||("isolation"in t&&"isolate"===t.isolation||(!!Na.test(t.willChange)||"touch"===t.webkitOverflowScrolling)))))))))}function Ca(e){let t=e.length;for(;t--;){const r=e[t];if(Xa(r,"Missing node"),ka(r))return r}return null}function Sa(e){return e&&Number(getComputedStyle(e).zIndex)||0}function _a(e){const t=[];for(;e;)t.push(e),e=Da(e);return t}function Da(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const Ea=1,Ra=2,Ia=4,Fa=8,Ma="coarse"===function(){if("function"==typeof matchMedia)return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}();let Aa=[],za=!1,Pa=new Map,La=new Map;const Ta=new Set;function Oa(e){const{target:t}=e,{x:r,y:n}=ja(e);za=!0,qa({target:t,x:r,y:n}),Wa(),Aa.length>0&&(Ga("down",e),e.preventDefault(),Va(t)||e.stopImmediatePropagation())}function Ua(e){const{x:t,y:r}=ja(e);if(za&&0===e.buttons&&(za=!1,Ga("up",e)),!za){const{target:n}=e;qa({target:n,x:t,y:r})}Ga("move",e),Ha(),Aa.length>0&&e.preventDefault()}function $a(e){const{target:t}=e,{x:r,y:n}=ja(e);La.clear(),za=!1,Aa.length>0&&(e.preventDefault(),Va(t)||e.stopImmediatePropagation()),Ga("up",e),qa({target:t,x:r,y:n}),Ha(),Wa()}function Va(e){let t=e;for(;t;){if(t.hasAttribute(ra))return!0;t=t.parentElement}return!1}function qa({target:e,x:t,y:r}){Aa.splice(0);let n=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(n=e),Ta.forEach(e=>{const{element:a,hitAreaMargins:s}=e,i=a.getBoundingClientRect(),{bottom:o,left:l,right:c,top:d}=i,u=Ma?s.coarse:s.fine;if(t>=l-u&&t<=c+u&&r>=d-u&&r<=o+u){if(null!==n&&document.contains(n)&&a!==n&&!a.contains(n)&&!n.contains(a)&&function(e,t){if(e===t)throw new Error("Cannot compare node with itself");const r={a:_a(e),b:_a(t)};let n;for(;r.a.at(-1)===r.b.at(-1);)e=r.a.pop(),t=r.b.pop(),n=e;Xa(n,"Stacking order can only be calculated for elements with a common ancestor");const a=Sa(Ca(r.a)),s=Sa(Ca(r.b));if(a===s){const e=n.childNodes,t={a:r.a.at(-1),b:r.b.at(-1)};let a=e.length;for(;a--;){const r=e[a];if(r===t.a)return 1;if(r===t.b)return-1}}return Math.sign(a-s)}(n,a)>0){let e=n,t=!1;for(;e&&!e.contains(a);){if(wa(e.getBoundingClientRect(),i)){t=!0;break}e=e.parentElement}if(t)return}Aa.push(e)}})}function Ba(e,t){La.set(e,t)}function Ha(){let e=!1,t=!1;Aa.forEach(r=>{const{direction:n}=r;"horizontal"===n?e=!0:t=!0});let r=0;La.forEach(e=>{r|=e}),e&&t?va("intersection",r):e?va("horizontal",r):t?va("vertical",r):null!==ga&&(document.head.removeChild(ga),fa=null,ga=null,pa=-1)}let Ya=new AbortController;function Wa(){Ya.abort(),Ya=new AbortController;const e={capture:!0,signal:Ya.signal};Ta.size&&(za?(Aa.length>0&&Pa.forEach((t,r)=>{const{body:n}=r;t>0&&(n.addEventListener("contextmenu",$a,e),n.addEventListener("pointerleave",Ua,e),n.addEventListener("pointermove",Ua,e))}),window.addEventListener("pointerup",$a,e),window.addEventListener("pointercancel",$a,e)):Pa.forEach((t,r)=>{const{body:n}=r;t>0&&(n.addEventListener("pointerdown",Oa,e),n.addEventListener("pointermove",Ua,e))}))}function Ga(e,t){Ta.forEach(r=>{const{setResizeHandlerState:n}=r,a=Aa.includes(r);n(e,a,t)})}function Xa(e,t){if(!e)throw Error(t)}function Ka(e,t,r=10){return e.toFixed(r)===t.toFixed(r)?0:e>t?1:-1}function Ja(e,t,r=10){return 0===Ka(e,t,r)}function Za(e,t,r){return 0===Ka(e,t,r)}function Qa({panelConstraints:e,panelIndex:t,size:r}){const n=e[t];Xa(null!=n,`Panel constraints not found for index ${t}`);let{collapsedSize:a=0,collapsible:s,maxSize:i=100,minSize:o=0}=n;if(Ka(r,o)<0)if(s){r=Ka(r,(a+o)/2)<0?a:o}else r=o;return r=Math.min(i,r),r=parseFloat(r.toFixed(10))}function es({delta:e,initialLayout:t,panelConstraints:r,pivotIndices:n,prevLayout:a,trigger:s}){if(Za(e,0))return t;const i=[...t],[o,l]=n;Xa(null!=o,"Invalid first pivot index"),Xa(null!=l,"Invalid second pivot index");let c=0;if("keyboard"===s){{const n=e<0?l:o,a=r[n];Xa(a,`Panel constraints not found for index ${n}`);const{collapsedSize:s=0,collapsible:i,minSize:c=0}=a;if(i){const r=t[n];if(Xa(null!=r,`Previous layout not found for panel index ${n}`),Za(r,s)){const t=c-r;Ka(t,Math.abs(e))>0&&(e=e<0?0-t:t)}}}{const n=e<0?o:l,a=r[n];Xa(a,`No panel constraints found for index ${n}`);const{collapsedSize:s=0,collapsible:i,minSize:c=0}=a;if(i){const r=t[n];if(Xa(null!=r,`Previous layout not found for panel index ${n}`),Za(r,c)){const t=r-s;Ka(t,Math.abs(e))>0&&(e=e<0?0-t:t)}}}}{const n=e<0?1:-1;let a=e<0?l:o,s=0;for(;;){const e=t[a];Xa(null!=e,`Previous layout not found for panel index ${a}`);if(s+=Qa({panelConstraints:r,panelIndex:a,size:100})-e,a+=n,a<0||a>=r.length)break}const i=Math.min(Math.abs(e),Math.abs(s));e=e<0?0-i:i}{let n=e<0?o:l;for(;n>=0&&n<r.length;){const a=Math.abs(e)-Math.abs(c),s=t[n];Xa(null!=s,`Previous layout not found for panel index ${n}`);const o=Qa({panelConstraints:r,panelIndex:n,size:s-a});if(!Za(s,o)&&(c+=s-o,i[n]=o,c.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?n--:n++}}if(function(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Za(e[n],t[n],r))return!1;return!0}(a,i))return a;{const n=e<0?l:o,a=t[n];Xa(null!=a,`Previous layout not found for panel index ${n}`);const s=a+c,d=Qa({panelConstraints:r,panelIndex:n,size:s});if(i[n]=d,!Za(d,s)){let t=s-d;let n=e<0?l:o;for(;n>=0&&n<r.length;){const a=i[n];Xa(null!=a,`Previous layout not found for panel index ${n}`);const s=Qa({panelConstraints:r,panelIndex:n,size:a+t});if(Za(a,s)||(t-=s-a,i[n]=s),Za(t,0))break;e>0?n--:n++}}}return Za(i.reduce((e,t)=>t+e,0),100)?i:a}function ts({layout:e,panelsArray:t,pivotIndices:r}){let n=0,a=100,s=0,i=0;const o=r[0];Xa(null!=o,"No pivot index found"),t.forEach((e,t)=>{const{constraints:r}=e,{maxSize:l=100,minSize:c=0}=r;t===o?(n=c,a=l):(s+=c,i+=l)});return{valueMax:Math.min(a,100-s),valueMin:Math.max(n,100-i),valueNow:e[o]}}function rs(e,t=document){return Array.from(t.querySelectorAll(`[${sa}][data-panel-group-id="${e}"]`))}function ns(e,t,r=document){const n=rs(e,r).findIndex(e=>e.getAttribute(sa)===t);return null!=n?n:null}function as(e,t,r){const n=ns(e,t,r);return null!=n?[n,n+1]:[-1,-1]}function ss(e,t=document){var r;if(t instanceof HTMLElement&&(null==t||null===(r=t.dataset)||void 0===r?void 0:r.panelGroupId)==e)return t;const n=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return n||null}function is(e,t=document){const r=t.querySelector(`[${sa}="${e}"]`);return r||null}function os({committedValuesRef:e,eagerValuesRef:t,groupId:r,layout:a,panelDataArray:s,panelGroupElement:i,setLayout:o}){n.useRef({didWarnAboutMissingResizeHandle:!1}),oa(()=>{if(!i)return;const e=rs(r,i);for(let t=0;t<s.length-1;t++){const{valueMax:r,valueMin:n,valueNow:i}=ts({layout:a,panelsArray:s,pivotIndices:[t,t+1]}),o=e[t];if(null==o);else{const e=s[t];Xa(e,`No panel data found for index "${t}"`),o.setAttribute("aria-controls",e.id),o.setAttribute("aria-valuemax",""+Math.round(r)),o.setAttribute("aria-valuemin",""+Math.round(n)),o.setAttribute("aria-valuenow",null!=i?""+Math.round(i):"")}}return()=>{e.forEach((e,t)=>{e.removeAttribute("aria-controls"),e.removeAttribute("aria-valuemax"),e.removeAttribute("aria-valuemin"),e.removeAttribute("aria-valuenow")})}},[r,a,s,i]),n.useEffect(()=>{if(!i)return;const e=t.current;Xa(e,"Eager values not found");const{panelDataArray:n}=e;Xa(null!=ss(r,i),`No group found for id "${r}"`);const s=rs(r,i);Xa(s,`No resize handles found for group id "${r}"`);const l=s.map(e=>{const t=e.getAttribute(sa);Xa(t,"Resize handle element has no handle id attribute");const[s,l]=function(e,t,r,n=document){var a,s,i,o;const l=is(t,n),c=rs(e,n),d=l?c.indexOf(l):-1;return[null!==(a=null===(s=r[d])||void 0===s?void 0:s.id)&&void 0!==a?a:null,null!==(i=null===(o=r[d+1])||void 0===o?void 0:o.id)&&void 0!==i?i:null]}(r,t,n,i);if(null==s||null==l)return()=>{};const c=e=>{if(!e.defaultPrevented)switch(e.key){case"Enter":{e.preventDefault();const l=n.findIndex(e=>e.id===s);if(l>=0){const e=n[l];Xa(e,`No panel data found for index ${l}`);const s=a[l],{collapsedSize:c=0,collapsible:d,minSize:u=0}=e.constraints;if(null!=s&&d){const e=es({delta:Za(s,c)?u-c:c-s,initialLayout:a,panelConstraints:n.map(e=>e.constraints),pivotIndices:as(r,t,i),prevLayout:a,trigger:"keyboard"});a!==e&&o(e)}}break}}};return e.addEventListener("keydown",c),()=>{e.removeEventListener("keydown",c)}});return()=>{l.forEach(e=>e())}},[i,e,t,r,a,s,o])}function ls(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function cs(e,t){const r="horizontal"===e,{x:n,y:a}=ja(t);return r?n:a}function ds(e,t,r,n,a,s){if(xa(e)){const t="horizontal"===r;let n=0;n=e.shiftKey?100:null!=a?a:10;let s=0;switch(e.key){case"ArrowDown":s=t?0:n;break;case"ArrowLeft":s=t?-n:0;break;case"ArrowRight":s=t?n:0;break;case"ArrowUp":s=t?0:-n;break;case"End":s=100;break;case"Home":s=-100}return s}return null==n?0:function(e,t,r,n,a){const s="horizontal"===r,i=is(t,a);Xa(i,`No resize handle element found for id "${t}"`);const o=i.getAttribute(Jn);Xa(o,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=n;const c=cs(r,e),d=ss(o,a);Xa(d,`No group element found for id "${o}"`);const u=d.getBoundingClientRect();return(c-l)/(s?u.width:u.height)*100}(e,t,r,n,s)}function us(e,t,r){t.forEach((t,n)=>{const a=e[n];Xa(a,`Panel data not found for index ${n}`);const{callbacks:s,constraints:i,id:o}=a,{collapsedSize:l=0,collapsible:c}=i,d=r[o];if(null==d||t!==d){r[o]=t;const{onCollapse:e,onExpand:n,onResize:a}=s;a&&a(t,d),c&&(e||n)&&(!n||null!=d&&!Ja(d,l)||Ja(t,l)||n(),!e||null!=d&&Ja(d,l)||!Ja(t,l)||e())}})}function ms(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function hs(e){try{if("undefined"==typeof localStorage)throw new Error("localStorage not supported in this environment");e.getItem=e=>localStorage.getItem(e),e.setItem=(e,t)=>{localStorage.setItem(e,t)}}catch(t){e.getItem=()=>null,e.setItem=()=>{}}}function fs(e){return`react-resizable-panels:${e}`}function ps(e){return e.map(e=>{const{constraints:t,id:r,idIsFromProps:n,order:a}=e;return n?r:a?`${a}:${JSON.stringify(t)}`:JSON.stringify(t)}).sort((e,t)=>e.localeCompare(t)).join(",")}function gs(e,t){try{const r=fs(e),n=t.getItem(r);if(n){const e=JSON.parse(n);if("object"==typeof e&&null!=e)return e}}catch(r){}return null}function vs(e,t,r,n,a){var s;const i=fs(e),o=ps(t),l=null!==(s=gs(e,a))&&void 0!==s?s:{};l[o]={expandToSizes:Object.fromEntries(r.entries()),layout:n};try{a.setItem(i,JSON.stringify(l))}catch(c){}}function xs({layout:e,panelConstraints:t}){const r=[...e],n=r.reduce((e,t)=>e+t,0);if(r.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${r.map(e=>`${e}%`).join(", ")}`);if(!Za(n,100)&&r.length>0)for(let s=0;s<t.length;s++){const e=r[s];Xa(null!=e,`No layout data found for index ${s}`);const t=100/n*e;r[s]=t}let a=0;for(let s=0;s<t.length;s++){const e=r[s];Xa(null!=e,`No layout data found for index ${s}`);const n=Qa({panelConstraints:t,panelIndex:s,size:e});e!=n&&(a+=e-n,r[s]=n)}if(!Za(a,0))for(let s=0;s<t.length;s++){const e=r[s];Xa(null!=e,`No layout data found for index ${s}`);const n=Qa({panelConstraints:t,panelIndex:s,size:e+a});if(e!==n&&(a-=n-e,r[s]=n,Za(a,0)))break}return r}const bs={getItem:e=>(hs(bs),bs.getItem(e)),setItem:(e,t)=>{hs(bs),bs.setItem(e,t)}},ys={};function js({autoSaveId:e=null,children:t,className:r="",direction:a,forwardedRef:s,id:i=null,onLayout:o=null,keyboardResizeBy:l=null,storage:c=bs,style:d,tagName:u="div",...m}){const h=ua(i),f=n.useRef(null),[p,g]=n.useState(null),[v,x]=n.useState([]),b=function(){const[e,t]=n.useState(0);return n.useCallback(()=>t(e=>e+1),[])}(),y=n.useRef({}),j=n.useRef(new Map),w=n.useRef(0),N=n.useRef({autoSaveId:e,direction:a,dragState:p,id:h,keyboardResizeBy:l,onLayout:o,storage:c}),k=n.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});n.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),n.useImperativeHandle(s,()=>({getId:()=>N.current.id,getLayout:()=>{const{layout:e}=k.current;return e},setLayout:e=>{const{onLayout:t}=N.current,{layout:r,panelDataArray:n}=k.current,a=xs({layout:e,panelConstraints:n.map(e=>e.constraints)});ls(r,a)||(x(a),k.current.layout=a,t&&t(a),us(n,a,y.current))}}),[]),oa(()=>{N.current.autoSaveId=e,N.current.direction=a,N.current.dragState=p,N.current.id=h,N.current.onLayout=o,N.current.storage=c}),os({committedValuesRef:N,eagerValuesRef:k,groupId:h,layout:v,panelDataArray:k.current.panelDataArray,setLayout:x,panelGroupElement:f.current}),n.useEffect(()=>{const{panelDataArray:t}=k.current;if(e){if(0===v.length||v.length!==t.length)return;let r=ys[e];null==r&&(r=function(e,t=10){let r=null;return(...n)=>{null!==r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}(vs,100),ys[e]=r);const n=[...t],a=new Map(j.current);r(e,n,a,v,c)}},[e,v,c]),n.useEffect(()=>{});const C=n.useCallback(e=>{const{onLayout:t}=N.current,{layout:r,panelDataArray:n}=k.current;if(e.constraints.collapsible){const a=n.map(e=>e.constraints),{collapsedSize:s=0,panelSize:i,pivotIndices:o}=ks(n,e,r);if(Xa(null!=i,`Panel size not found for panel "${e.id}"`),!Ja(i,s)){j.current.set(e.id,i);const l=es({delta:Ns(n,e)===n.length-1?i-s:s-i,initialLayout:r,panelConstraints:a,pivotIndices:o,prevLayout:r,trigger:"imperative-api"});ms(r,l)||(x(l),k.current.layout=l,t&&t(l),us(n,l,y.current))}}},[]),S=n.useCallback((e,t)=>{const{onLayout:r}=N.current,{layout:n,panelDataArray:a}=k.current;if(e.constraints.collapsible){const s=a.map(e=>e.constraints),{collapsedSize:i=0,panelSize:o=0,minSize:l=0,pivotIndices:c}=ks(a,e,n),d=null!=t?t:l;if(Ja(o,i)){const t=j.current.get(e.id),i=null!=t&&t>=d?t:d,l=es({delta:Ns(a,e)===a.length-1?o-i:i-o,initialLayout:n,panelConstraints:s,pivotIndices:c,prevLayout:n,trigger:"imperative-api"});ms(n,l)||(x(l),k.current.layout=l,r&&r(l),us(a,l,y.current))}}},[]),_=n.useCallback(e=>{const{layout:t,panelDataArray:r}=k.current,{panelSize:n}=ks(r,e,t);return Xa(null!=n,`Panel size not found for panel "${e.id}"`),n},[]),D=n.useCallback((e,t)=>{const{panelDataArray:r}=k.current,n=Ns(r,e);return function({defaultSize:e,dragState:t,layout:r,panelData:n,panelIndex:a,precision:s=3}){const i=r[a];let o;return o=null==i?null!=e?e.toPrecision(s):"1":1===n.length?"1":i.toPrecision(s),{flexBasis:0,flexGrow:o,flexShrink:1,overflow:"hidden",pointerEvents:null!==t?"none":void 0}}({defaultSize:t,dragState:p,layout:v,panelData:r,panelIndex:n})},[p,v]),E=n.useCallback(e=>{const{layout:t,panelDataArray:r}=k.current,{collapsedSize:n=0,collapsible:a,panelSize:s}=ks(r,e,t);return Xa(null!=s,`Panel size not found for panel "${e.id}"`),!0===a&&Ja(s,n)},[]),R=n.useCallback(e=>{const{layout:t,panelDataArray:r}=k.current,{collapsedSize:n=0,collapsible:a,panelSize:s}=ks(r,e,t);return Xa(null!=s,`Panel size not found for panel "${e.id}"`),!a||Ka(s,n)>0},[]),I=n.useCallback(e=>{const{panelDataArray:t}=k.current;t.push(e),t.sort((e,t)=>{const r=e.order,n=t.order;return null==r&&null==n?0:null==r?-1:null==n?1:r-n}),k.current.panelDataArrayChanged=!0,b()},[b]);oa(()=>{if(k.current.panelDataArrayChanged){k.current.panelDataArrayChanged=!1;const{autoSaveId:e,onLayout:t,storage:r}=N.current,{layout:n,panelDataArray:a}=k.current;let s=null;if(e){const t=function(e,t,r){var n,a;return null!==(a=(null!==(n=gs(e,r))&&void 0!==n?n:{})[ps(t)])&&void 0!==a?a:null}(e,a,r);t&&(j.current=new Map(Object.entries(t.expandToSizes)),s=t.layout)}null==s&&(s=function({panelDataArray:e}){const t=Array(e.length),r=e.map(e=>e.constraints);let n=0,a=100;for(let s=0;s<e.length;s++){const e=r[s];Xa(e,`Panel constraints not found for index ${s}`);const{defaultSize:i}=e;null!=i&&(n++,t[s]=i,a-=i)}for(let s=0;s<e.length;s++){const i=r[s];Xa(i,`Panel constraints not found for index ${s}`);const{defaultSize:o}=i;if(null!=o)continue;const l=a/(e.length-n);n++,t[s]=l,a-=l}return t}({panelDataArray:a}));const i=xs({layout:s,panelConstraints:a.map(e=>e.constraints)});ls(n,i)||(x(i),k.current.layout=i,t&&t(i),us(a,i,y.current))}}),oa(()=>{const e=k.current;return()=>{e.layout=[]}},[]);const F=n.useCallback(e=>{let t=!1;const r=f.current;if(r){"rtl"===window.getComputedStyle(r,null).getPropertyValue("direction")&&(t=!0)}return function(r){r.preventDefault();const n=f.current;if(!n)return()=>null;const{direction:a,dragState:s,id:i,keyboardResizeBy:o,onLayout:l}=N.current,{layout:c,panelDataArray:d}=k.current,{initialLayout:u}=null!=s?s:{},m=as(i,e,n);let h=ds(r,e,a,s,o,n);const p="horizontal"===a;p&&t&&(h=-h);const g=es({delta:h,initialLayout:null!=u?u:c,panelConstraints:d.map(e=>e.constraints),pivotIndices:m,prevLayout:c,trigger:xa(r)?"keyboard":"mouse-or-touch"}),v=!ms(c,g);(ba(r)||ya(r))&&w.current!=h&&(w.current=h,Ba(e,v||0===h?0:p?h<0?Ea:Ra:h<0?Ia:Fa)),v&&(x(g),k.current.layout=g,l&&l(g),us(d,g,y.current))}},[]),M=n.useCallback((e,t)=>{const{onLayout:r}=N.current,{layout:n,panelDataArray:a}=k.current,s=a.map(e=>e.constraints),{panelSize:i,pivotIndices:o}=ks(a,e,n);Xa(null!=i,`Panel size not found for panel "${e.id}"`);const l=es({delta:Ns(a,e)===a.length-1?i-t:t-i,initialLayout:n,panelConstraints:s,pivotIndices:o,prevLayout:n,trigger:"imperative-api"});ms(n,l)||(x(l),k.current.layout=l,r&&r(l),us(a,l,y.current))},[]),A=n.useCallback((e,t)=>{const{layout:r,panelDataArray:n}=k.current,{collapsedSize:a=0,collapsible:s}=t,{collapsedSize:i=0,collapsible:o,maxSize:l=100,minSize:c=0}=e.constraints,{panelSize:d}=ks(n,e,r);null!=d&&(s&&o&&Ja(d,a)?Ja(a,i)||M(e,i):d<c?M(e,c):d>l&&M(e,l))},[M]),z=n.useCallback((e,t)=>{const{direction:r}=N.current,{layout:n}=k.current;if(!f.current)return;const a=is(e,f.current);Xa(a,`Drag handle element not found for id "${e}"`);const s=cs(r,t);g({dragHandleId:e,dragHandleRect:a.getBoundingClientRect(),initialCursorPosition:s,initialLayout:n})},[]),P=n.useCallback(()=>{g(null)},[]),L=n.useCallback(e=>{const{panelDataArray:t}=k.current,r=Ns(t,e);r>=0&&(t.splice(r,1),delete y.current[e.id],k.current.panelDataArrayChanged=!0,b())},[b]),T=n.useMemo(()=>({collapsePanel:C,direction:a,dragState:p,expandPanel:S,getPanelSize:_,getPanelStyle:D,groupId:h,isPanelCollapsed:E,isPanelExpanded:R,reevaluatePanelConstraints:A,registerPanel:I,registerResizeHandle:F,resizePanel:M,startDragging:z,stopDragging:P,unregisterPanel:L,panelGroupElement:f.current}),[C,p,a,S,_,D,h,E,R,A,I,F,M,z,P,L]),O={display:"flex",flexDirection:"horizontal"===a?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return n.createElement(Gn.Provider,{value:T},n.createElement(u,{...m,children:t,className:r,id:i,ref:f,style:{...O,...d},[Xn]:"",[Kn]:a,[Jn]:h}))}const ws=n.forwardRef((e,t)=>n.createElement(js,{...e,forwardedRef:t}));function Ns(e,t){return e.findIndex(e=>e===t||e.id===t.id)}function ks(e,t,r){const n=Ns(e,t),a=n===e.length-1?[n-1,n]:[n,n+1],s=r[n];return{...t.constraints,panelSize:s,pivotIndices:a}}function Cs({children:e=null,className:t="",disabled:r=!1,hitAreaMargins:a,id:s,onBlur:i,onClick:o,onDragging:l,onFocus:c,onPointerDown:d,onPointerUp:u,style:m={},tabIndex:h=0,tagName:f="div",...p}){var g,v;const x=n.useRef(null),b=n.useRef({onClick:o,onDragging:l,onPointerDown:d,onPointerUp:u});n.useEffect(()=>{b.current.onClick=o,b.current.onDragging=l,b.current.onPointerDown=d,b.current.onPointerUp=u});const y=n.useContext(Gn);if(null===y)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:j,groupId:w,registerResizeHandle:N,startDragging:k,stopDragging:C,panelGroupElement:S}=y,_=ua(s),[D,E]=n.useState("inactive"),[R,I]=n.useState(!1),[F,M]=n.useState(null),A=n.useRef({state:D});oa(()=>{A.current.state=D}),n.useEffect(()=>{if(r)M(null);else{const e=N(_);M(()=>e)}},[r,_,N]);const z=null!==(g=null==a?void 0:a.coarse)&&void 0!==g?g:15,P=null!==(v=null==a?void 0:a.fine)&&void 0!==v?v:5;n.useEffect(()=>{if(r||null==F)return;const e=x.current;Xa(e,"Element ref not attached");let t=!1;return function(e,t,r,n,a){var s;const{ownerDocument:i}=t,o={direction:r,element:t,hitAreaMargins:n,setResizeHandlerState:a},l=null!==(s=Pa.get(i))&&void 0!==s?s:0;return Pa.set(i,l+1),Ta.add(o),Wa(),function(){var t;La.delete(e),Ta.delete(o);const r=null!==(t=Pa.get(i))&&void 0!==t?t:1;if(Pa.set(i,r-1),Wa(),1===r&&Pa.delete(i),Aa.includes(o)){const e=Aa.indexOf(o);e>=0&&Aa.splice(e,1),Ha(),a("up",!0,null)}}}(_,e,j,{coarse:z,fine:P},(e,r,n)=>{if(r)switch(e){case"down":{E("drag"),t=!1,Xa(n,'Expected event to be defined for "down" action'),k(_,n);const{onDragging:e,onPointerDown:r}=b.current;null==e||e(!0),null==r||r();break}case"move":{const{state:e}=A.current;t=!0,"drag"!==e&&E("hover"),Xa(n,'Expected event to be defined for "move" action'),F(n);break}case"up":{E("hover"),C();const{onClick:e,onDragging:r,onPointerUp:n}=b.current;null==r||r(!1),null==n||n(),t||null==e||e();break}}else E("inactive")})},[z,j,r,P,N,_,F,k,C]),function({disabled:e,handleId:t,resizeHandler:r,panelGroupElement:a}){n.useEffect(()=>{if(e||null==r||null==a)return;const n=is(t,a);if(null==n)return;const s=e=>{if(!e.defaultPrevented)switch(e.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":e.preventDefault(),r(e);break;case"F6":{e.preventDefault();const r=n.getAttribute(Jn);Xa(r,`No group element found for id "${r}"`);const s=rs(r,a),i=ns(r,t,a);Xa(null!==i,`No resize element found for id "${t}"`),s[e.shiftKey?i>0?i-1:s.length-1:i+1<s.length?i+1:0].focus();break}}};return n.addEventListener("keydown",s),()=>{n.removeEventListener("keydown",s)}},[a,e,t,r])}({disabled:r,handleId:_,resizeHandler:F,panelGroupElement:S});return n.createElement(f,{...p,children:e,className:t,id:s,onBlur:()=>{I(!1),null==i||i()},onFocus:()=>{I(!0),null==c||c()},ref:x,role:"separator",style:{touchAction:"none",userSelect:"none",...m},tabIndex:h,[Kn]:j,[Jn]:w,[ra]:"",[na]:"drag"===D?"pointer":R?"keyboard":void 0,[aa]:!r,[sa]:_,[ia]:D})}js.displayName="PanelGroup",ws.displayName="forwardRef(PanelGroup)",Cs.displayName="PanelResizeHandle";const Ss=({className:e,...t})=>o.jsx(ws,{className:l("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t}),_s=ha,Ds=({withHandle:e,className:t,...r})=>o.jsx(Cs,{className:l("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...r,children:e&&o.jsx("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:o.jsx(ht,{className:"h-2.5 w-2.5"})})}),Es=({isSaving:e,lastSaved:t,hasUnsavedChanges:r})=>e?o.jsxs(J,{variant:"secondary",className:"gap-1",children:[o.jsx(Z,{className:"h-3 w-3 animate-spin"}),"Saving..."]}):r?o.jsxs(J,{variant:"destructive",className:"gap-1",children:[o.jsx(Q,{className:"h-3 w-3"}),"Unsaved changes"]}):t?o.jsxs(J,{variant:"outline",className:"gap-1",children:[o.jsx(ee,{className:"h-3 w-3"}),"Saved ",Rt(t,{addSuffix:!0})]}):o.jsxs(J,{variant:"outline",className:"gap-1",children:[o.jsx(ee,{className:"h-3 w-3"}),"Saved"]}),Rs=({totalFields:e,visibleFields:t,showAllFields:r,onToggleShowAll:n,hasUnsavedChanges:a,className:s})=>{const i=r?ce:de,l=r?`${t} of ${e} fields`:`${e} field${1!==e?"s":""}`;return o.jsx("div",{className:`flex items-center gap-2 ${s}`,children:o.jsxs(c,{variant:"outline",size:"sm",onClick:n,className:"gap-1 h-8 text-xs "+(r?"border-primary bg-primary/10":""),"aria-label":r?"Show only visible fields":"Show all fields including hidden",children:[o.jsx(i,{className:"h-3 w-3"}),l]})})},Is=({form:e,onFormUpdate:t,onSave:r,saving:a,activeView:s,onViewChange:i,onPreview:l,totalFields:u=0,visibleFields:m=0,showAllFields:h=!1,onToggleShowAll:f=()=>{},hasUnsavedChanges:p=!1,lastSaved:g})=>{const{debouncedUpdate:v,immediateUpdate:x}=(({onFormUpdate:e,delay:t=500})=>{const r=n.useRef();return{debouncedUpdate:n.useCallback(n=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{e(n)},t)},[e,t]),immediateUpdate:n.useCallback(t=>{r.current&&clearTimeout(r.current),e(t)},[e])}})({onFormUpdate:t,delay:1e3});return o.jsx("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:o.jsxs("div",{className:"flex items-center justify-between px-6 py-3",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs(d,{to:"/dashboard",className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[o.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary to-primary/80 rounded-lg flex items-center justify-center text-primary-foreground font-bold text-lg",children:"F"}),o.jsx("span",{className:"text-lg font-bold bg-gradient-to-r from-primary to-primary/80 bg-clip-text text-transparent",children:"FormsEdge"})]}),o.jsx(c,{variant:"ghost",size:"sm",asChild:!0,children:o.jsxs(d,{to:"/dashboard",className:"flex items-center gap-2",children:[o.jsx(me,{className:"h-4 w-4"}),"Back to Dashboard"]})})]}),o.jsx("div",{className:"flex items-center gap-4 flex-1 min-w-0 max-w-lg mx-6",children:o.jsx(H,{value:e.title,onChange:t=>v({...e,title:t.target.value}),onBlur:t=>x({...e,title:t.target.value}),className:"font-medium",placeholder:"Form title"})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex items-center rounded-lg border p-1",children:[o.jsxs(c,{variant:"fields"===s?"default":"ghost",size:"sm",onClick:()=>i("fields"),className:"h-8",children:[o.jsx(he,{className:"h-4 w-4 mr-2"}),"Fields"]}),o.jsxs(c,{variant:"settings"===s?"default":"ghost",size:"sm",onClick:()=>i("settings"),className:"h-8",children:[o.jsx(ge,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),o.jsx("div",{className:"flex items-center rounded-lg border p-1 opacity-50"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Rs,{totalFields:u,visibleFields:m,showAllFields:h,onToggleShowAll:f,hasUnsavedChanges:p}),o.jsxs(c,{variant:"outline",size:"sm",onClick:l,children:[o.jsx(ce,{className:"h-4 w-4 mr-2"}),"Preview"]}),o.jsxs(Y,{value:e.status,onValueChange:t=>v({...e,status:t}),children:[o.jsx(W,{className:"w-32",children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"draft",children:"Draft"}),o.jsx(K,{value:"published",children:"Published"}),o.jsx(K,{value:"archived",children:"Archived"})]})]}),o.jsx(Es,{isSaving:a,lastSaved:g,hasUnsavedChanges:p}),o.jsx(ue,{}),o.jsxs(c,{onClick:r,disabled:a,size:"sm",children:[o.jsx(ve,{className:"h-4 w-4 mr-2"}),a?"Saving...":"Save"]})]})]})})};function Fs(e,t,r){const n=e.slice();return n.splice(r<0?n.length+r:r,0,n.splice(t,1)[0]),n}function Ms(e,t){return e.reduce((e,r,n)=>{const a=t.get(r);return a&&(e[n]=a),e},Array(e.length))}function As(e){return null!==e&&e>=0}const zs=e=>{let{rects:t,activeIndex:r,overIndex:n,index:a}=e;const s=Fs(t,n,r),i=t[a],o=s[a];return o&&i?{x:o.left-i.left,y:o.top-i.top,scaleX:o.width/i.width,scaleY:o.height/i.height}:null},Ps={scaleX:1,scaleY:1},Ls=e=>{var t;let{activeIndex:r,activeNodeRect:n,index:a,rects:s,overIndex:i}=e;const o=null!=(t=s[r])?t:n;if(!o)return null;if(a===r){const e=s[i];return e?{x:0,y:r<i?e.top+e.height-(o.top+o.height):e.top-o.top,...Ps}:null}const l=function(e,t,r){const n=e[t],a=e[t-1],s=e[t+1];if(!n)return 0;if(r<t)return a?n.top-(a.top+a.height):s?s.top-(n.top+n.height):0;return s?s.top-(n.top+n.height):a?n.top-(a.top+a.height):0}(s,a,r);return a>r&&a<=i?{x:0,y:-o.height-l,...Ps}:a<r&&a>=i?{x:0,y:o.height+l,...Ps}:{x:0,y:0,...Ps}};const Ts="Sortable",Os=a.createContext({activeIndex:-1,containerId:Ts,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:zs,disabled:{draggable:!1,droppable:!1}});function Us(e){let{children:t,id:r,items:s,strategy:i=zs,disabled:o=!1}=e;const{active:l,dragOverlay:c,droppableRects:d,over:u,measureDroppableContainers:m}=n.useContext(zn),h=Yt(Ts,r),f=Boolean(null!==c.rect),p=n.useMemo(()=>s.map(e=>"object"==typeof e&&"id"in e?e.id:e),[s]),g=null!=l,v=l?p.indexOf(l.id):-1,x=u?p.indexOf(u.id):-1,b=n.useRef(p),y=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(p,b.current),j=-1!==x&&-1===v||y,w=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(o);Ot(()=>{y&&g&&m(p)},[y,p,g,m]),n.useEffect(()=>{b.current=p},[p]);const N=n.useMemo(()=>({activeIndex:v,containerId:h,disabled:w,disableTransforms:j,items:p,overIndex:x,useDragOverlay:f,sortedRects:Ms(p,d),strategy:i}),[v,h,w.draggable,w.droppable,j,p,x,d,f,i]);return a.createElement(Os.Provider,{value:N},t)}const $s=e=>{let{id:t,items:r,activeIndex:n,overIndex:a}=e;return Fs(r,n,a).indexOf(t)},Vs=e=>{let{containerId:t,isSorting:r,wasDragging:n,index:a,items:s,newIndex:i,previousItems:o,previousContainerId:l,transition:c}=e;return!(!c||!n)&&((o===s||a!==i)&&(!!r||i!==a&&t===l))},qs={duration:200,easing:"ease"},Bs="transform",Hs=Zt.Transition.toString({property:Bs,duration:0,easing:"linear"}),Ys={roleDescription:"sortable"};function Ws(e){let{animateLayoutChanges:t=Vs,attributes:r,disabled:a,data:s,getNewIndex:i=$s,id:o,strategy:l,resizeObserverConfig:c,transition:d=qs}=e;const{items:u,containerId:m,activeIndex:h,disabled:f,disableTransforms:p,sortedRects:g,overIndex:v,useDragOverlay:x,strategy:b}=n.useContext(Os),y=function(e,t){var r,n;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(r=null==e?void 0:e.draggable)?r:t.draggable,droppable:null!=(n=null==e?void 0:e.droppable)?n:t.droppable}}(a,f),j=u.indexOf(o),w=n.useMemo(()=>({sortable:{containerId:m,index:j,items:u},...s}),[m,s,j,u]),N=n.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:k,node:C,isOver:S,setNodeRef:_}=Wn({id:o,data:w,disabled:y.droppable,resizeObserverConfig:{updateMeasurementsFor:N,...c}}),{active:D,activatorEvent:E,activeNodeRect:R,attributes:I,setNodeRef:F,listeners:M,isDragging:A,over:z,setActivatorNodeRef:P,transform:L}=Hn({id:o,data:w,attributes:{...Ys,...r},disabled:y.draggable}),T=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.useMemo(()=>e=>{t.forEach(t=>t(e))},t)}(_,F),O=Boolean(D),U=O&&!p&&As(h)&&As(v),$=!x&&A,V=$&&U?L:null,q=U?null!=V?V:(null!=l?l:b)({rects:g,activeNodeRect:R,activeIndex:h,overIndex:v,index:j}):null,B=As(h)&&As(v)?i({id:o,items:u,activeIndex:h,overIndex:v}):j,H=null==D?void 0:D.id,Y=n.useRef({activeId:H,items:u,newIndex:B,containerId:m}),W=u!==Y.current.items,G=t({active:D,containerId:m,isDragging:A,isSorting:O,id:o,index:j,items:u,newIndex:Y.current.newIndex,previousItems:Y.current.items,previousContainerId:Y.current.containerId,transition:d,wasDragging:null!=Y.current.activeId}),X=function(e){let{disabled:t,index:r,node:a,rect:s}=e;const[i,o]=n.useState(null),l=n.useRef(r);return Ot(()=>{if(!t&&r!==l.current&&a.current){const e=s.current;if(e){const t=kr(a.current,{ignoreTransform:!0}),r={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(r.x||r.y)&&o(r)}}r!==l.current&&(l.current=r)},[t,r,a,s]),n.useEffect(()=>{i&&o(null)},[i]),i}({disabled:!G,index:j,node:C,rect:k});return n.useEffect(()=>{O&&Y.current.newIndex!==B&&(Y.current.newIndex=B),m!==Y.current.containerId&&(Y.current.containerId=m),u!==Y.current.items&&(Y.current.items=u)},[O,B,m,u]),n.useEffect(()=>{if(H===Y.current.activeId)return;if(null!=H&&null==Y.current.activeId)return void(Y.current.activeId=H);const e=setTimeout(()=>{Y.current.activeId=H},50);return()=>clearTimeout(e)},[H]),{active:D,activeIndex:h,attributes:I,data:w,rect:k,index:j,newIndex:B,items:u,isOver:S,isSorting:O,isDragging:A,listeners:M,node:C,overIndex:v,over:z,setNodeRef:T,setActivatorNodeRef:P,setDroppableNodeRef:_,setDraggableNodeRef:F,transform:null!=X?X:q,transition:function(){if(X||W&&Y.current.newIndex===j)return Hs;if($&&!Kt(E)||!d)return;if(O||G)return Zt.Transition.toString({...d,property:Bs});return}()}}Yr.Down,Yr.Right,Yr.Up,Yr.Left;const Gs=({field:e,fields:t=[],formData:r={},isSelected:n,onSelect:a,onUpdate:s,responsive:i=!1,position:l})=>{const{attributes:d,listeners:u,setNodeRef:m,transform:h,transition:f,isDragging:p}=Ws({id:e.id}),g={transform:Zt.Transform.toString(h),transition:f,opacity:p?.5:1};return o.jsxs("div",{ref:m,style:g,className:`group relative rounded-lg border-2 transition-all cursor-pointer ${(()=>{if(!l)switch(e.width){case"quarter":return"col-span-1";case"half":return"col-span-2";default:return"col-span-full"}if("full"===e.width)return i?"col-span-full max-md:col-span-full":"col-span-full";const t=`col-span-${l.width}`;return i?`${t} max-md:col-span-full`:t})()} ${(()=>{switch(e.alignment){case"center":return"mx-auto";case"right":return"ml-auto";default:return""}})()} ${n?"border-primary bg-primary/5 ring-2 ring-primary/20":"border-slate-200 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"} ${e.conditional_logic?.hidden?"opacity-50":""}`,onClick:e=>{a()},children:[o.jsx("div",{className:"absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx(c,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 cursor-grab active:cursor-grabbing",...d,...u,children:o.jsx(ht,{className:"h-4 w-4"})})}),o.jsx("div",{className:"absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsxs("div",{className:"flex gap-1",children:[o.jsx(c,{variant:"secondary",size:"sm",className:"h-7 w-7 p-0 bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-600",onClick:t=>{t.stopPropagation(),s({conditional_logic:{...e.conditional_logic,hidden:!e.conditional_logic?.hidden}})},children:e.conditional_logic?.hidden?o.jsx(fe,{className:"h-3 w-3"}):o.jsx(ce,{className:"h-3 w-3"})}),o.jsx(c,{variant:"secondary",size:"sm",className:"h-7 w-7 p-0 bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-600",onClick:t=>{t.stopPropagation(),s({id:e.id,_duplicate:!0})},children:o.jsx(ke,{className:"h-3 w-3"})}),o.jsx(c,{variant:"destructive",size:"sm",className:"h-7 w-7 p-0",onClick:t=>{t.stopPropagation(),s({id:e.id,_deleted:!0})},children:o.jsx(Ce,{className:"h-3 w-3"})})]})}),o.jsx("div",{className:"p-3",children:o.jsx(ye,{field:e,fields:t,formData:r,isPreview:!0})}),e.required&&o.jsx("div",{className:"absolute top-2 right-2",children:o.jsx("span",{className:"text-destructive text-sm font-medium",children:"*"})})]})},Xs=n.memo(({fields:e,form:t,selectedFieldId:r,onFieldSelect:a,onFieldUpdate:s,showAllFields:i=!1})=>{const l=n.useMemo(()=>{const e={columns:Math.max(4,t.layout?.columns||4),gridGap:t.layout?.grid_gap||"md",responsive:t.layout?.responsive??!0};return new xe(e)},[t.layout]),c=n.useMemo(()=>i?e:e.filter(e=>!(e.conditional_logic||{}).hidden),[e,i]),d=n.useMemo(()=>l.calculateFieldPositions(c),[l,c]),u=n.useMemo(()=>l.getContainerClasses(),[l]),m=n.useMemo(()=>{const e=new Map;return d.forEach(t=>e.set(t.id,t)),e},[d]);return 0===c.length?o.jsx("div",{className:"flex-1 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg mx-auto mb-4 flex items-center justify-center",children:o.jsx("div",{className:"w-8 h-8 bg-muted-foreground/20 rounded"})}),o.jsx("h3",{className:"text-lg font-bold text-foreground mb-2",children:"Start building your form"}),o.jsx("p",{className:"text-foreground",children:"Drag field types from the toolbar to add them to your form"})]})}):o.jsx(Us,{items:c.map(e=>e.id),strategy:Ls,children:o.jsx("div",{className:`w-full ${u}`,children:c.map(n=>{const i=m.get(n.id);return o.jsx(Gs,{field:n,fields:e,formData:{},isSelected:n.id===r,onSelect:()=>a(n.id),onUpdate:e=>s(n.id,e),responsive:t.layout?.responsive,position:i},n.id)})})})});Xs.displayName="FieldGrid";const Ks=a.memo(({fields:e,form:t,selectedFieldId:r,onFieldSelect:a,onFieldUpdate:s,showAllFields:i=!1})=>{const{setNodeRef:c}=Wn({id:"form-canvas"}),d=n.useCallback(e=>{a(e)},[a]),u=n.useCallback((e,t)=>{s(e,t)},[s]),m=n.useMemo(()=>{if(!t.background)return{};const{type:e,value:r,size:n,position:a,opacity:s}=t.background;return"color"===e?{backgroundColor:r}:"gradient"===e?{background:r}:"image"===e?{backgroundImage:`url(${r})`,backgroundSize:n||"cover",backgroundPosition:a||"center",backgroundRepeat:"no-repeat"}:{}},[t.background]);return o.jsxs("div",{className:"h-full flex flex-col relative",style:{background:"var(--gradient-canvas)",backgroundSize:"40px 40px",backgroundImage:"var(--gradient-canvas-pattern)"},children:[o.jsxs("div",{className:"border-b border-border/50 backdrop-blur-sm px-6 py-4 relative overflow-hidden",style:{background:"var(--gradient-canvas-header)",boxShadow:"var(--shadow-canvas-header)"},children:[o.jsx("div",{className:"relative z-10",children:o.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:["Form Canvas - ",t.title||"Untitled Form"]})}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-foreground/10 to-transparent opacity-50"})]}),o.jsx("div",{className:"flex-1 overflow-auto p-8",children:o.jsxs("div",{ref:c,className:l("min-h-full rounded-2xl border-2 transition-all duration-300 relative overflow-hidden",0===e.length?"border-dashed border-primary/40 hover:border-primary/60 hover:bg-primary/5":"border-solid border-border/30"),style:{...0===e.length?{background:"var(--gradient-canvas-empty)"}:t.background?m:{background:"var(--gradient-canvas-container)"},boxShadow:0===e.length?"var(--shadow-card)":"var(--shadow-canvas-deep), var(--shadow-canvas-container)"},children:["image"===t.background?.type&&void 0!==t.background.opacity&&t.background.opacity>0&&e.length>0&&o.jsx("div",{className:"absolute inset-0 bg-background pointer-events-none z-0",style:{opacity:t.background.opacity/100}}),t.description&&o.jsx("div",{className:"p-6 border-b bg-gradient-to-r from-primary/5 to-accent/5",children:o.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:t.description})}),o.jsx("div",{className:"p-6",children:0===e.length?o.jsx("div",{className:"text-center py-16",children:o.jsxs("div",{className:"max-w-md mx-auto",children:[o.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:o.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),o.jsx("h3",{className:"text-lg font-bold text-foreground mb-2",children:"Start Building Your Form"}),o.jsx("p",{className:"text-foreground mb-4",children:"Drag and drop fields from the left panel to create your form. You can reorder, edit, and customize each field."}),o.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[o.jsx("p",{children:" Choose from text inputs, dropdowns, checkboxes, and more"}),o.jsx("p",{children:" Set up conditional logic and validation rules"}),o.jsx("p",{children:" Customize the appearance and behavior"})]})]})}):o.jsx(Xs,{fields:e,form:t,selectedFieldId:r,onFieldSelect:d,onFieldUpdate:u,showAllFields:i})})]})})]})});Ks.displayName="FormBuilderCanvas";const Js=[];for(let xo=0;xo<256;++xo)Js.push((xo+256).toString(16).slice(1));let Zs;const Qs=new Uint8Array(16);const ei={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ti(e,t,r){if(ei.randomUUID&&!e)return ei.randomUUID();const n=(e=e||{}).random??e.rng?.()??function(){if(!Zs){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Zs=crypto.getRandomValues.bind(crypto)}return Zs(Qs)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e,t=0){return(Js[e[t+0]]+Js[e[t+1]]+Js[e[t+2]]+Js[e[t+3]]+"-"+Js[e[t+4]]+Js[e[t+5]]+"-"+Js[e[t+6]]+Js[e[t+7]]+"-"+Js[e[t+8]]+Js[e[t+9]]+"-"+Js[e[t+10]]+Js[e[t+11]]+Js[e[t+12]]+Js[e[t+13]]+Js[e[t+14]]+Js[e[t+15]]).toLowerCase()}(n)}const ri=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"contains",label:"Contains"},{value:"greater_than",label:"Greater Than"},{value:"less_than",label:"Less Than"},{value:"is_empty",label:"Is Empty"},{value:"is_not_empty",label:"Is Not Empty"}],ni=({field:e,fields:t,onUpdate:r})=>{const n=t.filter(t=>t.id!==e.id),a=(()=>{if(!e.logic_conditions)return{action:"show",conditions:[]};try{if("string"==typeof e.logic_conditions)return JSON.parse(e.logic_conditions);if("object"==typeof e.logic_conditions)return e.logic_conditions}catch(t){}return{action:"show",conditions:[]}})(),s=e=>{const t={...a,...e};r(t.conditions.length>0?t:null)},i=(e,t)=>{const r=[...a.conditions];r[e]={...r[e],...t},s({conditions:r})};return o.jsxs(u,{children:[o.jsx(m,{children:o.jsx(h,{className:"text-sm",children:"Conditional Logic"})}),o.jsxs(f,{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(Y,{value:a.action,onValueChange:e=>s({action:e}),children:[o.jsx(W,{className:"w-24",children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"show",children:"Show"}),o.jsx(K,{value:"hide",children:"Hide"})]})]}),o.jsx("span",{className:"text-sm text-muted-foreground",children:"this field if:"})]}),a.conditions.map((e,t)=>o.jsxs("div",{className:"space-y-2",children:[t>0&&o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs(Y,{value:a.conditions[t-1].logicOperator||"AND",onValueChange:e=>i(t-1,{logicOperator:e}),children:[o.jsx(W,{className:"w-20",children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"AND",children:"AND"}),o.jsx(K,{value:"OR",children:"OR"})]})]})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(Y,{value:e.fieldId,onValueChange:e=>i(t,{fieldId:e}),children:[o.jsx(W,{className:"flex-1",children:o.jsx(G,{placeholder:"Select field"})}),o.jsx(X,{children:n.map(e=>o.jsx(K,{value:e.id,children:e.label},e.id))})]}),o.jsxs(Y,{value:e.operator,onValueChange:e=>i(t,{operator:e}),children:[o.jsx(W,{className:"w-32",children:o.jsx(G,{})}),o.jsx(X,{children:ri.map(e=>o.jsx(K,{value:e.value,children:e.label},e.value))})]}),!["is_empty","is_not_empty"].includes(e.operator)&&o.jsx(H,{value:e.value,onChange:e=>i(t,{value:e.target.value}),placeholder:"Value",className:"flex-1"}),o.jsx(c,{variant:"outline",size:"sm",onClick:()=>(e=>{const t=a.conditions.filter((t,r)=>r!==e);s({conditions:t})})(t),children:o.jsx(Ce,{className:"h-4 w-4"})})]})]},e.id)),o.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{const e={id:ti(),fieldId:"",operator:"equals",value:"",logicOperator:a.conditions.length>0?"AND":void 0};s({conditions:[...a.conditions,e]})},className:"w-full",children:[o.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Condition"]}),a.conditions.length>0&&o.jsx(c,{variant:"ghost",size:"sm",onClick:()=>r(null),className:"w-full text-destructive",children:"Clear All Conditions"})]})]})},ai=({field:e,fields:t,onUpdate:r})=>{const[a,s]=n.useState({}),{validateExpression:i,formatResult:l}=je(t,a),d=t.filter(t=>["number","slider","rating"].includes(t.type)&&t.id!==e.id),p=(()=>{if(!e.calculations)return{id:"",expression:"",format:"number",decimalPlaces:2};try{if("string"==typeof e.calculations)return JSON.parse(e.calculations);if("object"==typeof e.calculations)return e.calculations}catch(t){}return{id:"",expression:"",format:"number",decimalPlaces:2}})(),g=e=>{const t={...p,...e};r(t.expression?t:null)},v=i(p.expression||""),x=p.expression?l(v.isValid?Function(`"use strict"; return (${p.expression.replace(/\{[^}]+\}/g,"10")})`)():0,p.format,p.decimalPlaces):"";return o.jsxs(u,{children:[o.jsx(m,{children:o.jsxs(h,{className:"text-sm flex items-center gap-2",children:[o.jsx(dt,{className:"h-4 w-4"}),"Calculations"]})}),o.jsxs(f,{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{children:"Formula"}),o.jsx(H,{value:p.expression||"",onChange:e=>g({expression:e.target.value}),placeholder:"e.g., {Quantity} * {Price} + {Tax}",className:v.isValid?"":"border-destructive"}),!v.isValid&&v.error&&o.jsx("p",{className:"text-sm text-destructive",children:v.error})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{children:"Available Fields"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:d.map(e=>o.jsxs(J,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",onClick:()=>(e=>{const r=t.find(t=>t.id===e);if(!r)return;const n=(p.expression||"")+`{${r.label}}`;g({expression:n})})(e.id),children:[o.jsx(Ae,{className:"h-3 w-3 mr-1"}),e.label]},e.id))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{children:"Operators"}),o.jsx("div",{className:"flex gap-1",children:["+","-","*","/","(",")"].map(e=>o.jsx(c,{variant:"outline",size:"sm",onClick:()=>(e=>{const t=p.expression||"";g({expression:t+` ${e} `})})(e),className:"w-8 h-8 p-0",children:e},e))})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{children:"Format"}),o.jsxs(Y,{value:p.format||"number",onValueChange:e=>g({format:e}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"number",children:"Number"}),o.jsx(K,{value:"currency",children:"Currency"}),o.jsx(K,{value:"percentage",children:"Percentage"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{children:"Decimal Places"}),o.jsxs(Y,{value:String(p.decimalPlaces||2),onValueChange:e=>g({decimalPlaces:Number(e)}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"0",children:"0"}),o.jsx(K,{value:"1",children:"1"}),o.jsx(K,{value:"2",children:"2"}),o.jsx(K,{value:"3",children:"3"}),o.jsx(K,{value:"4",children:"4"})]})]})]})]}),p.expression&&v.isValid&&o.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[o.jsx(Se,{className:"text-xs text-muted-foreground",children:"Preview"}),o.jsx("p",{className:"text-sm font-medium",children:x}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"(with sample values of 10 for each field)"})]}),p.expression&&o.jsx(c,{variant:"ghost",size:"sm",onClick:()=>r(null),className:"w-full text-destructive",children:"Clear Formula"})]})]})},si=({field:e,onUpdate:t})=>{const r=(()=>{if(!e.validation_rules)return[];if("string"==typeof e.validation_rules)try{return JSON.parse(e.validation_rules)}catch(t){return[]}return Array.isArray(e.validation_rules)?e.validation_rules:[]})(),n=e=>{t(e)},a=(e,t)=>{const a=r.findIndex(t=>t.type===e),s=[...r];a>=0?s[a]={...s[a],...t}:s.push({type:e,...t}),n(s)},s=e=>{n(r.filter(t=>t.type!==e))},i=e=>r.find(t=>t.type===e),l=e=>r.some(t=>t.type===e),c=["number","slider","rating"].includes(e.type),d=["text","textarea","email","phone","url"].includes(e.type),p="file"===e.type;return o.jsxs(u,{children:[o.jsx(m,{children:o.jsxs(h,{className:"text-sm flex items-center gap-2",children:[o.jsx(yt,{className:"h-4 w-4"}),"Validation Rules"]})}),o.jsxs(f,{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Required Field"}),o.jsx(_e,{checked:l("required"),onCheckedChange:e=>{e?a("required",{message:"This field is required"}):s("required")}})]}),l("required")&&o.jsxs("div",{className:"ml-4 space-y-2",children:[o.jsx(Se,{className:"text-xs",children:"Custom Error Message"}),o.jsx(H,{value:i("required")?.message||"",onChange:e=>a("required",{message:e.target.value}),placeholder:"This field is required"})]}),d&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Minimum Length"}),o.jsx(_e,{checked:l("minLength"),onCheckedChange:e=>{e?a("minLength",{value:1,message:"Text is too short"}):s("minLength")}})]}),l("minLength")&&o.jsxs("div",{className:"ml-4 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Characters"}),o.jsx(H,{type:"number",value:i("minLength")?.value||"",onChange:e=>a("minLength",{value:Number(e.target.value)}),min:"1"})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("minLength")?.message||"",onChange:e=>a("minLength",{message:e.target.value}),placeholder:"Text is too short"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Maximum Length"}),o.jsx(_e,{checked:l("maxLength"),onCheckedChange:e=>{e?a("maxLength",{value:100,message:"Text is too long"}):s("maxLength")}})]}),l("maxLength")&&o.jsxs("div",{className:"ml-4 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Characters"}),o.jsx(H,{type:"number",value:i("maxLength")?.value||"",onChange:e=>a("maxLength",{value:Number(e.target.value)}),min:"1"})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("maxLength")?.message||"",onChange:e=>a("maxLength",{message:e.target.value}),placeholder:"Text is too long"})]})]})]})]}),c&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Minimum Value"}),o.jsx(_e,{checked:l("min"),onCheckedChange:e=>{e?a("min",{value:0,message:"Value is too low"}):s("min")}})]}),l("min")&&o.jsxs("div",{className:"ml-4 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Value"}),o.jsx(H,{type:"number",value:i("min")?.value||"",onChange:e=>a("min",{value:Number(e.target.value)})})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("min")?.message||"",onChange:e=>a("min",{message:e.target.value}),placeholder:"Value is too low"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Maximum Value"}),o.jsx(_e,{checked:l("max"),onCheckedChange:e=>{e?a("max",{value:100,message:"Value is too high"}):s("max")}})]}),l("max")&&o.jsxs("div",{className:"ml-4 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Value"}),o.jsx(H,{type:"number",value:i("max")?.value||"",onChange:e=>a("max",{value:Number(e.target.value)})})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("max")?.message||"",onChange:e=>a("max",{message:e.target.value}),placeholder:"Value is too high"})]})]})]})]}),d&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Custom Pattern"}),o.jsx(_e,{checked:l("pattern"),onCheckedChange:e=>{e?a("pattern",{value:"",message:"Invalid format"}):s("pattern")}})]}),l("pattern")&&o.jsxs("div",{className:"ml-4 space-y-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Regex Pattern"}),o.jsx(H,{value:i("pattern")?.value||"",onChange:e=>a("pattern",{value:e.target.value}),placeholder:"^[A-Za-z0-9]+$"})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("pattern")?.message||"",onChange:e=>a("pattern",{message:e.target.value}),placeholder:"Invalid format"})]})]})]}),p&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"File Size Limit"}),o.jsx(_e,{checked:l("fileSize"),onCheckedChange:e=>{e?a("fileSize",{value:5,message:"File is too large"}):s("fileSize")}})]}),l("fileSize")&&o.jsxs("div",{className:"ml-4 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Size (MB)"}),o.jsx(H,{type:"number",value:i("fileSize")?.value||"",onChange:e=>a("fileSize",{value:Number(e.target.value)}),min:"0.1",step:"0.1"})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("fileSize")?.message||"",onChange:e=>a("fileSize",{message:e.target.value}),placeholder:"File is too large"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Allowed File Types"}),o.jsx(_e,{checked:l("fileTypes"),onCheckedChange:e=>{e?a("fileTypes",{value:"jpg,png,pdf",message:"File type not allowed"}):s("fileTypes")}})]}),l("fileTypes")&&o.jsxs("div",{className:"ml-4 space-y-2",children:[o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Extensions (comma-separated)"}),o.jsx(H,{value:i("fileTypes")?.value||"",onChange:e=>a("fileTypes",{value:e.target.value}),placeholder:"jpg,png,pdf,doc,docx"})]}),o.jsxs("div",{children:[o.jsx(Se,{className:"text-xs",children:"Error Message"}),o.jsx(H,{value:i("fileTypes")?.message||"",onChange:e=>a("fileTypes",{message:e.target.value}),placeholder:"File type not allowed"})]})]})]})]})]})]})},ii=({field:e,onUpdate:t})=>{const r=[{value:"left",icon:ot,label:"Left"},{value:"center",icon:it,label:"Center"},{value:"right",icon:lt,label:"Right"}];return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[o.jsx(pt,{className:"h-4 w-4"}),"Layout Settings"]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Field Width"}),o.jsxs(Y,{value:e.width||"full",onValueChange:e=>t({width:e}),children:[o.jsx(W,{className:"w-full",children:o.jsx(G,{placeholder:"Select width"})}),o.jsx(X,{children:[{value:"full",label:"Full Width (100%)",icon:""},{value:"half",label:"Half Width (50%)",icon:""},{value:"quarter",label:"Quarter Width (25%)",icon:""}].map(e=>o.jsx(K,{value:e.value,children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"font-mono text-xs",children:e.icon}),e.label]})},e.value))})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Alignment"}),o.jsx("div",{className:"flex gap-1",children:r.map(r=>{const n=r.icon;return o.jsx(c,{variant:e.alignment===r.value?"default":"outline",size:"sm",onClick:()=>t({alignment:r.value}),className:"flex-1",children:o.jsx(n,{className:"h-4 w-4"})},r.value)})})]})]})};function oi(e){const t=li(e),r=n.forwardRef((e,r)=>{const{children:a,...s}=e,i=n.Children.toArray(a),l=i.find(di);if(l){const e=l.props.children,a=i.map(t=>t===l?n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null:t);return o.jsx(t,{...s,ref:r,children:n.isValidElement(e)?n.cloneElement(e,void 0,a):null})}return o.jsx(t,{...s,ref:r,children:a})});return r.displayName=`${e}.Slot`,r}function li(e){const t=n.forwardRef((e,t)=>{const{children:r,...a}=e;if(n.isValidElement(r)){const e=function(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;if(r)return e.ref;if(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(r),s=function(e,t){const r={...t};for(const n in t){const a=e[n],s=t[n];/^on[A-Z]/.test(n)?a&&s?r[n]=(...e)=>{const t=s(...e);return a(...e),t}:a&&(r[n]=a):"style"===n?r[n]={...a,...s}:"className"===n&&(r[n]=[a,s].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==n.Fragment&&(s.ref=t?p(t,e):e),n.cloneElement(r,s)}return n.Children.count(r)>1?n.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var ci=Symbol("radix.slottable");function di(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===ci}var ui="Popover",[mi]=S(ui,[N]),hi=N(),[fi,pi]=mi(ui),gi=e=>{const{__scopePopover:t,children:r,open:a,defaultOpen:s,onOpenChange:i,modal:l=!1}=e,c=hi(t),d=n.useRef(null),[u,m]=n.useState(!1),[h,f]=g({prop:a,defaultProp:s??!1,onChange:i,caller:ui});return o.jsx(v,{...c,children:o.jsx(fi,{scope:t,contentId:x(),triggerRef:d,open:h,onOpenChange:f,onOpenToggle:n.useCallback(()=>f(e=>!e),[f]),hasCustomAnchor:u,onCustomAnchorAdd:n.useCallback(()=>m(!0),[]),onCustomAnchorRemove:n.useCallback(()=>m(!1),[]),modal:l,children:r})})};gi.displayName=ui;var vi="PopoverAnchor";n.forwardRef((e,t)=>{const{__scopePopover:r,...a}=e,s=pi(vi,r),i=hi(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:c}=s;return n.useEffect(()=>(l(),()=>c()),[l,c]),o.jsx(w,{...i,...a,ref:t})}).displayName=vi;var xi="PopoverTrigger",bi=n.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,a=pi(xi,r),s=hi(r),i=b(t,a.triggerRef),l=o.jsx(y.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Ii(a.open),...n,ref:i,onClick:j(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:o.jsx(w,{asChild:!0,...s,children:l})});bi.displayName=xi;var yi="PopoverPortal",[ji,wi]=mi(yi,{forceMount:void 0}),Ni=e=>{const{__scopePopover:t,forceMount:r,children:n,container:a}=e,s=pi(yi,t);return o.jsx(ji,{scope:t,forceMount:r,children:o.jsx(k,{present:r||s.open,children:o.jsx(C,{asChild:!0,container:a,children:n})})})};Ni.displayName=yi;var ki="PopoverContent",Ci=n.forwardRef((e,t)=>{const r=wi(ki,e.__scopePopover),{forceMount:n=r.forceMount,...a}=e,s=pi(ki,e.__scopePopover);return o.jsx(k,{present:n||s.open,children:s.modal?o.jsx(_i,{...a,ref:t}):o.jsx(Di,{...a,ref:t})})});Ci.displayName=ki;var Si=oi("PopoverContent.RemoveScroll"),_i=n.forwardRef((e,t)=>{const r=pi(ki,e.__scopePopover),a=n.useRef(null),s=b(t,a),i=n.useRef(!1);return n.useEffect(()=>{const e=a.current;if(e)return Pe(e)},[]),o.jsx(Le,{as:Si,allowPinchZoom:!0,children:o.jsx(Ei,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:j(e.onCloseAutoFocus,e=>{e.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:j(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;i.current=n},{checkForDefaultPrevented:!1}),onFocusOutside:j(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Di=n.forwardRef((e,t)=>{const r=pi(ki,e.__scopePopover),a=n.useRef(!1),s=n.useRef(!1);return o.jsx(Ei,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(a.current||r.triggerRef.current?.focus(),t.preventDefault()),a.current=!1,s.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(a.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));const n=t.target,i=r.triggerRef.current?.contains(n);i&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})}),Ei=n.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...m}=e,h=pi(ki,r),f=hi(r);return Te(),o.jsx(Oe,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:s,children:o.jsx(_,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:o.jsx(D,{"data-state":Ii(h.open),role:"dialog",id:h.contentId,...f,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ri="PopoverClose";n.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,a=pi(Ri,r);return o.jsx(y.button,{type:"button",...n,ref:t,onClick:j(e.onClick,()=>a.onOpenChange(!1))})}).displayName=Ri;function Ii(e){return e?"open":"closed"}n.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,a=hi(r);return o.jsx(E,{...a,...n,ref:t})}).displayName="PopoverArrow";var Fi=Ni,Mi=Ci;const Ai=gi,zi=bi,Pi=n.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},a)=>o.jsx(Fi,{children:o.jsx(Mi,{ref:a,align:t,sideOffset:r,className:l("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Pi.displayName=Mi.displayName;const Li=({fields:e,urlParams:t=[],onInsert:r})=>{const[a,s]=n.useState(!1),i=e.filter(e=>e.ref&&!["divider","html","pagebreak","section"].includes(e.type)).sort((e,t)=>e.order_index-t.order_index),l=e.filter(e=>e.ref&&"calculated"===e.type).sort((e,t)=>e.order_index-t.order_index),d=e=>{r(e),s(!1)};return o.jsxs(Ai,{open:a,onOpenChange:s,children:[o.jsx(zi,{asChild:!0,children:o.jsxs(c,{variant:"outline",size:"sm",className:"gap-1.5",children:[o.jsx(Ue,{className:"h-3.5 w-3.5"}),"Recall"]})}),o.jsx(Pi,{className:"w-80 p-0",align:"start",children:o.jsx(De,{className:"max-h-[400px]",children:o.jsxs("div",{className:"p-4 space-y-4",children:[i.length>0&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:"Answers"}),o.jsx("div",{className:"space-y-1",children:i.map(e=>o.jsx("button",{onClick:()=>d(`{{field:${e.ref}}}`),className:"w-full text-left p-2 hover:bg-accent rounded-md transition-colors",children:o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsx("span",{className:"text-sm font-medium",children:e.label}),o.jsx("code",{className:"text-xs text-muted-foreground",children:"{{field:"+e.ref+"}}"})]})},e.id))})]}),t.length>0&&o.jsxs(o.Fragment,{children:[i.length>0&&o.jsx(Me,{}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:"URL Parameters"}),o.jsx("div",{className:"space-y-1",children:t.map(e=>o.jsx("button",{onClick:()=>d(`{{param:${e.name}}}`),className:"w-full text-left p-2 hover:bg-accent rounded-md transition-colors",children:o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsx("span",{className:"text-sm font-medium",children:e.label||e.name}),o.jsx("code",{className:"text-xs text-muted-foreground",children:"{{param:"+e.name+"}}"})]})},e.name))})]})]}),l.length>0&&o.jsxs(o.Fragment,{children:[(i.length>0||t.length>0)&&o.jsx(Me,{}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:"Variables (Calculated)"}),o.jsx("div",{className:"space-y-1",children:l.map(e=>o.jsx("button",{onClick:()=>d(`{{var:${e.ref}}}`),className:"w-full text-left p-2 hover:bg-accent rounded-md transition-colors",children:o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsx("span",{className:"text-sm font-medium",children:e.label}),o.jsx("code",{className:"text-xs text-muted-foreground",children:"{{var:"+e.ref+"}}"})]})},e.id))})]})]}),0===i.length&&0===t.length&&0===l.length&&o.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No Recall options available. Add field references or URL parameters to use Recall."})]})})})]})},Ti=({label:e,value:t,onChange:r,fields:a,urlParams:s,multiline:i=!1,placeholder:l,id:c,hint:d})=>{const u=n.useRef(null),m=i?ze:H;return o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{htmlFor:c,children:e}),o.jsx(Li,{fields:a,urlParams:s,onInsert:e=>{if(!u.current)return;const n=u.current,a=n.selectionStart||0,s=n.selectionEnd||0,i=t.substring(0,a)+e+t.substring(s);r(i),setTimeout(()=>{n.focus(),n.setSelectionRange(a+e.length,a+e.length)},0)}})]}),o.jsx(m,{ref:u,id:c,value:t,onChange:e=>r(e.target.value),placeholder:l,rows:i?3:void 0}),d&&o.jsx("p",{className:"text-xs text-muted-foreground",children:d})]})},Oi=({field:e,fields:t,onUpdate:r})=>{if(!e)return o.jsxs("div",{className:"h-full rounded-none border-0 relative overflow-hidden",style:{background:"var(--gradient-settings-card)",boxShadow:"var(--shadow-settings-card)"},children:[o.jsx("div",{className:"px-6 py-5 border-b border-border/30 relative overflow-hidden",style:{background:"var(--gradient-settings-header)",boxShadow:"var(--shadow-settings-elevated)"},children:o.jsxs("div",{className:"relative z-10",children:[o.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Field Settings"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-40"})]})}),o.jsx("div",{className:"p-6",children:o.jsx("div",{className:"flex items-center justify-center h-96 text-center",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-primary/10 to-accent/10 flex items-center justify-center",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary/20 to-accent/20"})}),o.jsx("p",{className:"text-muted-foreground font-medium",children:"No field selected"}),o.jsx("p",{className:"text-sm text-muted-foreground max-w-sm",children:"Click on a field in the form to edit its settings"})]})})})]});const n=["checkbox","radio","select"].includes(e.type),a=e.options||[];return o.jsxs("div",{className:"h-full rounded-none border-0 relative overflow-hidden",style:{background:"var(--gradient-settings-card)",boxShadow:"var(--shadow-settings-card)"},children:[o.jsx("div",{className:"px-6 py-5 border-b border-border/30 relative overflow-hidden",style:{background:"var(--gradient-settings-header)",boxShadow:"var(--shadow-settings-elevated)"},children:o.jsxs("div",{className:"relative z-10",children:[o.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Field Settings"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-40"})]})}),o.jsx("div",{className:"p-0",children:o.jsx(De,{className:"h-[calc(100vh-9rem)]",children:o.jsx("div",{className:"p-6",children:o.jsxs(Ee,{defaultValue:"general",className:"w-full",children:[o.jsxs(Re,{className:"grid w-full grid-cols-5",children:[o.jsx(Ie,{value:"general",children:"General"}),o.jsx(Ie,{value:"layout",children:"Layout"}),o.jsx(Ie,{value:"validation",children:"Validate"}),o.jsx(Ie,{value:"logic",children:"Logic"}),o.jsx(Ie,{value:"calculations",children:"Math"})]}),o.jsxs(Fe,{value:"general",className:"space-y-4 mt-4",children:[o.jsx(Ti,{label:"Field Label",id:"field-label",value:e.label,onChange:e=>r({label:e}),fields:t,placeholder:"Enter field label",hint:"Use Recall tokens like {{field:name}} or {{param:source}}"}),o.jsx(Ti,{label:"Description",id:"field-description",value:e.description||"",onChange:e=>r({description:e}),fields:t,multiline:!0,placeholder:"Optional description or help text",hint:"Add help text with dynamic values using Recall"}),!["checkbox","radio","file","rating","divider","html"].includes(e.type)&&o.jsx(Ti,{label:"Placeholder",id:"field-placeholder",value:e.placeholder||"",onChange:e=>r({placeholder:e}),fields:t,placeholder:"Enter placeholder text"}),o.jsx(Me,{}),o.jsxs("div",{className:"space-y-2 p-3 bg-muted/50 rounded-lg border border-border/50",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Se,{htmlFor:"field-ref",className:"text-sm font-medium",children:"Reference Key (Advanced)"}),o.jsx(J,{variant:"outline",className:"text-xs",children:"Recall"})]}),o.jsx(H,{id:"field-ref",value:e.ref||"",onChange:e=>{const t=e.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_").replace(/^_+|_+$/g,"");r({ref:t||void 0})},placeholder:"e.g., full_name, company, rating",className:"font-mono text-sm"}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:["Use in Recall as ",o.jsx("code",{className:"px-1 py-0.5 bg-background rounded",children:"{{field:"+(e.ref||"your_ref")+"}}"})]}),!e.ref&&o.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:" Tip: Set this to reference field values in labels, descriptions, or thank-you text"})]}),"divider"!==e.type&&"html"!==e.type&&o.jsxs(o.Fragment,{children:[o.jsx(Me,{}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx(Se,{htmlFor:"field-required",children:"Required Field"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Make this field mandatory"})]}),o.jsx(_e,{id:"field-required",checked:e.required,onCheckedChange:e=>r({required:e})})]})]}),n&&o.jsxs(o.Fragment,{children:[o.jsx(Me,{}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{children:"Options"}),o.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{const e=[...a,`Option ${a.length+1}`];r({options:e})},children:[o.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Option"]})]}),o.jsx("div",{className:"space-y-2",children:a.map((e,t)=>o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(H,{value:e,onChange:e=>((e,t)=>{const n=[...a];n[e]=t,r({options:n})})(t,e.target.value),placeholder:`Option ${t+1}`}),o.jsx(c,{variant:"outline",size:"sm",onClick:()=>(e=>{const t=a.filter((t,r)=>r!==e);r({options:t})})(t),disabled:a.length<=1,children:o.jsx(Ce,{className:"h-4 w-4"})})]},t))})]})]})]}),o.jsx(Fe,{value:"layout",className:"space-y-4 mt-4",children:o.jsx(ii,{field:e,onUpdate:r})}),o.jsx(Fe,{value:"validation",className:"space-y-4 mt-4",children:o.jsx(si,{field:e,onUpdate:e=>{try{const t=e?.map(e=>({type:e.type,value:e.value,message:e.message}))||[],n=JSON.stringify(t);r({validation_rules:n})}catch(t){r({validation_rules:JSON.stringify([])})}}})}),o.jsx(Fe,{value:"logic",className:"space-y-4 mt-4",children:o.jsx(ni,{field:e,fields:t,onUpdate:e=>r({logic_conditions:e?JSON.stringify(e):null})})}),o.jsx(Fe,{value:"calculations",className:"space-y-4 mt-4",children:o.jsx(ai,{field:e,fields:t,onUpdate:e=>r({calculations:e?JSON.stringify(e):null})})})]})})})})]})},Ui=({form:e,onUpdate:t})=>{const r=r=>{t({...e,layout:{...e.layout,...r}})},n=e.layout?.columns||1,a=e.layout?.responsive??!0;return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[o.jsx(pt,{className:"h-4 w-4"}),"Form Layout Settings"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Grid Columns"}),o.jsxs(Y,{value:n.toString(),onValueChange:e=>r({columns:parseInt(e)}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"1",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-8 h-4 border border-border bg-muted rounded-sm"}),"1 Column"]})}),o.jsx(K,{value:"2",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex gap-0.5",children:[o.jsx("div",{className:"w-3.5 h-4 border border-border bg-muted rounded-sm"}),o.jsx("div",{className:"w-3.5 h-4 border border-border bg-muted rounded-sm"})]}),"2 Columns"]})}),o.jsx(K,{value:"3",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex gap-0.5",children:[o.jsx("div",{className:"w-2 h-4 border border-border bg-muted rounded-sm"}),o.jsx("div",{className:"w-2 h-4 border border-border bg-muted rounded-sm"}),o.jsx("div",{className:"w-2 h-4 border border-border bg-muted rounded-sm"})]}),"3 Columns"]})}),o.jsx(K,{value:"4",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex gap-0.5",children:[o.jsx("div",{className:"w-1.5 h-4 border border-border bg-muted rounded-sm"}),o.jsx("div",{className:"w-1.5 h-4 border border-border bg-muted rounded-sm"}),o.jsx("div",{className:"w-1.5 h-4 border border-border bg-muted rounded-sm"}),o.jsx("div",{className:"w-1.5 h-4 border border-border bg-muted rounded-sm"})]}),"4 Columns"]})})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum number of columns for field layout"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Grid Spacing"}),o.jsxs(Y,{value:e.layout?.grid_gap||"gap-4",onValueChange:e=>r({grid_gap:e}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"gap-2",children:"Small (8px)"}),o.jsx(K,{value:"gap-4",children:"Medium (16px)"}),o.jsx(K,{value:"gap-6",children:"Large (24px)"}),o.jsx(K,{value:"gap-8",children:"Extra Large (32px)"})]})]})]}),o.jsx("div",{className:"space-y-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs(Se,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx($e,{className:"h-4 w-4"}),"Mobile Responsive"]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically stack fields on mobile devices"})]}),o.jsx(_e,{checked:a,onCheckedChange:e=>r({responsive:e})})]})}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs(Se,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(mt,{className:"h-4 w-4"}),"Layout Preview"]}),o.jsxs("div",{className:"border border-border rounded-lg p-4 bg-card",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[o.jsx(Ve,{className:"h-3 w-3"}),"Desktop View"]}),o.jsx("div",{className:`grid grid-cols-${n} gap-2`,children:Array.from({length:2*n}).map((e,t)=>o.jsx("div",{className:"h-8 bg-muted rounded border border-border"},t))})]}),a&&o.jsxs("div",{className:"space-y-2 mt-4",children:[o.jsxs("div",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[o.jsx($e,{className:"h-3 w-3"}),"Mobile View"]}),o.jsx("div",{className:"grid grid-cols-1 gap-2",children:Array.from({length:4}).map((e,t)=>o.jsx("div",{className:"h-6 bg-muted rounded border border-border"},t))})]})]})]})]})},$i=({form:e,onUpdate:t})=>{const[r,a]=n.useState(e.background?.value||"#ffffff"),s=r=>{t({...e,background:{...e.background,...r}})},i=e.background?.type||"color";return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[o.jsx(qe,{className:"h-4 w-4"}),"Background Settings"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Background Type"}),o.jsxs(Y,{value:i,onValueChange:e=>s({type:e}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"color",children:"Solid Color"}),o.jsx(K,{value:"gradient",children:"Gradient"}),o.jsx(K,{value:"image",children:"Background Image"})]})]})]}),"color"===i&&o.jsxs("div",{className:"space-y-3",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Background Color"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("div",{className:"flex-1",children:o.jsx(H,{type:"color",value:r,onChange:e=>{a(e.target.value),s({type:"color",value:e.target.value})},className:"h-10"})}),o.jsx(H,{type:"text",value:r,onChange:e=>{a(e.target.value),s({type:"color",value:e.target.value})},placeholder:"#ffffff",className:"flex-2"})]})]}),"gradient"===i&&o.jsxs("div",{className:"space-y-3",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Gradient Presets"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{name:"Primary",value:"linear-gradient(135deg, hsl(262 83% 58%), hsl(270 91% 68%))"},{name:"Secondary",value:"linear-gradient(135deg, hsl(189 94% 43%), hsl(189 100% 28%))"},{name:"Hero",value:"linear-gradient(135deg, hsl(262 83% 58%) 0%, hsl(189 94% 43%) 100%)"},{name:"Sunset",value:"linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%)"},{name:"Ocean",value:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{name:"Forest",value:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"}].map(e=>o.jsxs(c,{variant:"outline",className:"h-12 p-2",onClick:()=>s({type:"gradient",value:e.value}),children:[o.jsx("div",{className:"w-full h-full rounded border border-border",style:{background:e.value}}),o.jsx("span",{className:"ml-2 text-xs",children:e.name})]},e.name))}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{className:"text-sm",children:"Custom Gradient CSS"}),o.jsx(H,{value:e.background?.value||"",onChange:e=>s({type:"gradient",value:e.target.value}),placeholder:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter CSS gradient syntax"})]})]}),"image"===i&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{className:"text-sm font-medium",children:"Background Image URL"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(H,{value:e.background?.value||"",onChange:e=>s({type:"image",value:e.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1"}),o.jsx(c,{variant:"outline",size:"icon",children:o.jsx(we,{className:"h-4 w-4"})})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{className:"text-sm",children:"Background Size"}),o.jsxs(Y,{value:e.background?.size||"cover",onValueChange:e=>s({size:e}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"cover",children:"Cover (Fill)"}),o.jsx(K,{value:"contain",children:"Contain (Fit)"}),o.jsx(K,{value:"auto",children:"Auto (Original)"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{className:"text-sm",children:"Background Position"}),o.jsxs(Y,{value:e.background?.position||"center",onValueChange:e=>s({position:e}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"center",children:"Center"}),o.jsx(K,{value:"top",children:"Top"}),o.jsx(K,{value:"bottom",children:"Bottom"}),o.jsx(K,{value:"left",children:"Left"}),o.jsx(K,{value:"right",children:"Right"}),o.jsx(K,{value:"top left",children:"Top Left"}),o.jsx(K,{value:"top right",children:"Top Right"}),o.jsx(K,{value:"bottom left",children:"Bottom Left"}),o.jsx(K,{value:"bottom right",children:"Bottom Right"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(Se,{className:"text-sm",children:["Overlay Opacity (",e.background?.opacity||0,"%)"]}),o.jsx(Ne,{value:[e.background?.opacity||0],onValueChange:([e])=>s({opacity:e}),max:100,step:1,className:"w-full"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Add dark overlay to improve text readability"})]})]})]}),e.background&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs(Se,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(Be,{className:"h-4 w-4"}),"Preview"]}),o.jsxs("div",{className:"w-full h-24 rounded-lg border border-border relative overflow-hidden",style:{..."color"===i&&{backgroundColor:e.background.value},..."gradient"===i&&{background:e.background.value},..."image"===i&&{backgroundImage:`url(${e.background.value})`,backgroundSize:e.background.size||"cover",backgroundPosition:e.background.position||"center",backgroundRepeat:"no-repeat"}},children:["image"===i&&void 0!==e.background.opacity&&o.jsx("div",{className:"absolute inset-0 bg-background",style:{opacity:e.background.opacity/100}}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("span",{className:"text-foreground text-sm font-medium",children:"Form Preview"})}),o.jsx(c,{variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6",onClick:()=>t({...e,background:void 0}),children:o.jsx(R,{className:"h-3 w-3"})})]})]})]})},Vi=new Set(["embed","mode","org_id","theme","lang","progress","hideTitle","hideDescription"]),qi=/^[a-zA-Z0-9_]+$/,Bi=e=>Vi.has(e),Hi=({form:e,onUpdate:t})=>{const r=e.url_params_config||[],n=(n,a)=>{const s=[...r];s[n]={...s[n],...a},t({...e,url_params_config:s})},a=(e,t)=>{if(!e)return"Parameter name is required";if(!(e=>qi.test(e)&&!Bi(e))(e))return Bi(e)?`"${e}" is a reserved parameter name`:"Use only letters, numbers, and underscores";return-1!==r.findIndex((r,n)=>n!==t&&r.name===e)?"Parameter name must be unique":null};return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"URL Parameters & Hidden Data"}),o.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Define parameters that can be passed via URL or embed code to capture additional context with each response."})]}),o.jsxs(I,{children:[o.jsx(Q,{className:"h-4 w-4"}),o.jsx(F,{children:"Parameters can be set statically in embed code or passed dynamically from the page URL (transitive). Use these to capture UTM parameters, user IDs, or any contextual data."})]}),o.jsx("div",{className:"space-y-4",children:r.map((s,i)=>{const l=a(s.name,i);return o.jsxs(u,{children:[o.jsx(m,{className:"pb-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(h,{className:"text-base",children:s.name||`Parameter ${i+1}`}),o.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(n=>{const a=r.filter((e,t)=>t!==n);t({...e,url_params_config:a})})(i),children:o.jsx(Ce,{className:"h-4 w-4"})})]})}),o.jsxs(f,{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsxs(Se,{htmlFor:`param-name-${i}`,children:["Parameter Name ",o.jsx("span",{className:"text-destructive",children:"*"})]}),o.jsx(H,{id:`param-name-${i}`,value:s.name,onChange:e=>n(i,{name:e.target.value}),placeholder:"e.g., user_id, utm_source",className:l?"border-destructive":""}),l&&o.jsx("p",{className:"text-sm text-destructive mt-1",children:l})]}),o.jsxs("div",{children:[o.jsx(Se,{htmlFor:`param-label-${i}`,children:"Label (Optional)"}),o.jsx(H,{id:`param-label-${i}`,value:s.label||"",onChange:e=>n(i,{label:e.target.value}),placeholder:"Human-readable label"})]}),o.jsxs("div",{children:[o.jsx(Se,{htmlFor:`param-desc-${i}`,children:"Description (Optional)"}),o.jsx(ze,{id:`param-desc-${i}`,value:s.description||"",onChange:e=>n(i,{description:e.target.value}),placeholder:"What is this parameter used for?",rows:2})]}),o.jsxs("div",{children:[o.jsx(Se,{htmlFor:`param-default-${i}`,children:"Default Value (Optional)"}),o.jsx(H,{id:`param-default-${i}`,value:s.default_value||"",onChange:e=>n(i,{default_value:e.target.value}),placeholder:"Default value if not provided"})]}),o.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{htmlFor:`param-in-response-${i}`,children:"Include in responses"}),o.jsx(Ye,{id:`param-in-response-${i}`,checked:!1!==s.include_in_responses,onCheckedChange:e=>n(i,{include_in_responses:e})})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Se,{htmlFor:`param-in-export-${i}`,children:"Visible in exports"}),o.jsx(Ye,{id:`param-in-export-${i}`,checked:!1!==s.visible_in_exports,onCheckedChange:e=>n(i,{visible_in_exports:e})})]})]})]})]},i)})}),o.jsxs(c,{onClick:()=>{t({...e,url_params_config:[...r,{name:"",label:"",description:"",include_in_responses:!0,visible_in_exports:!0,default_value:"",transitive_default:!1}]})},variant:"outline",className:"w-full",children:[o.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Parameter"]})]})},Yi=({form:e,fields:t,onUpdate:r})=>o.jsxs("div",{className:"h-full rounded-none border-0 relative overflow-hidden",style:{background:"var(--gradient-settings-card)",boxShadow:"var(--shadow-settings-card)"},children:[o.jsx("div",{className:"px-6 py-5 border-b border-border/30 relative overflow-hidden",style:{background:"var(--gradient-settings-header)",boxShadow:"var(--shadow-settings-elevated)"},children:o.jsxs("div",{className:"relative z-10",children:[o.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Form Settings"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-40"})]})}),o.jsx("div",{className:"p-0",children:o.jsx(De,{className:"h-[calc(100vh-9rem)]",children:o.jsx("div",{className:"p-6",children:o.jsxs(Ee,{defaultValue:"layout",className:"w-full",children:[o.jsxs(Re,{className:"grid w-full grid-cols-4",children:[o.jsx(Ie,{value:"layout",children:"Layout"}),o.jsx(Ie,{value:"design",children:"Design"}),o.jsx(Ie,{value:"responses",children:"Response"}),o.jsx(Ie,{value:"parameters",children:"Parameters"})]}),o.jsx(Fe,{value:"layout",className:"space-y-4 mt-4",children:o.jsx(Ui,{form:e,onUpdate:r})}),o.jsxs(Fe,{value:"design",className:"space-y-4 mt-4",children:[o.jsx($i,{form:e,onUpdate:r}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{htmlFor:"primary-color",children:"Primary Color"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(H,{id:"primary-color",type:"color",value:e.primary_color,onChange:t=>r({...e,primary_color:t.target.value}),className:"w-16 h-10 p-1 border rounded"}),o.jsx(H,{value:e.primary_color,onChange:t=>r({...e,primary_color:t.target.value}),placeholder:"#3b82f6",className:"flex-1"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{htmlFor:"secondary-color",children:"Secondary Color"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(H,{id:"secondary-color",type:"color",value:e.secondary_color,onChange:t=>r({...e,secondary_color:t.target.value}),className:"w-16 h-10 p-1 border rounded"}),o.jsx(H,{value:e.secondary_color,onChange:t=>r({...e,secondary_color:t.target.value}),placeholder:"#64748b",className:"flex-1"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{children:"Font Family"}),o.jsxs(Y,{value:e.font_family,onValueChange:t=>r({...e,font_family:t}),children:[o.jsx(W,{children:o.jsx(G,{})}),o.jsxs(X,{children:[o.jsx(K,{value:"Inter",children:"Inter"}),o.jsx(K,{value:"Roboto",children:"Roboto"}),o.jsx(K,{value:"Open Sans",children:"Open Sans"}),o.jsx(K,{value:"Poppins",children:"Poppins"}),o.jsx(K,{value:"Montserrat",children:"Montserrat"})]})]})]}),o.jsx(Me,{}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{htmlFor:"logo-url",children:"Logo URL"}),o.jsx(H,{id:"logo-url",value:e.logo_url||"",onChange:t=>r({...e,logo_url:t.target.value}),placeholder:"https://example.com/logo.png"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{htmlFor:"custom-css",children:"Custom CSS"}),o.jsx(ze,{id:"custom-css",value:e.custom_css||"",onChange:t=>r({...e,custom_css:t.target.value}),placeholder:"/* Custom CSS styles */",rows:4,className:"font-mono text-sm"})]})]}),o.jsxs(Fe,{value:"responses",className:"space-y-4 mt-4",children:[o.jsx(Ti,{label:"Thank You Message",id:"thank-you-message",value:e.thank_you_message,onChange:t=>r({...e,thank_you_message:t}),fields:t,urlParams:e.url_params_config,multiline:!0,placeholder:"Thank you for your submission!",hint:"Personalize with {{field:name}}, {{param:source}}, etc."}),o.jsx(Ti,{label:"Redirect URL (Optional)",id:"redirect-url",value:e.redirect_url||"",onChange:t=>r({...e,redirect_url:t}),fields:t,urlParams:e.url_params_config,placeholder:"https://example.com/thank-you?name={{field:full_name}}",hint:"Use Recall tokens in URL parameters"}),o.jsx(Me,{}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx(Se,{children:"Enable Partial Save"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Save progress automatically as users fill the form"})]}),o.jsx(_e,{checked:e.enable_partial_save,onCheckedChange:t=>r({...e,enable_partial_save:t})})]}),e.enable_partial_save&&o.jsxs("div",{className:"space-y-2",children:[o.jsx(Se,{htmlFor:"auto-save-interval",children:"Auto-save Interval (seconds)"}),o.jsx(H,{id:"auto-save-interval",type:"number",value:e.auto_save_interval,onChange:t=>r({...e,auto_save_interval:parseInt(t.target.value)||10}),min:5,max:60})]})]}),o.jsx(Fe,{value:"parameters",className:"space-y-4 mt-4",children:o.jsx(Hi,{form:e,onUpdate:r})})]})})})})]}),Wi=({form:e,fields:t,selectedFieldId:r,activeView:n,onFormUpdate:a,onFieldUpdate:s})=>{const i=r?t.find(e=>e.id===r):null;return o.jsxs("div",{className:"h-full relative overflow-hidden",style:{background:"var(--gradient-sidebar-right)",backgroundSize:"32px 32px",backgroundImage:"var(--gradient-sidebar-pattern)",boxShadow:"var(--shadow-sidebar-border), var(--shadow-sidebar-deep)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-white/5 to-transparent opacity-60"}),o.jsx("div",{className:"relative z-10 h-full",children:"fields"===n?o.jsx(Oi,{field:i,fields:t,onUpdate:e=>{r&&s(r,e)}}):o.jsx(Yi,{form:e,fields:t,onUpdate:a})})]})},Gi=[{id:"text",name:"Text Input",icon:Nt,category:"basic",description:"Single line text input"},{id:"email",name:"Email",icon:ct,category:"basic",description:"Email address field"},{id:"phone",name:"Phone",icon:We,category:"basic",description:"Phone number input"},{id:"number",name:"Number",icon:ft,category:"basic",description:"Numeric input field"},{id:"date",name:"Date",icon:Ge,category:"basic",description:"Date picker"},{id:"time",name:"Time",icon:Z,category:"basic",description:"Time picker"},{id:"textarea",name:"Long Text",icon:de,category:"basic",description:"Multi-line text area"},{id:"checkbox",name:"Checkbox",icon:wt,category:"choice",description:"Multiple selection"},{id:"radio",name:"Radio",icon:bt,category:"choice",description:"Single selection"},{id:"select",name:"Dropdown",icon:Xe,category:"choice",description:"Dropdown selection"},{id:"multiselect",name:"Multi-Select",icon:gt,category:"choice",description:"Multiple dropdown selection"},{id:"file",name:"File Upload",icon:we,category:"advanced",description:"File upload field"},{id:"signature",name:"Signature",icon:xt,category:"advanced",description:"Digital signature capture"},{id:"rating",name:"Rating",icon:Ke,category:"advanced",description:"Star rating field"},{id:"slider",name:"Slider",icon:jt,category:"advanced",description:"Range slider"},{id:"matrix",name:"Matrix",icon:mt,category:"advanced",description:"Matrix question grid"},{id:"divider",name:"Divider",icon:vt,category:"layout",description:"Visual separator"},{id:"html",name:"HTML Block",icon:Je,category:"layout",description:"Custom HTML content"},{id:"pagebreak",name:"Page Break",icon:He,category:"layout",description:"Form pagination"},{id:"section",name:"Section",icon:ut,category:"layout",description:"Collapsible section group"}],Xi=[{key:"basic",label:"Basic Fields"},{key:"choice",label:"Choice Fields"},{key:"advanced",label:"Advanced"},{key:"layout",label:"Layout"}],Ki=({fieldType:e,onAddField:t})=>{const{attributes:r,listeners:n,setNodeRef:a,transform:s,isDragging:i}=Hn({id:e.id,data:{fieldType:e}}),l=s?{transform:`translate3d(${s.x}px, ${s.y}px, 0)`,zIndex:i?1e3:"auto"}:void 0,c=e.icon;return o.jsx("div",{ref:a,style:l,...n,...r,onClick:r=>{i||(r.preventDefault(),r.stopPropagation(),t&&t(e))},className:`group cursor-pointer hover:cursor-grab active:cursor-grabbing p-3 rounded-lg border-2 transition-all duration-200 hover:shadow-card hover:scale-[1.02] ${(e=>{switch(e){case"basic":return"bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-900/50 dark:to-indigo-800/50 border-blue-200 dark:border-blue-700 hover:from-blue-100 hover:to-indigo-200 dark:hover:from-blue-800/60 dark:hover:to-indigo-700/60 hover:border-blue-300 dark:hover:border-blue-600";case"choice":return"bg-gradient-to-br from-purple-50 to-violet-100 dark:from-purple-900/50 dark:to-violet-800/50 border-purple-200 dark:border-purple-700 hover:from-purple-100 hover:to-violet-200 dark:hover:from-purple-800/60 dark:hover:to-violet-700/60 hover:border-purple-300 dark:hover:border-purple-600";case"advanced":return"bg-gradient-to-br from-emerald-50 to-green-100 dark:from-emerald-900/50 dark:to-green-800/50 border-emerald-200 dark:border-emerald-700 hover:from-emerald-100 hover:to-green-200 dark:hover:from-emerald-800/60 dark:hover:to-green-700/60 hover:border-emerald-300 dark:hover:border-emerald-600";case"layout":return"bg-gradient-to-br from-amber-50 to-orange-100 dark:from-amber-900/50 dark:to-orange-800/50 border-amber-200 dark:border-amber-700 hover:from-amber-100 hover:to-orange-200 dark:hover:from-amber-800/60 dark:hover:to-orange-700/60 hover:border-amber-300 dark:hover:border-amber-600";default:return"bg-gradient-to-br from-gray-50 to-slate-100 dark:from-gray-900/50 dark:to-slate-800/50 border-gray-200 dark:border-gray-700 hover:from-gray-100 hover:to-slate-200 dark:hover:from-gray-800/60 dark:hover:to-slate-700/60 hover:border-gray-300 dark:hover:border-gray-600"}})(e.category)} ${i?"opacity-50":""}`,title:`Click to add or drag to position: ${e.name}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"flex-shrink-0 w-9 h-9 flex items-center justify-center rounded-lg bg-background/80 dark:bg-background/60 text-primary group-hover:bg-primary group-hover:text-white transition-all duration-200 shadow-sm",children:o.jsx(c,{className:"h-4 w-4"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"font-semibold text-sm text-foreground",children:e.name}),o.jsx("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]})]})})},Ji=({onAddField:e})=>{const t=e=>{switch(e){case"basic":return"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700";case"choice":return"text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/30 border-purple-200 dark:border-purple-700";case"advanced":return"text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700";case"layout":return"text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-700";default:return"text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/30 border-gray-200 dark:border-gray-700"}};return o.jsx(u,{className:"h-full bg-gradient-to-b from-background to-muted/30 border-2",children:o.jsx(f,{className:"p-0",children:o.jsx(De,{className:"h-[calc(100vh-6rem)]",children:o.jsx("div",{className:"pt-4 px-4 pb-4 space-y-6",children:Xi.map((r,n)=>o.jsxs("div",{className:0===n?"":"pt-2",children:[o.jsx("div",{className:`font-bold text-sm mb-3 uppercase tracking-wide px-3 py-2 rounded-lg border ${t(r.key)}`,children:r.label}),o.jsx("div",{className:"space-y-3",children:Gi.filter(e=>e.category===r.key).map(t=>o.jsx(Ki,{fieldType:t,onAddField:e},t.id))})]},r.key))})})})})},Zi=({currentForm:e,onFormSelect:t})=>{const{user:r}=M(),[a,s]=n.useState([]),[i,l]=n.useState(null),[d,h]=n.useState(""),[p,g]=n.useState(!1);n.useEffect(()=>{r?.id&&(v(),x())},[r?.id,e.id]);const v=async()=>{if(r?.id)try{const{data:t,error:n}=await A.from("form_transitions").select("from_form_id").eq("to_form_id",e.id);if(n)throw n;const a=t?.map(e=>e.from_form_id)||[];let i=A.from("forms").select("*").eq("owner_id",r.id).neq("id",e.id).eq("status","published");a.length>0&&(i=i.not("id","in",`(${a.join(",")})`));const{data:o,error:l}=await i;if(l)throw l;s((o||[]).map(e=>({...e,url_params_config:e.url_params_config||void 0,layout:e.layout||{columns:1,grid_gap:"md",responsive:!0}})))}catch(t){z.error("Failed to load available forms")}},x=async()=>{try{const{data:t,error:r}=await A.from("form_transitions").select("\n          id,\n          to_form_id,\n          is_default,\n          forms!form_transitions_to_form_id_fkey (\n            id,\n            title\n          )\n        ").eq("from_form_id",e.id).eq("is_default",!0).maybeSingle();if(r)throw r;l(t)}catch(t){}},b=async()=>{if(i){g(!0);try{const{error:e}=await A.from("form_transitions").delete().eq("id",i.id);if(e)throw e;l(null),z.success("Form transition removed")}catch(e){z.error("Failed to remove form transition")}finally{g(!1)}}};return o.jsxs("div",{className:"h-full flex flex-col p-4 space-y-4",children:[o.jsxs("div",{className:"flex-shrink-0",children:[o.jsx("h3",{className:"text-sm font-medium mb-3",children:"Form Transition"}),!i&&o.jsxs("div",{className:"space-y-3",children:[o.jsxs(Y,{value:d,onValueChange:h,disabled:p,children:[o.jsx(W,{className:"w-full",children:o.jsx(G,{placeholder:"Select form to transition to..."})}),o.jsx(X,{children:a.map(e=>o.jsx(K,{value:e.id,children:e.title},e.id))})]}),o.jsx(c,{onClick:async()=>{if(d&&r?.id){g(!0);try{i&&await b();const{data:t,error:r}=await A.from("form_transitions").insert([{from_form_id:e.id,to_form_id:d,is_default:!0}]).select("\n          id,\n          to_form_id,\n          is_default,\n          forms!form_transitions_to_form_id_fkey (\n            id,\n            title\n          )\n        ").single();if(r)throw r;l(t),h(""),z.success("Form transition added successfully")}catch(t){z.error("Failed to add form transition")}finally{g(!1)}}},disabled:!d||p,className:"w-full",size:"sm",children:"Add Transition"})]})]}),i&&o.jsx("div",{className:"flex-shrink-0",children:o.jsxs(u,{className:"relative cursor-pointer bg-gradient-to-br from-teal-50 to-cyan-100 dark:from-teal-900/50 dark:to-cyan-800/50 border-2 border-teal-200 dark:border-teal-700 hover:from-teal-100 hover:to-cyan-200 dark:hover:from-teal-800/60 dark:hover:to-cyan-700/60 hover:border-teal-300 dark:hover:border-teal-600 hover:shadow-card transition-all duration-200 hover:scale-[1.02]",onClick:()=>{i?.to_form_id&&t&&t(i.to_form_id)},children:[o.jsx(c,{variant:"ghost",size:"sm",className:"absolute top-2 right-2 h-6 w-6 p-0 hover:bg-destructive hover:text-destructive-foreground bg-background/80 dark:bg-background/60 rounded-full",onClick:e=>{e.stopPropagation(),b()},disabled:p,children:o.jsx(Ce,{className:"h-3 w-3"})}),o.jsx(m,{className:"pb-2",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-6 h-6 bg-background/80 dark:bg-background/60 rounded-full flex items-center justify-center",children:o.jsx(Ze,{className:"h-3 w-3 text-teal-600 dark:text-teal-400"})}),o.jsx("span",{className:"text-sm font-bold text-teal-700 dark:text-teal-300",children:"Transitions to"})]})}),o.jsxs(f,{className:"pt-0 bg-background/60 dark:bg-background/40 backdrop-blur-sm rounded-lg m-3 mt-0",children:[o.jsx("p",{className:"text-sm font-bold text-foreground",children:i.forms?.title||"Unknown Form"}),o.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-medium",children:"Click to edit this form"})]})]})}),0===a.length&&!i&&o.jsx("div",{className:"flex-1 flex items-center justify-center",children:o.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:["No published forms available for transition.",o.jsx("br",{}),"Create and publish another form first."]})})]})},Qi=({currentForm:e,onFormSelect:t,onAddField:r})=>o.jsx("div",{className:"h-full bg-background border-r",children:o.jsxs(Ee,{defaultValue:"fields",className:"h-full",children:[o.jsxs(Re,{className:"grid w-full grid-cols-2 m-2 h-8",children:[o.jsx(Ie,{value:"fields",className:"py-1",children:"FIELDS"}),o.jsx(Ie,{value:"forms",className:"py-1",children:"FORMS"})]}),o.jsx(Fe,{value:"fields",className:"h-full mt-0 border-0 p-0",children:o.jsx(Ji,{onAddField:r})}),o.jsx(Fe,{value:"forms",className:"h-full mt-0 border-0 p-0",children:o.jsx(Zi,{currentForm:e,onFormSelect:t})})]})}),eo=({open:e,onClose:t,form:r,fields:a})=>{const[s,i]=n.useState("desktop"),[d,u]=n.useState({}),[m,h]=n.useState(!1),[f,p]=n.useState({}),{getVisibleFields:g}=be(a,d),v=g,x=n.useMemo(()=>{const e={};return(r.url_params_config||[]).forEach(t=>{e[t.name]=`[${t.name}]`}),e},[r.url_params_config]),{resolveRecall:b}=nt(a,d,x),y=n.useMemo(()=>{const e={columns:Math.max(4,r.layout?.columns||4),gridGap:r.layout?.grid_gap||"md",responsive:r.layout?.responsive??!0};return new xe(e)},[r.layout]),j=n.useMemo(()=>y.calculateFieldPositions(v),[y,v]),w=n.useMemo(()=>y.getContainerClasses(),[y]);return o.jsx(Qe,{open:e,onOpenChange:t,children:o.jsxs(et,{className:"max-w-7xl h-[90vh] p-0 overflow-hidden",children:[o.jsx(tt,{className:"p-6 pb-4 border-b",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs(rt,{className:"text-xl font-semibold",children:["Form Preview - ",r.title]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex items-center rounded-lg border p-1",children:[o.jsx(c,{variant:"desktop"===s?"default":"ghost",size:"sm",onClick:()=>i("desktop"),className:"h-8",children:o.jsx(Ve,{className:"h-4 w-4"})}),o.jsx(c,{variant:"tablet"===s?"default":"ghost",size:"sm",onClick:()=>i("tablet"),className:"h-8",children:o.jsx(pe,{className:"h-4 w-4"})}),o.jsx(c,{variant:"mobile"===s?"default":"ghost",size:"sm",onClick:()=>i("mobile"),className:"h-8",children:o.jsx($e,{className:"h-4 w-4"})})]}),o.jsx(c,{variant:"outline",size:"sm",onClick:()=>{u({}),p({}),h(!1)},disabled:0===Object.keys(d).length&&!m,children:"Reset"}),o.jsx(c,{variant:"ghost",size:"sm",onClick:t,children:o.jsx(R,{className:"h-4 w-4"})})]})]})}),o.jsx("div",{className:"flex-1 overflow-auto p-6 bg-muted/30",children:o.jsx("div",{className:l("mx-auto transition-all duration-300",{desktop:"max-w-4xl",tablet:"max-w-2xl",mobile:"max-w-sm"}[s]),children:o.jsxs("div",{className:"bg-background rounded-lg border shadow-lg overflow-hidden relative",style:{fontFamily:r.font_family||"inherit",..."color"===r.background?.type&&{backgroundColor:r.background.value},..."gradient"===r.background?.type&&{background:r.background.value},..."image"===r.background?.type&&{backgroundImage:`url(${r.background.value})`,backgroundSize:r.background.size||"cover",backgroundPosition:r.background.position||"center",backgroundRepeat:"no-repeat"}},children:["image"===r.background?.type&&void 0!==r.background.opacity&&r.background.opacity>0&&o.jsx("div",{className:"absolute inset-0 bg-background pointer-events-none",style:{opacity:r.background.opacity/100}}),o.jsxs("div",{className:"p-6 border-b relative z-10",style:{background:r.background?"transparent":"linear-gradient(to right, hsl(var(--primary) / 0.05), hsl(var(--accent) / 0.05))"},children:[r.logo_url&&o.jsx("img",{src:r.logo_url,alt:"Form logo",className:"h-12 mb-4 object-contain"}),o.jsx("h1",{className:"text-2xl font-bold mb-2",style:{color:r.primary_color||"hsl(var(--foreground))"},children:b(r.title)}),r.description&&o.jsx("p",{className:"text-muted-foreground",children:b(r.description)})]}),o.jsx("div",{className:"p-6 relative z-10",children:m?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(at,{className:"h-16 w-16 text-success mx-auto mb-4"}),o.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Form Submitted!"}),o.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:b(r.thank_you_message)||"Thank you for your submission!"})]}):o.jsx("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return v.forEach(t=>{if(!t.required||d[t.id]&&""!==d[t.id]||(e[t.id]=`${t.label} is required`),d[t.id])switch(t.type){case"email":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d[t.id])||(e[t.id]="Please enter a valid email address");break;case"phone":/^\+?[\d\s\-\(\)]+$/.test(d[t.id])||(e[t.id]="Please enter a valid phone number")}}),p(e),0===Object.keys(e).length})()&&h(!0)},children:0===v.length?o.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[o.jsx("p",{children:"No fields have been added to this form yet."}),o.jsx("p",{className:"text-sm mt-1",children:"Add fields using the field palette to see them here."})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:`w-full ${w}`,children:v.map(e=>{const t=j.find(t=>t.id===e.id),r=t?y.generateGridClasses(t):"";return o.jsxs("div",{className:`${r} space-y-2`,children:[o.jsx(ye,{field:{...e,label:b(e.label),description:b(e.description),placeholder:b(e.placeholder)},fields:v,formData:d,value:d[e.id],onChange:t=>((e,t)=>{u(r=>({...r,[e]:t})),f[e]&&p(t=>({...t,[e]:""}))})(e.id,t),isPreview:!1}),f[e.id]&&o.jsx("p",{className:"text-sm text-destructive flex items-center gap-1",children:f[e.id]})]},e.id)})}),o.jsx("div",{className:"pt-4 border-t col-span-full",children:o.jsx(c,{type:"submit",className:"w-full",style:{backgroundColor:r.primary_color,color:"#ffffff"},children:"Submit Form"})})]})})}),o.jsx("div",{className:"px-6 py-4 border-t bg-muted/50 text-center",children:o.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[o.jsx(J,{variant:"outline",children:"published"===r.status?"Live Preview":"Draft Preview"}),o.jsx("span",{children:""}),o.jsxs("span",{children:[v.length," field",1!==v.length?"s":""]})]})})]})})})]})})},to=({collaborators:e,isRealtimeConnected:t})=>{const[r,a]=n.useState(new Map),s=e.filter(e=>e.isActive);n.useEffect(()=>{(async()=>{const e=s.map(e=>e.userId).filter(e=>e&&!r.has(e));if(0!==e.length)try{const{data:t,error:n}=await A.from("profiles").select("id, first_name, last_name, email").in("id",e);if(n)return;const s=new Map(r);(t||[]).forEach(e=>{s.set(e.id,{userId:e.id,firstName:e.first_name||"",lastName:e.last_name||"",email:e.email||""})}),a(s)}catch(t){}})()},[s.map(e=>e.userId).join(",")]);const i=(e,t)=>{const n=r.get(e.userId);if(n){if(n.firstName||n.lastName)return`${n.firstName} ${n.lastName}`.trim();if(n.email)return n.email.split("@")[0]}return`Editor ${t+1}`},l=e=>{const t=Math.floor((Date.now()-e.getTime())/1e3);if(t<60)return`${t}s ago`;const r=Math.floor(t/60);return r<60?`${r}m ago`:"a while ago"};return o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(P,{children:o.jsxs(L,{children:[o.jsx(T,{asChild:!0,children:o.jsxs(J,{variant:t?"secondary":"destructive",className:"gap-1",children:[t?o.jsx(Ct,{className:"h-3 w-3"}):o.jsx(kt,{className:"h-3 w-3"}),t?"Connected":"Offline"]})}),o.jsx(O,{children:o.jsx("p",{children:t?"Real-time collaboration is active":"Working offline - changes will sync when connection is restored"})})]})}),s.length>0&&o.jsx(P,{children:o.jsxs(L,{children:[o.jsx(T,{asChild:!0,children:o.jsxs(J,{variant:"outline",className:"gap-1",children:[o.jsx(st,{className:"h-3 w-3"}),s.length," editing"]})}),o.jsx(O,{children:o.jsxs("div",{className:"space-y-1",children:[o.jsx("p",{className:"font-medium",children:"Other editors:"}),s.map((e,t)=>o.jsxs("p",{className:"text-sm",children:[i(e,t)," (active ",l(e.lastSeen),")"]},e.instanceId))]})})]})})]})},ro=e=>{let t;const r=new Set,n=(e,n)=>{const a="function"==typeof e?e(t):e;if(!Object.is(a,t)){const e=t;t=(null!=n?n:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,s={setState:n,getState:a,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e))},i=t=e(n,a,s);return s},no=e=>e;const ao=e=>{const t=(e=>e?ro(e):ro)(e),r=e=>function(e,t=no){const r=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>t(e.getState()),[e,t]),a.useCallback(()=>t(e.getInitialState()),[e,t]));return a.useDebugValue(r),r}(t,e);return Object.assign(r,t),r},so=(e,t)=>{if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const a of r){if(!n.includes(a))return!1;if(!so(e[a],t[a]))return!1}return!0},io=(oo=(e,t)=>({form:null,fields:[],isLoading:!1,error:null,pendingDeletions:[],lastSyncedAt:null,selectedFieldId:null,activeView:"fields",showPreview:!1,isSaving:!1,hasUnsavedChanges:!1,showAllFields:!1,setForm:r=>{const n=t(),a=!n.form||!so(n.form,r);e({form:r,hasUnsavedChanges:!!a||n.hasUnsavedChanges})},setFields:r=>{const n=t(),a=!n.fields||!so(n.fields,r);e({fields:r,hasUnsavedChanges:!!a||n.hasUnsavedChanges})},setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),setSelectedFieldId:t=>e({selectedFieldId:t}),setActiveView:t=>e({activeView:t}),setShowPreview:t=>e({showPreview:t}),setShowAllFields:t=>e({showAllFields:t}),markUnsavedChanges:()=>e({hasUnsavedChanges:!0}),updateFormSmart:r=>{const n=t(),a=!n.form||!so(n.form,r);e(a?{form:r,hasUnsavedChanges:!0}:{form:r})},addField:r=>{const{fields:n}=t(),a={...r,order_index:n.length};e({fields:[...n,a],hasUnsavedChanges:!0}),setTimeout(()=>{const{form:e}=t()},1e3)},updateField:(r,n)=>{const{fields:a}=t();if(n._deleted)return void t().deleteField(r);if("_duplicate"in n)return void t().duplicateField(r);const s={...n};if(s.validation_rules&&"string"==typeof s.validation_rules)try{s.validation_rules=JSON.parse(s.validation_rules)}catch{s.validation_rules={}}if(s.conditional_logic&&"string"==typeof s.conditional_logic)try{s.conditional_logic=JSON.parse(s.conditional_logic)}catch{s.conditional_logic={}}const i=a.map(e=>e.id===r?{...e,...s}:e);e({fields:i,hasUnsavedChanges:!0})},deleteField:r=>{const{fields:n,selectedFieldId:a}=t();if(!n.find(e=>e.id===r))return;const s=n.filter(e=>e.id!==r);e({fields:s,selectedFieldId:a===r?null:a,hasUnsavedChanges:!0,pendingDeletions:[...t().pendingDeletions||[],r]})},duplicateField:r=>{const{fields:n}=t(),a=n.find(e=>e.id===r);if(a){const t={...a,id:ti(),label:`${a.label} (Copy)`,order_index:n.length};e({fields:[...n,t],hasUnsavedChanges:!0})}},reorderFields:(r,n)=>{const{fields:a}=t(),s=[...a],[i]=s.splice(r,1);s.splice(n,0,i);const o=s.map((e,t)=>({...e,order_index:t}));e({fields:o,hasUnsavedChanges:!0})},loadForm:async(r,n)=>{if(!r||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(r))return e({isLoading:!1,error:new Error("Invalid form ID"),form:null,fields:[]}),void z.error("Failed to load form: invalid form ID.");e({isLoading:!0,error:null});try{const{data:a,error:s}=await A.from("forms").select("*").eq("id",r).eq("owner_id",n).single();if(s)throw s;const{data:i,error:o}=await A.from("form_fields").select("*").eq("form_id",r).order("order_index");if(o)throw o;const l=t(),c=a.layout,d=a.background,u={...a,url_params_config:a.url_params_config||void 0,layout:{columns:Math.max(4,c?.columns||4),grid_gap:c?.grid_gap||"md",responsive:c?.responsive??!0},background:d?{type:d.type||"color",value:d.value||"#ffffff",opacity:d.opacity,position:d.position,size:d.size}:void 0},m=(i||[]).map(e=>({...e,conditional_logic:"object"==typeof e.conditional_logic&&null!==e.conditional_logic?e.conditional_logic:{},validation_rules:"object"==typeof e.validation_rules&&null!==e.validation_rules?e.validation_rules:{},options:Array.isArray(e.options)?e.options:e.options||[],calculations:"object"==typeof e.calculations&&null!==e.calculations?e.calculations:{},styling:"object"==typeof e.styling&&null!==e.styling?e.styling:{},width:e.width||e.styling?.width||"full"}));!l.form||so(l.form,u),!l.fields||so(l.fields,m),l.lastSyncedAt,e({form:u,fields:m,isLoading:!1,error:null,pendingDeletions:[],hasUnsavedChanges:!1,lastSyncedAt:Date.now()})}catch(a){e({isLoading:!1,error:a,form:null,fields:[]}),z.error(`Failed to load form: ${a?.message||"Unknown error"}`)}},saveForm:async r=>{const{form:n,fields:a,pendingDeletions:s}=t();if(n){e({isSaving:!0});try{if(s.length>0){const{error:e}=await A.from("form_fields").delete().in("id",s);if(e)throw new Error(`Failed to delete fields: ${e.message}`)}const{error:t}=await A.from("forms").upsert({id:n.id,title:n.title,description:n.description,status:n.status,is_public:n.is_public,accept_responses:n.accept_responses,primary_color:n.primary_color,secondary_color:n.secondary_color,font_family:n.font_family,enable_partial_save:n.enable_partial_save,auto_save_interval:n.auto_save_interval,thank_you_message:n.thank_you_message,enable_analytics:n.enable_analytics,layout:n.layout,logo_url:n.logo_url||null,custom_css:n.custom_css||null,redirect_url:n.redirect_url||null,background:n.background||null,owner_id:r,updated_at:(new Date).toISOString()});if(t)throw t;if(a.length>0){const e=["text","email","number","textarea","select","radio","checkbox","file","date","rating","slider","phone","time","matrix","divider","html","multiselect","signature","pagebreak","section"];let t=[],r=0;for(const s of a){if(!e.includes(s.type)){const e=`Invalid field type '${s.type}' for field '${s.label}'. Skipping.`;t.push(e);continue}const a={id:s.id,form_id:n.id,type:s.type,label:s.label,description:s.description||null,placeholder:s.placeholder||null,required:s.required||!1,order_index:s.order_index??r,options:s.options||null,validation_rules:s.validation_rules||null,conditional_logic:s.conditional_logic||null,calculations:s.calculations||null,styling:s.styling||null,width:s.width||null},{error:i}=await A.from("form_fields").upsert(a,{onConflict:"id"});if(i){const e=`Failed to save field '${s.label}': ${i.message}`;t.push(e)}else r++}t.length>0&&z.error(`Form saved with ${t.length} field error(s). Some fields may not have been saved.`)}const{data:i}=await A.from("forms").select("id").eq("id",n.id).single(),{data:o}=await A.from("form_fields").select("id").eq("form_id",n.id);if(!i)throw new Error("Form was not saved properly");e({pendingDeletions:[],hasUnsavedChanges:!1,lastSyncedAt:Date.now()})}catch(i){z.error(`Failed to save form: ${i?.message||"Unknown error"}`)}finally{e({isSaving:!1})}}else z.error("No form to save")},resetStore:()=>{e({form:null,fields:[],selectedFieldId:null,activeView:"fields",showPreview:!1,isLoading:!1,error:null,isSaving:!1,pendingDeletions:[],hasUnsavedChanges:!1,lastSyncedAt:null})},validateStateIntegrity:()=>{const{form:e,fields:r,lastSyncedAt:n}=t(),a=null!==e&&Array.isArray(r)&&null!==n;return a},createDefaultForm:t=>{const r={id:ti(),title:"Untitled Form",description:"",status:"draft",is_public:!0,accept_responses:!0,owner_id:t,primary_color:"hsl(217, 91%, 60%)",secondary_color:"hsl(215, 25%, 27%)",font_family:"Inter",layout:{columns:4,grid_gap:"md",responsive:!0},enable_partial_save:!0,auto_save_interval:10,thank_you_message:"Thank you for your submission!",enable_analytics:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};e({form:r,fields:[],pendingDeletions:[],hasUnsavedChanges:!1,lastSyncedAt:Date.now()})}}))?ao(oo):ao;var oo;const lo=({interval:e,hasUnsavedChanges:t,onSave:r,enabled:a,formId:s})=>{const i=n.useRef(),o=n.useRef(0),l=n.useRef(""),c=((e,t)=>{const[r,a]=n.useState(e);return n.useEffect(()=>{const r=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(r)}},[e,t]),r})(t,2e3),d=async()=>{if(!s)return{hasConflict:!1};try{const{data:e,error:t}=await A.from("forms").select("updated_at").eq("id",s).single();if(t||!e)return{hasConflict:!1};const r=e.updated_at,n=l.current&&l.current!==r;return{hasConflict:n,lastModified:new Date(r),conflictData:n?e:void 0}}catch(e){return{hasConflict:!1}}},u=async()=>{try{if((await d()).hasConflict)return;if(await r(),o.current=Date.now(),s){const{data:e}=await A.from("forms").select("updated_at").eq("id",s).single();e&&(l.current=e.updated_at)}}catch(e){}};n.useEffect(()=>{if(!c)return void(i.current&&(clearTimeout(i.current),i.current=void 0));const t=Date.now()-o.current,r=Math.max(0,e-t);return t<5e3?void 0:(i.current=setTimeout(u,r),()=>{i.current&&(clearTimeout(i.current),i.current=void 0)})},[c,e,a,s]);return n.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]),{saveNow:async()=>{i.current&&(clearTimeout(i.current),i.current=void 0),await u()},updateKnownVersion:e=>{l.current=e},checkForConflicts:d}};const co=new class{constructor(){t(this,"channel"),t(this,"tabId"),t(this,"isActive",!0),t(this,"currentFormId",null),t(this,"messageHandlers",new Map),this.tabId=`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.channel=new BroadcastChannel("form_builder_coordination"),this.setupMessageListener(),this.setupVisibilityHandling(),this.announceTabState()}setActiveForm(e){this.currentFormId=e,this.broadcastMessage({type:"TAB_ACTIVE",formId:e||"",data:{activeForm:e},timestamp:Date.now(),tabId:this.tabId})}broadcastFormUpdate(e,t){this.isActive&&this.broadcastMessage({type:"FORM_UPDATE",formId:e,data:{form:t},timestamp:Date.now(),tabId:this.tabId})}broadcastFieldUpdate(e,t,r){this.isActive&&this.broadcastMessage({type:"FIELD_UPDATE",formId:e,data:{fieldId:t,field:r},timestamp:Date.now(),tabId:this.tabId})}requestFormSync(e){return new Promise(t=>{const r=setTimeout(()=>{this.removeMessageHandler("FORM_SYNC_RESPONSE",n),t(null)},2e3),n=a=>{a.formId===e&&"FORM_SYNC_RESPONSE"===a.type&&(clearTimeout(r),this.removeMessageHandler("FORM_SYNC_RESPONSE",n),t(a.data))};this.addMessageHandler("FORM_SYNC_RESPONSE",n),this.channel.postMessage({type:"FORM_SYNC_REQUEST",formId:e,timestamp:Date.now(),tabId:this.tabId})})}addMessageHandler(e,t){this.messageHandlers.has(e)||this.messageHandlers.set(e,new Set),this.messageHandlers.get(e).add(t)}removeMessageHandler(e,t){const r=this.messageHandlers.get(e);r&&r.delete(t)}getTabId(){return this.tabId}isTabActive(){return this.isActive}getCurrentFormId(){return this.currentFormId}cleanup(){this.broadcastMessage({type:"TAB_INACTIVE",formId:this.currentFormId||"",timestamp:Date.now(),tabId:this.tabId}),this.channel.close(),this.messageHandlers.clear()}setupMessageListener(){this.channel.addEventListener("message",e=>{const t=e.data;if(t.tabId===this.tabId)return;const r=this.messageHandlers.get(t.type);r&&r.forEach(e=>e(t))})}setupVisibilityHandling(){const e=()=>{const e=!document.hidden&&document.hasFocus();e!==this.isActive&&(this.isActive=e,this.announceTabState())};document.addEventListener("visibilitychange",e),window.addEventListener("focus",e),window.addEventListener("blur",e),setInterval(()=>{this.isActive&&this.announceTabState()},3e4)}announceTabState(){const e=this.isActive?"TAB_ACTIVE":"TAB_INACTIVE";this.broadcastMessage({type:e,formId:this.currentFormId||"",data:{activeForm:this.currentFormId,timestamp:Date.now()},timestamp:Date.now(),tabId:this.tabId})}broadcastMessage(e){try{this.channel.postMessage(e)}catch(t){}}};"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{co.cleanup()});const uo=new class{constructor(){t(this,"instanceId"),t(this,"lockRefreshInterval",null),t(this,"activeLocks",new Set),this.instanceId=ti()}async acquireLock(e){try{await this.cleanupExpiredLocks(e);const{data:t,error:r}=await A.from("form_edit_locks").select("*").eq("form_id",e).gt("expires_at",(new Date).toISOString());if(r)return{success:!1};const n=t?.find(e=>e.instance_id!==this.instanceId);if(n)return{success:!1,conflictingLock:n};const a=new Date(Date.now()+3e5),{data:s,error:i}=await A.from("form_edit_locks").insert({form_id:e,user_id:(await A.auth.getUser()).data.user?.id||"",instance_id:this.instanceId,expires_at:a.toISOString(),metadata:{acquired_at:(new Date).toISOString()}}).select().single();return i?{success:!1}:(this.activeLocks.add(e),this.startLockRefresh(e),{success:!0,lock:s})}catch(t){return{success:!1}}}async releaseLock(e){try{const{error:t}=await A.from("form_edit_locks").delete().eq("form_id",e).eq("instance_id",this.instanceId);return!t&&(this.activeLocks.delete(e),this.stopLockRefresh(),!0)}catch(t){return!1}}async refreshLock(e){try{const t=new Date(Date.now()+3e5),{error:r}=await A.from("form_edit_locks").update({expires_at:t.toISOString(),updated_at:(new Date).toISOString()}).eq("form_id",e).eq("instance_id",this.instanceId);return!r}catch(t){return!1}}async isFormLocked(e){try{await this.cleanupExpiredLocks(e);const{data:t,error:r}=await A.from("form_edit_locks").select("*").eq("form_id",e).gt("expires_at",(new Date).toISOString());if(r)return{locked:!1};const n=t?.find(e=>e.instance_id!==this.instanceId);return{locked:!!n,lockInfo:n}}catch(t){return{locked:!1}}}startLockRefresh(e){this.lockRefreshInterval&&clearInterval(this.lockRefreshInterval),this.lockRefreshInterval=setInterval(async()=>{if(this.activeLocks.has(e)){await this.refreshLock(e)||this.activeLocks.delete(e)}},12e4)}stopLockRefresh(){this.lockRefreshInterval&&(clearInterval(this.lockRefreshInterval),this.lockRefreshInterval=null)}async cleanupExpiredLocks(e){try{await A.from("form_edit_locks").delete().eq("form_id",e).lt("expires_at",(new Date).toISOString())}catch(t){}}async cleanup(){try{await A.from("form_edit_locks").delete().eq("instance_id",this.instanceId),this.stopLockRefresh(),this.activeLocks.clear()}catch(e){}}getInstanceId(){return this.instanceId}};"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{uo.cleanup()});const mo=e=>{const{user:t}=M(),r=io(),[a]=U(),s=n.useRef(!1),i=n.useRef(!1),o=n.useRef(void 0),{form:l,fields:c,isLoading:d,isSaving:u,error:m,loadForm:h,resetStore:f,saveForm:p,hasUnsavedChanges:g,selectedFieldId:v,activeView:x,showPreview:b,setForm:y,updateFormSmart:j,addField:w,updateField:N,deleteField:k,duplicateField:C,reorderFields:S,setSelectedFieldId:_,setActiveView:D,setShowPreview:E}=r,{updateTimestamp:R,getActiveCollaborators:I,isRealtimeConnected:F}=((e,t=!0)=>{const r=n.useRef(null),a=n.useRef(0),s=n.useRef(new Map),{form:i,fields:o,updateFormSmart:l,updateField:c,setFields:d,setForm:u}=io(),m=n.useRef(i),h=n.useRef(o);n.useEffect(()=>{m.current=i},[i]),n.useEffect(()=>{h.current=o},[o]);const f=n.useCallback(e=>{const{new:t}=e;if(t.updated_at&&new Date(t.updated_at).getTime()<=a.current)return;const r=m.current;(!r||new Date(t.updated_at)>new Date(r.updated_at))&&(l(t),co.broadcastFormUpdate(t.id,t))},[l]),p=n.useCallback(e=>{const{new:t,eventType:r}=e;if(!(t.updated_at&&new Date(t.updated_at).getTime()<=a.current))if("INSERT"===r||"UPDATE"===r)c(t.id,t),co.broadcastFieldUpdate(t.form_id,t.id,t);else if("DELETE"===r){const e=h.current.filter(e=>e.id!==t.id);d(e)}},[c,d]),g=n.useCallback(t=>{const{new:r,eventType:n}=t;e&&r.form_id===e&&("INSERT"===n||"UPDATE"===n?r.instance_id!==uo.getInstanceId()&&s.current.set(r.instance_id,{userId:r.user_id,instanceId:r.instance_id,lastSeen:new Date(r.updated_at),isActive:new Date(r.expires_at)>new Date}):"DELETE"===n&&s.current.delete(r.instance_id))},[e]);return n.useEffect(()=>{if(!e||!t)return void(r.current&&(r.current.unsubscribe(),r.current=null));const n=A.channel(`form-collaboration-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"forms",filter:`id=eq.${e}`},e=>f(e)).on("postgres_changes",{event:"*",schema:"public",table:"form_fields",filter:`form_id=eq.${e}`},e=>p(e)).on("postgres_changes",{event:"*",schema:"public",table:"form_edit_locks",filter:`form_id=eq.${e}`},e=>g(e)).subscribe(e=>{});return r.current=n,()=>{r.current&&(r.current.unsubscribe(),r.current=null)}},[e,t,f,p,g]),n.useEffect(()=>{if(!e)return;const t=t=>{t.formId===e&&t.data?.form&&l(t.data.form)},r=t=>{t.formId===e&&t.data?.fieldId&&t.data?.field&&c(t.data.fieldId,t.data.field)},n=async t=>{if(t.formId===e){const t={type:"FORM_SYNC_RESPONSE",formId:e,data:{form:m.current,fields:h.current},timestamp:Date.now(),tabId:co.getTabId()};co.channel.postMessage(t)}};return co.addMessageHandler("FORM_UPDATE",t),co.addMessageHandler("FIELD_UPDATE",r),co.addMessageHandler("FORM_SYNC_REQUEST",n),()=>{co.removeMessageHandler("FORM_UPDATE",t),co.removeMessageHandler("FIELD_UPDATE",r),co.removeMessageHandler("FORM_SYNC_REQUEST",n)}},[e,l,c]),{updateTimestamp:n.useCallback(()=>{a.current=Date.now()},[]),getActiveCollaborators:n.useCallback(()=>{const e=new Date;return Array.from(s.current.values()).filter(t=>t.isActive&&e.getTime()-t.lastSeen.getTime()<3e5)},[]),isRealtimeConnected:!!r.current}})("new"===e?null:e,!!t&&"new"!==e),P=n.useCallback(async()=>{if(!t?.id)throw new Error("User not authenticated");R();return await p(t.id)},[t?.id,p,R]);lo({interval:3e4,hasUnsavedChanges:g,onSave:P,enabled:!0,formId:"new"===e?void 0:e}),n.useEffect(()=>((async()=>{if(t?.id&&e&&!(i.current||s.current&&o.current===e)){i.current=!0;try{if(o.current!==e&&(f(),o.current=e),"new"===e){const e=a.get("template");e?await L(e):r.createDefaultForm(t.id),s.current=!0}else if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)){await h(e,t.id),s.current=!0,co.setActiveForm(e);const r=await uo.acquireLock(e);!r.success&&r.conflictingLock}else z.error("Invalid form ID. Please check the URL.")}catch(n){s.current=!1}finally{i.current=!1}}})(),()=>{e&&"new"!==e&&uo.releaseLock(e),o.current!==e&&(s.current=!1)}),[e,t?.id]);const L=async e=>{try{const{data:n,error:a}=await A.from("form_templates").select("*").eq("id",e).single();if(a)throw a;if(!n)throw new Error("Template not found");const s=n.template_data,i={title:`${n.title} (Copy)`,description:n.description,owner_id:t?.id,status:"draft",url_params_config:s?.url_params_config||void 0},{data:o,error:l}=await A.from("forms").insert(i).select().single();if(l)throw l;const c={...o,layout:"object"==typeof o.layout&&null!==o.layout?o.layout:{columns:1,grid_gap:"md",responsive:!0}};if(y(c),s&&s.fields&&s.fields.length>0){const e=s.fields.map((e,t)=>{if(!e.type)throw new Error(`Template field at index ${t} is missing required 'type' property`);if(!e.label)throw new Error(`Template field at index ${t} is missing required 'label' property`);return{form_id:o.id,type:e.type,label:e.label,ref:e.ref||null,description:e.description||null,placeholder:e.placeholder||null,required:Boolean(e.required),order_index:t,width:"full"===e.width||"half"===e.width||"quarter"===e.width?e.width:"full",options:Array.isArray(e.options)?e.options:null,validation_rules:e.validation_rules&&"object"==typeof e.validation_rules?e.validation_rules:null,conditional_logic:e.conditional_logic&&"object"==typeof e.conditional_logic?e.conditional_logic:null,calculations:e.calculations&&"object"==typeof e.calculations?e.calculations:null,styling:e.styling&&"object"==typeof e.styling?e.styling:null}}),{data:t,error:n}=await A.from("form_fields").insert(e).select();if(n)throw n;if(t){const e=t.map(e=>({...e,width:"full"===e.width||"half"===e.width||"quarter"===e.width?e.width:"full",options:Array.isArray(e.options)?e.options:void 0}));r.setFields(e)}}z.success("Template applied successfully!")}catch(n){const e=n instanceof Error?n.message:"Unknown error";z.error(`Failed to apply template: ${e}. Creating blank form instead.`),r.createDefaultForm(t?.id)}};return{form:l,fields:c,isLoading:d,error:m,selectedFieldId:v,activeView:x,showPreview:b,isSaving:u,hasUnsavedChanges:g,setForm:y,updateFormSmart:j,addField:w,updateField:N,deleteField:k,duplicateField:C,reorderFields:S,setSelectedField:_,setActiveView:D,setShowPreview:E,saveForm:P,saveNow:async()=>{await P(),z.success("Form saved successfully")},getActiveCollaborators:I,isRealtimeConnected:F,lockService:uo}},ho=()=>{const e=$(),[t,r]=n.useState({isSaving:!1,lastSaved:null,hasUnsavedChanges:!1}),a=n.useCallback(async(n,a,s,i)=>{if(t.isSaving)return void z.error("Save in progress, please wait...");r(e=>({...e,isSaving:!0}));let o=0;try{await(async()=>{for(;o<3;)try{return o++,i&&i(),1===o?z.loading("Saving current form...",{id:"form-save"}):z.loading(`Saving... (Attempt ${o}/3)`,{id:"form-save"}),await s(),z.success("Form saved successfully",{id:"form-save"}),r(e=>({...e,lastSaved:new Date,hasUnsavedChanges:!1})),!0}catch(e){if(o>=3)return z.error("Failed to save after 3 attempts. Navigation cancelled.",{id:"form-save"}),!1;await new Promise(e=>setTimeout(e,1e3))}return!1})()&&(z.loading("Switching forms...",{id:"form-navigation"}),e(`/form-builder/${n}`),z.success("Form switched successfully",{id:"form-navigation"}))}catch(l){z.error("Navigation failed")}finally{r(e=>({...e,isSaving:!1}))}},[e,t.isSaving]),s=n.useCallback(()=>{r(e=>({...e,hasUnsavedChanges:!0}))},[]),i=n.useCallback(()=>{r(e=>({...e,hasUnsavedChanges:!1,lastSaved:new Date}))},[]);return{navigateToFormWithSave:a,saveState:t,markUnsavedChanges:s,markSaved:i}};class fo extends a.Component{constructor(e){super(e),t(this,"retry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),this.props.onError?.(e,t)}render(){if(this.state.hasError){if(this.props.fallback){const e=this.props.fallback;return o.jsx(e,{error:this.state.error,retry:this.retry})}return o.jsxs(u,{className:"max-w-2xl mx-auto mt-8",children:[o.jsx(m,{children:o.jsxs(h,{className:"flex items-center gap-2 text-destructive",children:[o.jsx(V,{className:"h-5 w-5"}),"Something went wrong"]})}),o.jsxs(f,{className:"space-y-4",children:[o.jsx("p",{className:"text-muted-foreground",children:"An unexpected error occurred in the form builder. This might be due to data inconsistencies or a temporary issue."}),this.state.error&&o.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[o.jsx("h4",{className:"font-medium mb-2",children:"Error Details:"}),o.jsx("p",{className:"text-sm font-mono text-destructive",children:this.state.error.message})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(c,{onClick:this.retry,className:"flex items-center gap-2",children:[o.jsx(q,{className:"h-4 w-4"}),"Try Again"]}),o.jsx(c,{variant:"outline",onClick:()=>window.location.reload(),children:"Refresh Page"})]})]})]})}return this.props.children}}const po=({children:e,onError:t})=>o.jsx(fo,{onError:t?e=>t(e):void 0,children:e}),go=({formId:e,onSave:t})=>{const r=$(),{form:a,fields:s,isLoading:i,selectedFieldId:l,activeView:c,showPreview:d,setForm:u,updateFormSmart:m,addField:h,updateField:f,deleteField:p,duplicateField:g,reorderFields:v,setSelectedField:x,setActiveView:b,setShowPreview:y,saveForm:j,isSaving:w,getActiveCollaborators:N,isRealtimeConnected:k}=mo(e),{showAllFields:C,setShowAllFields:S}=io(),{navigateToFormWithSave:_}=ho(),D=io.getState(),{hasUnsavedChanges:E}=D,R=C?s.length:s.filter(e=>!(e.conditional_logic||{}).hidden).length;(e=>{const t=n.useRef(e);n.useEffect(()=>{t.current=e},[e]),n.useEffect(()=>{const e=e=>{if(t.current){const t="You have unsaved changes. Are you sure you want to leave?";return e.preventDefault(),e.returnValue=t,t}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[])})(E);const I=(e,t)=>{"_deleted"in t?p(e):"_duplicate"in t?g(e):f(e,t)};return i?o.jsx("div",{className:"h-screen flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),o.jsx("p",{children:"Loading form..."}),o.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Form ID: ",e||"New Form"]})]})}):a?o.jsx(po,{onError:e=>{},children:o.jsx(Vn,{collisionDetection:e=>{const{active:t,droppableContainers:r}=e,n=t.data.current?.fieldType;if(n){if(Array.from(r.values()).find(e=>"form-canvas"===e.id)){const t=(e=>{let{droppableContainers:t,droppableRects:r,pointerCoordinates:n}=e;if(!n)return[];const a=[];for(const s of t){const{id:e}=s,t=r.get(e);if(t&&br(n,t)){const r=pr(t).reduce((e,t)=>e+mr(n,t),0),i=Number((r/4).toFixed(4));a.push({id:e,data:{droppableContainer:s,value:i}})}}return a.sort(hr)})(e);if(t.length>0)return t;const r=xr(e);if(r.length>0)return r}}return(e=>{let{collisionRect:t,droppableRects:r,droppableContainers:n}=e;const a=gr(t,t.left,t.top),s=[];for(const i of n){const{id:e}=i,t=r.get(e);if(t){const r=mr(gr(t),a);s.push({id:e,data:{droppableContainer:i,value:r}})}}return s.sort(hr)})(e)},onDragEnd:e=>{const{active:t,over:r}=e;if(!r)return;const n=t.data.current?.fieldType;if(n){const e={id:ti(),form_id:a?.id||"",type:n.id,label:n.name,required:!1,order_index:s.length,options:["checkbox","radio","select","multiselect"].includes(n.id)?["Option 1","Option 2"]:void 0,created_at:(new Date).toISOString()};h(e),x(e.id),z.success(`${n.name} field added`)}else{const e=s.findIndex(e=>e.id===t.id),n=s.findIndex(e=>e.id===r.id);-1!==e&&-1!==n&&e!==n&&v(e,n)}},children:o.jsxs("div",{className:"h-screen flex flex-col bg-background",children:[o.jsxs("div",{className:"flex items-center justify-between border-b bg-background px-4 py-3",children:[o.jsx(po,{children:o.jsx(Is,{form:a,onFormUpdate:m,onSave:async()=>{await j(),z.success("Form saved successfully"),t&&a&&t(a)},saving:w,activeView:c,onViewChange:b,onPreview:()=>y(!0),totalFields:s.length,visibleFields:R,showAllFields:C,onToggleShowAll:()=>S(!C),hasUnsavedChanges:E,lastSaved:null})}),o.jsx(to,{collaborators:N(),isRealtimeConnected:k})]}),o.jsx("div",{className:"flex-1 overflow-hidden",children:o.jsxs(Ss,{direction:"horizontal",className:"h-full",children:[o.jsx(_s,{defaultSize:20,minSize:15,maxSize:30,children:o.jsx(po,{children:o.jsx(Qi,{currentForm:a,onFormSelect:async e=>{a&&e!==a.id&&(await _(e,a,j),r(`/forms/${e}`))},onAddField:e=>{if(!a)return;const t={id:ti(),form_id:a.id,type:e.id,label:e.name,required:!1,order_index:s.length,options:["checkbox","radio","select","multiselect"].includes(e.id)?["Option 1","Option 2"]:void 0,created_at:(new Date).toISOString()};h(t),x(t.id)}})})}),o.jsx(Ds,{withHandle:!0}),o.jsx(_s,{defaultSize:50,minSize:30,children:o.jsx(po,{children:o.jsx(Ks,{fields:s,form:a,selectedFieldId:l,onFieldSelect:x,onFieldUpdate:I,showAllFields:C})})}),o.jsx(Ds,{withHandle:!0}),o.jsx(_s,{defaultSize:30,minSize:20,maxSize:40,children:o.jsx(po,{children:o.jsx(Wi,{form:a,fields:s,selectedFieldId:l,activeView:c,onFormUpdate:u,onFieldUpdate:I})})})]})}),o.jsx(eo,{open:d,onClose:()=>y(!1),form:a,fields:s})]})})}):o.jsx("div",{className:"h-screen flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-lg mb-2",children:"Form not found"}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:['The form with ID "',e,'" could not be loaded.']})]})})};function vo(){const{id:e}=B(),t=e??"new";return o.jsx(go,{formId:t,onSave:e=>{}})}export{vo as default};
