import{c as e,r as s,j as t,B as r,k as a,C as i,b as n,d as l,f as d,s as c,X as o,Z as m,u as x,N as h,L as j}from"./main-BQOa5mM0.js";import{I as u}from"./input-COMLYb-C.js";import{B as p}from"./badge-6grXs2Vt.js";import{C as f}from"./checkbox-CljSm3_p.js";import{T as N,a as v,b as g,c as w,d as b,e as _}from"./table-CsUrjkkT.js";import{D as y,a as C,b as S,c as k}from"./dropdown-menu-DSV87Z6r.js";import{D as E}from"./download-BuY_PqoH.js";import{T as D}from"./trash-2-B0C8EAKm.js";import{E as F,I as R}from"./image-BHv6KYgW.js";import{E as A}from"./eye-Bq8mO4No.js";import{L}from"./label-B7su6Jaa.js";import{S as P,a as T,b as $,c as I,d as U}from"./select-DDetsmr9.js";import{D as O,f as M,a as z,b as V,c as q}from"./dialog-Zbmvpzx0.js";import{F as B}from"./file-text-WxvKYvjS.js";import{S as Z}from"./separator-3yH5arB6.js";import{U as Y}from"./user-CAryOBTT.js";import{C as G}from"./calendar-BcqkHMaS.js";import{C as H}from"./clock-BGkZXTj0.js";import{T as J}from"./ThemeToggle-B4EQrceX.js";import{A as K}from"./arrow-left-BoD24ioV.js";import{C as W}from"./code-Bh0iG-EL.js";import{E as X}from"./external-link-IfMGOG27.js";import{U as Q}from"./users-DfZDw2qr.js";import{S as ee}from"./search-BDbiXKhR.js";import{F as se}from"./filter-IbJucnsf.js";import"./index-Cff7j1dh.js";import"./check-WoqjMYuF.js";import"./index-C38VFtOl.js";import"./index-CjuUx4b5.js";import"./index-_nftuPOU.js";import"./circle-BfUTHkiN.js";import"./chevron-down-BwC0H5jo.js";import"./index-D4HqgO5_.js";import"./sun-oLtT9Ef9.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=e("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),re=({responses:e,onViewResponse:a})=>{const[i,n]=s.useState([]),l=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=e=>e.is_partial?t.jsx(p,{variant:"outline",className:"text-warning border-warning",children:"Partial"}):e.submitted_at?t.jsx(p,{variant:"default",className:"bg-success text-success-foreground",children:"Complete"}):t.jsx(p,{variant:"secondary",children:"Draft"}),c=e=>{const s=e.form_response_answers;if(0===s.length)return"No answers";const t=s[0],r=t.value?.substring(0,50);return r+(t.value?.length>50?"...":"")};return 0===e.length?t.jsx("div",{className:"text-center py-12",children:t.jsxs("div",{className:"text-muted-foreground",children:[t.jsx("div",{className:"mb-4",children:"No responses found"}),t.jsx("div",{className:"text-sm",children:"Responses will appear here once users submit your form"})]})}):t.jsxs("div",{className:"space-y-4",children:[i.length>0&&t.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[t.jsxs("span",{className:"text-sm text-muted-foreground",children:[i.length," response(s) selected"]}),t.jsxs(r,{variant:"outline",size:"sm",children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),"Export Selected"]}),t.jsxs(r,{variant:"outline",size:"sm",children:[t.jsx(D,{className:"h-4 w-4 mr-2"}),"Delete Selected"]})]}),t.jsx("div",{className:"rounded-md border",children:t.jsxs(N,{children:[t.jsx(v,{children:t.jsxs(g,{children:[t.jsx(w,{className:"w-12",children:t.jsx(f,{checked:i.length===e.length,onCheckedChange:s=>{n(s?e.map(e=>e.id):[])}})}),t.jsx(w,{children:"Status"}),t.jsx(w,{children:"Respondent"}),t.jsx(w,{children:"Preview"}),t.jsx(w,{children:"Submitted"}),t.jsx(w,{className:"w-12"})]})}),t.jsx(b,{children:e.map(e=>t.jsxs(g,{children:[t.jsx(_,{children:t.jsx(f,{checked:i.includes(e.id),onCheckedChange:s=>((e,s)=>{n(s?s=>[...s,e]:s=>s.filter(s=>s!==e))})(e.id,s)})}),t.jsx(_,{children:d(e)}),t.jsx(_,{children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.respondent_email||"Anonymous"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",e.id.substring(0,8),"..."]})]})}),t.jsx(_,{children:t.jsx("div",{className:"max-w-xs truncate text-sm",children:c(e)})}),t.jsx(_,{children:t.jsx("div",{className:"text-sm",children:e.submitted_at?l(e.submitted_at):l(e.created_at)})}),t.jsx(_,{children:t.jsxs(y,{children:[t.jsx(C,{asChild:!0,children:t.jsx(r,{variant:"ghost",size:"sm",children:t.jsx(F,{className:"h-4 w-4"})})}),t.jsxs(S,{align:"end",children:[t.jsxs(k,{onClick:()=>a(e),children:[t.jsx(A,{className:"h-4 w-4 mr-2"}),"View Details"]}),t.jsxs(k,{children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),"Export"]}),t.jsxs(k,{className:"text-destructive",children:[t.jsx(D,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},e.id))})]})})]})},ae=({responses:e,formTitle:c,form:o})=>{const[m,x]=s.useState("csv"),[h,j]=s.useState(!1),[u,p]=s.useState(!0),[N,v]=s.useState(!1),{toast:g}=a(),w=(e,s)=>{if(0===e.length)return;const t=Object.keys(e[0]),r=[t.join(","),...e.map(e=>t.map(s=>{const t=e[s]||"";return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t}).join(","))].join("\n"),a=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(a);i.setAttribute("href",e),i.setAttribute("download",s),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}};return t.jsxs(O,{children:[t.jsx(M,{asChild:!0,children:t.jsxs(r,{variant:"outline",children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),"Export"]})}),t.jsxs(z,{className:"sm:max-w-md",children:[t.jsx(V,{children:t.jsx(q,{children:"Export Responses"})}),t.jsxs(i,{children:[t.jsx(n,{children:t.jsx(l,{className:"text-base",children:"Export Settings"})}),t.jsxs(d,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(L,{htmlFor:"export-format",children:"Export Format"}),t.jsxs(P,{value:m,onValueChange:e=>x(e),children:[t.jsx(T,{children:t.jsx($,{})}),t.jsxs(I,{children:[t.jsx(U,{value:"csv",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(te,{className:"h-4 w-4"}),t.jsx("span",{children:"CSV File"})]})}),t.jsx(U,{value:"excel",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(B,{className:"h-4 w-4"}),t.jsx("span",{children:"Excel File"})]})}),t.jsx(U,{value:"pdf",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(R,{className:"h-4 w-4"}),t.jsx("span",{children:"PDF Report"})]})})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(L,{htmlFor:"include-partial",children:"Include partial responses"}),t.jsx(f,{id:"include-partial",checked:h,onCheckedChange:e=>j(e)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(L,{htmlFor:"include-metadata",children:"Include metadata"}),t.jsx(f,{id:"include-metadata",checked:u,onCheckedChange:e=>p(e)})]})]}),t.jsxs("div",{className:"pt-4 border-t",children:[t.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:[t.jsxs("div",{children:["Total responses: ",e.length]}),t.jsxs("div",{children:["Complete responses: ",e.filter(e=>!e.is_partial).length]}),t.jsxs("div",{children:["Will export: ",h?e.length:e.filter(e=>!e.is_partial).length]})]}),t.jsx(r,{onClick:async()=>{v(!0);try{const s=h?e:e.filter(e=>!e.is_partial&&e.submitted_at);if(0===s.length)return void g({title:"No data to export",description:"No responses match the export criteria",variant:"destructive"});const t=s.map(e=>{const s={};return u&&(s["Response ID"]=e.id,s["Submitted At"]=e.submitted_at||e.created_at,s.Status=e.is_partial?"Partial":"Complete",s.Respondent=e.respondent_email||"Anonymous"),e.url_params&&o?.url_params_config&&o.url_params_config.forEach(t=>{if(!1!==t.visible_in_exports){const r=`param:${t.name}`;s[r]=e.url_params[t.name]||""}}),e.form_response_answers.forEach((e,t)=>{s[`Answer ${t+1}`]=e.value}),s});"csv"===m||"excel"===m?w(t,`${c}_responses.csv`):"pdf"===m&&g({title:"PDF Export",description:"PDF export would be implemented with a PDF library"}),g({title:"Export successful",description:`${s.length} responses exported`})}catch(s){g({title:"Export failed",description:s.message,variant:"destructive"})}finally{v(!1)}},disabled:N||0===e.length,className:"w-full",children:N?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"Exporting..."]}):t.jsxs(t.Fragment,{children:[(e=>{switch(e){case"csv":return t.jsx(te,{className:"h-4 w-4"});case"excel":return t.jsx(B,{className:"h-4 w-4"});case"pdf":return t.jsx(R,{className:"h-4 w-4"});default:return t.jsx(E,{className:"h-4 w-4"})}})(m),t.jsxs("span",{className:"ml-2",children:["Export ",m.toUpperCase()]})]})})]})]})]})]})]})},ie=({response:e,formId:m,onClose:x})=>{const[h,j]=s.useState([]),[u,f]=s.useState(null),[N,v]=s.useState(!0),{toast:g}=a();s.useEffect(()=>{w()},[m]);const w=async()=>{try{const{data:e,error:s}=await c.from("forms").select("id, title, url_params_config").eq("id",m).single();if(s)throw s;f({...e,url_params_config:e.url_params_config||void 0});const{data:t,error:r}=await c.from("form_fields").select("id, label, type, required, options").eq("form_id",m).order("order_index");if(r)throw r;j(t||[])}catch(e){g({title:"Error loading form fields",description:e.message,variant:"destructive"})}finally{v(!1)}},b=e=>{const s=h.find(s=>s.id===e);return s?.label||`Field ${e.substring(0,8)}`},_=e=>{const s=h.find(s=>s.id===e);return s?.type||"text"},y=(e,s)=>{const t=_(s);if(!e)return"No answer";try{switch(t){case"date":return new Date(e).toLocaleDateString();case"time":case"radio":case"select":default:return e;case"checkbox":const s=JSON.parse(e);return Array.isArray(s)?s.join(", "):e;case"file":return"File uploaded"}}catch{return e}},C=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"});return N?t.jsx(O,{open:!0,onOpenChange:x,children:t.jsx(z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-muted rounded w-48"}),t.jsx("div",{className:"h-4 bg-muted rounded w-32"})]})})}):t.jsx(O,{open:!0,onOpenChange:x,children:t.jsxs(z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsx(V,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(q,{children:"Response Details"}),t.jsx(r,{variant:"ghost",size:"sm",onClick:x,children:t.jsx(o,{className:"h-4 w-4"})})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(i,{children:[t.jsx(n,{children:t.jsx(l,{className:"text-base",children:"Response Information"})}),t.jsxs(d,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:"Respondent"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.respondent_email||"Anonymous"})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx(p,{variant:e.is_partial?"outline":"default",children:e.is_partial?"Partial":"Complete"})})]}),t.jsx(Z,{}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:"Started"}),t.jsx("div",{className:"text-muted-foreground",children:C(e.created_at)})]})]}),e.submitted_at&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:"Submitted"}),t.jsx("div",{className:"text-muted-foreground",children:C(e.submitted_at)})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(H,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:"Completion Time"}),t.jsx("div",{className:"text-muted-foreground",children:(()=>{if(!e.submitted_at)return null;const s=new Date(e.created_at).getTime(),t=new Date(e.submitted_at).getTime(),r=Math.round((t-s)/6e4);if(r<1)return"Less than 1 minute";if(r<60)return`${r} minute${1!==r?"s":""}`;return`${Math.floor(r/60)}h ${r%60}m`})()})]})]})]})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Response ID: ",e.id]})]})]}),e.url_params&&Object.keys(e.url_params).length>0&&t.jsxs(i,{children:[t.jsx(n,{children:t.jsx(l,{className:"text-base",children:"URL Parameters"})}),t.jsx(d,{children:t.jsx("div",{className:"space-y-2",children:Object.entries(e.url_params).map(([e,s])=>{const r=u?.url_params_config?.find(s=>s.name===e);return!1!==r?.include_in_responses?t.jsxs("div",{className:"flex justify-between py-2 border-b",children:[t.jsx("span",{className:"font-medium",children:r?.label||e}),t.jsx("span",{className:"text-muted-foreground",children:s})]},e):null})})})]}),t.jsxs(i,{children:[t.jsx(n,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(l,{className:"text-base",children:"Answers"}),t.jsxs(r,{variant:"outline",size:"sm",children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),"Export"]})]})}),t.jsx(d,{children:0===e.form_response_answers.length?t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No answers provided"}):t.jsx("div",{className:"space-y-6",children:e.form_response_answers.map((s,r)=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-sm",children:b(s.field_id)}),t.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:_(s.field_id)})]})}),t.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[t.jsx("div",{className:"text-sm",children:y(s.value,s.field_id)}),s.file_urls&&t.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:"File attachments available"})]}),r<e.form_response_answers.length-1&&t.jsx(Z,{className:"mt-4"})]},s.id))})})]})]})]})})},ne=()=>{const{id:e}=m(),{user:o,loading:p}=x(),[f,N]=s.useState(null),[v,g]=s.useState([]),[w,b]=s.useState(!0),[_,y]=s.useState(""),[C,S]=s.useState(null),[k,E]=s.useState(0),{toast:D}=a();s.useEffect(()=>{o&&e&&F()},[o,e]);const F=async()=>{try{const{data:s,error:t}=await c.from("forms").select("id, title, description, owner_id").eq("id",e).single();if(t)throw t;const{data:r}=await c.rpc("can_access_form",{form_id:e,user_id:o?.id});if(!r)return void D({title:"Access denied",description:"You don't have permission to view this form's responses",variant:"destructive"});N(s);const{data:a,error:i}=await c.rpc("get_secure_form_responses",{form_id_param:e}).returns();if(i)throw i;const n=await Promise.all((a||[]).map(async e=>{const{data:s}=await c.rpc("get_secure_form_response_answers",{response_id_param:e.id});return{...e,form_response_answers:s||[]}}));g(n),E(n?.length||0)}catch(s){D({title:"Error loading responses",description:s.message,variant:"destructive"})}finally{b(!1)}};if(p||w)return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-8 bg-muted rounded w-48"}),t.jsx("div",{className:"h-4 bg-muted rounded w-32"})]})});if(!o)return t.jsx(h,{to:"/auth",replace:!0});if(!f)return t.jsx(h,{to:"/dashboard",replace:!0});const R=v.filter(e=>e.respondent_email?.toLowerCase().includes(_.toLowerCase())||e.id.toLowerCase().includes(_.toLowerCase())),A=v.filter(e=>!e.is_partial&&e.submitted_at),L=v.filter(e=>e.is_partial);return t.jsxs("div",{className:"min-h-screen bg-gradient-subtle",children:[t.jsx("header",{className:"bg-background border-b border-border",children:t.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(r,{variant:"ghost",asChild:!0,children:t.jsxs(j,{to:"/dashboard",children:[t.jsx(K,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),t.jsxs("div",{children:[t.jsx("h1",{className:"font-semibold text-foreground",children:f.title}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Form Responses"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(J,{}),t.jsx(r,{variant:"outline",asChild:!0,children:t.jsxs(j,{to:"/docs/api",children:[t.jsx(W,{className:"h-4 w-4 mr-2"}),"API Docs"]})}),t.jsx(r,{variant:"outline",asChild:!0,children:t.jsxs(j,{to:`/forms/${e}/analytics`,children:[t.jsx(B,{className:"h-4 w-4 mr-2"}),"Analytics"]})}),t.jsx(r,{variant:"outline",asChild:!0,children:t.jsxs(j,{to:`/forms/${e}/embed`,children:[t.jsx(X,{className:"h-4 w-4 mr-2"}),"Embed"]})}),t.jsx(ae,{responses:v,formTitle:f.title,form:f})]})]})}),t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[t.jsxs(i,{children:[t.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(l,{className:"text-sm font-medium",children:"Total Responses"}),t.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(d,{children:t.jsx("div",{className:"text-2xl font-bold",children:k})})]}),t.jsxs(i,{children:[t.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(l,{className:"text-sm font-medium",children:"Completed"}),t.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(d,{children:t.jsx("div",{className:"text-2xl font-bold text-success",children:A.length})})]}),t.jsxs(i,{children:[t.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(l,{className:"text-sm font-medium",children:"Partial"}),t.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(d,{children:t.jsx("div",{className:"text-2xl font-bold text-warning",children:L.length})})]}),t.jsxs(i,{children:[t.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(l,{className:"text-sm font-medium",children:"Completion Rate"}),t.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(d,{children:t.jsxs("div",{className:"text-2xl font-bold",children:[k>0?Math.round(A.length/k*100):0,"%"]})})]})]}),t.jsxs(i,{className:"mb-6",children:[t.jsx(n,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(l,{children:"Response Management"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(u,{placeholder:"Search responses...",value:_,onChange:e=>y(e.target.value),className:"pl-9 w-64"})]}),t.jsxs(r,{variant:"outline",size:"sm",children:[t.jsx(se,{className:"h-4 w-4 mr-2"}),"Filters"]})]})]})}),t.jsx(d,{children:t.jsx(re,{responses:R,onViewResponse:S})})]})]}),C&&t.jsx(ie,{response:C,formId:e,onClose:()=>S(null)})]})};export{ne as default};
