import{c as e,r as s,s as r,k as a,j as t,B as n,C as i,f as l,b as c}from"./main-BQOa5mM0.js";import{D as d,a as o,b as m,c as x}from"./dialog-Zbmvpzx0.js";import{B as h}from"./badge-6grXs2Vt.js";import{G as u}from"./gift-mKnn5hCx.js";import{C as f}from"./check-WoqjMYuF.js";import{C as p}from"./copy-BZksGIXa.js";import{S as j}from"./share-2-CwU1PQxU.js";import{A as g}from"./arrow-left-BoD24ioV.js";import{D as y}from"./dollar-sign-CFY7m5M8.js";import{C as N}from"./clock-BGkZXTj0.js";import{C as v}from"./calendar-BcqkHMaS.js";import{f as w}from"./format-CNqjFxb7.js";import{C as b}from"./circle-check-big-BImW7D2D.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=e("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);function _(){const[e,a]=s.useState(null),[t,n]=s.useState(!0),[i,l]=s.useState(null),c=async()=>{try{n(!0),l(null);const{data:e,error:s}=await r.functions.invoke("get-referral-settings");if(s)throw s;a(e.settings)}catch(e){l(e instanceof Error?e.message:"Failed to fetch settings")}finally{n(!1)}};return s.useEffect(()=>{c();const e=r.channel("referral-settings-changes").on("postgres_changes",{event:"*",schema:"public",table:"referral_settings"},()=>{c()}).subscribe();return()=>{r.removeChannel(e)}},[]),{settings:e,loading:t,error:i,refetch:c}}function C({open:e,onOpenChange:i,onShowRewards:l}){const[c,g]=s.useState(null),[y,N]=s.useState(!1),[v,w]=s.useState(!1),{toast:b}=a(),{settings:C}=_();s.useEffect(()=>{e&&S()},[e]);const S=async()=>{try{N(!0);const{data:e,error:s}=await r.functions.invoke("generate-referral-code");if(s)return void(await R());g(e)}catch(e){await R()}finally{N(!1)}},R=async()=>{try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:s,error:a}=await r.from("referral_codes").select("code").eq("user_id",e.id).eq("is_active",!0).order("created_at",{ascending:!1}).limit(1);if(a)throw a;if(s&&s.length>0){const e=s[0].code;g({code:e,url:`${window.location.origin}/auth?ref=${e}`}),b({title:"Referral Code Found",description:"Loaded your existing referral code."})}else b({title:"No Referral Code",description:"You don't have an active referral code yet. Please contact support.",variant:"destructive"})}catch(e){b({title:"Error",description:"Failed to load referral data. Check your connection and try again.",variant:"destructive"})}},F=async e=>{try{await navigator.clipboard.writeText(e),w(!0),b({title:"Copied!",description:"Referral link copied to clipboard"}),setTimeout(()=>w(!1),2e3)}catch(s){b({title:"Error",description:"Failed to copy link",variant:"destructive"})}};return y?t.jsx(d,{open:e,onOpenChange:i,children:t.jsx(o,{className:"sm:max-w-[500px]",children:t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})}):t.jsx(d,{open:e,onOpenChange:i,children:t.jsxs(o,{className:"sm:max-w-[500px]",children:[t.jsx(m,{children:t.jsxs(x,{className:"flex items-center gap-2",children:[t.jsx(u,{className:"h-5 w-5 text-primary"}),"Invite Friends & Earn Rewards"]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"font-semibold text-lg",children:"How it works:"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50",children:[t.jsx(h,{variant:"default",className:"w-8 h-8 rounded-full p-0 flex items-center justify-center text-sm bg-primary text-primary-foreground",children:"1"}),t.jsx("span",{className:"text-sm",children:"Share your unique referral link"})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50",children:[t.jsx(h,{variant:"default",className:"w-8 h-8 rounded-full p-0 flex items-center justify-center text-sm bg-primary text-primary-foreground",children:"2"}),t.jsxs("span",{className:"text-sm",children:["Friends get ",t.jsxs("strong",{children:[C?.friend_discount_percentage?.value||50,"% off"]})," their first subscription"]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50",children:[t.jsx(h,{variant:"default",className:"w-8 h-8 rounded-full p-0 flex items-center justify-center text-sm bg-primary text-primary-foreground",children:"3"}),t.jsxs("span",{className:"text-sm",children:["You earn up to ",t.jsxs("strong",{children:["$",C?.maximum_earning_per_referral?.value||500]})," per referral"]})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"font-semibold text-lg",children:"Your referral link:"}),t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"flex gap-2 p-4 bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg border border-primary/20",children:[t.jsx("div",{className:"flex-1 text-sm font-mono text-foreground break-all pr-2",children:c?.url}),t.jsx(n,{variant:"outline",size:"sm",onClick:()=>F(c?.url||""),className:"shrink-0 bg-background hover:bg-primary hover:text-primary-foreground transition-colors",children:v?t.jsx(f,{className:"h-4 w-4"}):t.jsx(p,{className:"h-4 w-4"})})]})})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(n,{onClick:async()=>{if(navigator.share&&c)try{await navigator.share({title:"Join me on FormCraft",text:"Get 50% off your first subscription!",url:c.url})}catch(e){F(c.url)}else c&&F(c.url)},className:"flex-1 h-12 bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(j,{className:"h-4 w-4 mr-2"}),"Share Link"]}),t.jsxs(n,{variant:"outline",onClick:l,className:"flex-1 h-12 border-primary text-primary hover:bg-primary hover:text-primary-foreground",children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"View Rewards"]})]}),t.jsxs("div",{className:"text-center p-4 bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg border border-primary/20",children:[t.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:"Referral Code"}),t.jsx("div",{className:"text-3xl font-bold tracking-wider text-primary font-mono",children:c?.code})]})]})]})})}function S({open:e,onOpenChange:a,onBack:u}){const[f,p]=s.useState([]),[j,C]=s.useState(!1),[S,R]=s.useState(0),[F,M]=s.useState(0),{settings:E}=_();s.useEffect(()=>{e&&q()},[e]);const q=async()=>{C(!0);try{const{data:e}=await r.auth.getUser();if(!e.user)return;const{data:s,error:a}=await r.from("referrals").select("\n          id,\n          created_at,\n          reward_earned,\n          status,\n          referral_rewards (\n            amount,\n            status,\n            created_at,\n            paid_at\n          )\n        ").eq("referrer_id",e.user.id).order("created_at",{ascending:!1});if(a)throw a;p(s||[]);const t=s?.reduce((e,s)=>e+(s.reward_earned||0),0)||0,n=s?.reduce((e,s)=>e+(s.referral_rewards?.filter(e=>"pending"===e.status).reduce((e,s)=>e+s.amount,0)||0),0)||0;R(t),M(n)}catch(e){}finally{C(!1)}},O=e=>{switch(e){case"pending":return t.jsxs(h,{variant:"secondary",children:[t.jsx(N,{className:"h-3 w-3 mr-1"}),"Pending"]});case"paid":return t.jsxs(h,{variant:"default",className:"bg-green-100 text-green-800",children:[t.jsx(b,{className:"h-3 w-3 mr-1"}),"Paid"]});default:return t.jsx(h,{variant:"outline",children:e})}};return j?t.jsx(d,{open:e,onOpenChange:a,children:t.jsx(o,{className:"sm:max-w-[600px]",children:t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})}):t.jsx(d,{open:e,onOpenChange:a,children:t.jsxs(o,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[t.jsx(m,{children:t.jsxs(x,{className:"flex items-center gap-2",children:[t.jsx(n,{variant:"ghost",size:"sm",onClick:u,className:"p-0 h-6 w-6",children:t.jsx(g,{className:"h-4 w-4"})}),t.jsx(k,{className:"h-5 w-5 text-primary"}),"Your Rewards"]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(i,{children:t.jsxs(l,{className:"p-4 text-center",children:[t.jsx(y,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),t.jsxs("div",{className:"text-2xl font-bold",children:["$",S.toFixed(2)]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Earnings"})]})}),t.jsx(i,{children:t.jsxs(l,{className:"p-4 text-center",children:[t.jsx(N,{className:"h-8 w-8 mx-auto mb-2 text-yellow-600"}),t.jsxs("div",{className:"text-2xl font-bold",children:["$",F.toFixed(2)]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Pending Rewards"})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-semibold",children:"Reward History"}),0===f.length?t.jsx(i,{children:t.jsxs(l,{className:"p-6 text-center",children:[t.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("h3",{className:"font-semibold mb-2",children:"No rewards yet"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Start referring friends to earn rewards!"})]})}):f.map(e=>t.jsxs(i,{children:[t.jsx(c,{className:"pb-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:w(new Date(e.created_at),"MMM dd, yyyy")})]}),t.jsxs("div",{className:"text-lg font-bold text-green-600",children:["+$",e.reward_earned.toFixed(2)]})]})}),t.jsx(l,{className:"pt-0",children:t.jsx("div",{className:"space-y-2",children:e.referral_rewards.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between py-2 border-t",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[O(e.status),t.jsx("span",{className:"text-sm",children:"Referral Bonus"})]}),t.jsxs("div",{className:"text-sm font-medium",children:["$",e.amount.toFixed(2)]})]},s))})})]},e.id))]}),t.jsx(i,{className:"bg-muted/50",children:t.jsx(l,{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(y,{className:"h-5 w-5 text-primary mt-0.5"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("h4",{className:"font-semibold text-sm",children:"Payment Information"}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Rewards are processed ",E?.payment_processing_frequency?.value?.toLowerCase()||"monthly",". Pending rewards will be paid out to your registered payment method within ",E?.payment_schedule_days?.value||"5-7 business days","."]})]})]})})})]})]})})}export{C as R,S as a};
