import{c as e,Z as s,a,u as i,k as t,r as n,j as l,C as c,f as r,g as m,b as d,d as o,e as x,B as h,L as j,s as u}from"./main-BQOa5mM0.js";import{C as p}from"./circle-x-BCWjiaKg.js";import{C as f}from"./circle-check-big-BImW7D2D.js";import{U as N}from"./user-plus-GQG3TCfy.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=e("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),g=()=>{const{token:e}=s(),g=a(),{user:w,loading:b}=i(),{toast:y}=t(),[I,k]=n.useState(null),[_,C]=n.useState(!0),[A,S]=n.useState(!1),[T,F]=n.useState(null),[D,P]=n.useState(!1);n.useEffect(()=>{(async()=>{if(!e)return F("Invalid invitation link"),void C(!1);try{const{data:s,error:a}=await u.from("team_invitations").select("*").eq("token",e).is("accepted_at",null).single();if(a||!s)return F("This invitation is invalid or has already been used."),void C(!1);if(new Date(s.expires_at)<new Date)return F("This invitation has expired."),void C(!1);k(s)}catch(s){F("Failed to load invitation details.")}finally{C(!1)}})()},[e]);return _||b?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle",children:l.jsx(c,{className:"w-full max-w-md",children:l.jsxs(r,{className:"flex flex-col items-center py-12",children:[l.jsx(m,{className:"h-8 w-8 animate-spin text-primary mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Loading invitation..."})]})})}):T?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle p-4",children:l.jsxs(c,{className:"w-full max-w-md",children:[l.jsxs(d,{className:"text-center",children:[l.jsx(p,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),l.jsx(o,{children:"Invalid Invitation"}),l.jsx(x,{children:T})]}),l.jsx(r,{className:"flex justify-center",children:l.jsx(h,{asChild:!0,children:l.jsx(j,{to:"/dashboard",children:"Go to Dashboard"})})})]})}):D?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle p-4",children:l.jsxs(c,{className:"w-full max-w-md",children:[l.jsxs(d,{className:"text-center",children:[l.jsx(f,{className:"h-12 w-12 text-success mx-auto mb-4"}),l.jsx(o,{children:"Invitation Accepted!"}),l.jsx(x,{children:"Redirecting you to your new access..."})]}),l.jsx(r,{className:"flex justify-center",children:l.jsx(m,{className:"h-6 w-6 animate-spin text-primary"})})]})}):w?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle p-4",children:l.jsxs(c,{className:"w-full max-w-md",children:[l.jsxs(d,{className:"text-center",children:[l.jsx(N,{className:"h-12 w-12 text-primary mx-auto mb-4"}),l.jsx(o,{children:"Accept Team Invitation"}),l.jsx(x,{children:"You've been invited to collaborate."})]}),l.jsxs(r,{className:"space-y-4",children:[l.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[l.jsxs("p",{className:"text-sm",children:[l.jsx("span",{className:"font-medium",children:"Invited email:"})," ",I?.email]}),l.jsxs("p",{className:"text-sm",children:[l.jsx("span",{className:"font-medium",children:"Role:"})," ",l.jsx("span",{className:"capitalize",children:I?.role})]}),I?.form_title&&l.jsxs("p",{className:"text-sm",children:[l.jsx("span",{className:"font-medium",children:"Form:"})," ",I.form_title]}),I?.org_name&&l.jsxs("p",{className:"text-sm",children:[l.jsx("span",{className:"font-medium",children:"Organization:"})," ",I.org_name]})]}),w.email!==I?.email&&l.jsx("div",{className:"bg-warning/10 border border-warning rounded-lg p-4",children:l.jsxs("p",{className:"text-sm text-warning-foreground",children:["You're signed in as ",l.jsx("strong",{children:w.email}),", but this invitation was sent to"," ",l.jsx("strong",{children:I?.email}),". Please sign in with the correct email."]})}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx(h,{variant:"outline",className:"flex-1",asChild:!0,children:l.jsx(j,{to:"/dashboard",children:"Decline"})}),l.jsx(h,{className:"flex-1",onClick:async()=>{if(I&&w?.id&&e)if(w.email===I.email){S(!0);try{const{data:s,error:a}=await u.functions.invoke("accept-invitation",{body:{token:e}});if(a)throw a;if(s?.error)throw new Error(s.error);P(!0),y({title:"Invitation accepted!",description:"You now have access to the shared resource."}),setTimeout(()=>{I.form_id?g(`/forms/${I.form_id}`):g("/dashboard")},2e3)}catch(s){y({title:"Failed to accept invitation",description:s.message||"An error occurred.",variant:"destructive"})}finally{S(!1)}}else y({title:"Email mismatch",description:`This invitation was sent to ${I.email}. Please sign in with that email address.`,variant:"destructive"})},disabled:A||w.email!==I?.email,children:A?l.jsxs(l.Fragment,{children:[l.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),"Accepting..."]}):l.jsxs(l.Fragment,{children:[l.jsx(f,{className:"mr-2 h-4 w-4"}),"Accept Invitation"]})})]})]})]})}):l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle p-4",children:l.jsxs(c,{className:"w-full max-w-md",children:[l.jsxs(d,{className:"text-center",children:[l.jsx(N,{className:"h-12 w-12 text-primary mx-auto mb-4"}),l.jsx(o,{children:"Team Invitation"}),l.jsx(x,{children:"You've been invited to collaborate. Please sign in to accept."})]}),l.jsxs(r,{className:"space-y-4",children:[l.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[l.jsxs("p",{className:"text-sm",children:[l.jsx("span",{className:"font-medium",children:"Invited as:"})," ",I?.email]}),l.jsxs("p",{className:"text-sm",children:[l.jsx("span",{className:"font-medium",children:"Role:"})," ",l.jsx("span",{className:"capitalize",children:I?.role})]})]}),l.jsx(h,{className:"w-full",asChild:!0,children:l.jsxs(j,{to:`/auth?redirect=/accept-invite/${e}`,children:[l.jsx(v,{className:"mr-2 h-4 w-4"}),"Sign In to Accept"]})})]})]})})};export{g as default};
